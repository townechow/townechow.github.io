<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/d4dd73d504c89c58.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/485ff6fe79292a08.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0ff121a467c0636f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-53834dba86d90934.js"/><script src="/_next/static/chunks/4bd1b696-20882bf820444624.js" async=""></script><script src="/_next/static/chunks/517-98ed787e5f259f2c.js" async=""></script><script src="/_next/static/chunks/main-app-f33d3e3aed85e21f.js" async=""></script><meta name="next-size-adjust" content=""/><title>front-end</title><meta name="description" content="front-end knowledge"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_4d318d __variable_ea5f4b antialiased"><main><div class="markdown-body"><article><h1>Service Worker</h1>
<p>Service Worker ä¹Ÿç§°æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼Œæ˜¯æµè§ˆå™¨åœ¨åå°ç‹¬ç«‹ç½‘é¡µè¿è¡Œçš„è„šæœ¬ï¼Œä¹Ÿç®—ä½œæ˜¯ JavaScript å·¥ä½œçº¿ç¨‹ã€‚å®ƒæ— æ³•ç›´æ¥è®¿é—® DOMï¼Œå› æ­¤ï¼Œå¦‚æœä½ éœ€è¦æ“ä½œé¡µé¢çš„ DOM èŠ‚ç‚¹çš„è¯ï¼Œå¯ä»¥é€šè¿‡ Â <a href="https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage" target="_blank" rel="noopener noreferrer nofollow">postMessage</a>Â  æ¥è·Ÿæƒ³æ§åˆ¶çš„é¡µé¢è¿›è¡Œé€šä¿¡ã€‚ Service Worker ä¸­çš„ API å¤§é‡é‡‡ç”¨ Promise æ–¹å¼è®¾è®¡ï¼Œå› æ­¤ä»£ç æ¯”è¾ƒå‹å¥½ã€‚</p>
<p>åœ¨å…¼å®¹æ€§æ–¹é¢ï¼Œ Chrome Firefox Opera éƒ½å·²ç»æ”¯æŒï¼Œ Microsoft Edge ç°åœ¨ä¹Ÿè¡¨ç¤ºå…¬å¼€æ”¯æŒã€‚è€Œä¹‹å‰ Safari å› ä¸ºä¸è®¡åˆ’æ”¯æŒè¢«å¾ˆå¤šå¼€å‘è€…åæ§½ï¼Œè®¤ä¸ºå®ƒå°†ä¼šæ˜¯ä¸‹ä¸€ä»£ IE ã€‚è¿«äºå‹åŠ›ä¸‹ï¼Œç° Safari ä¹Ÿ<a href="https://trac.webkit.org/wiki/FiveYearPlanFall2015" target="_blank" rel="noopener noreferrer nofollow">æš—ç¤ºæœªæ¥ä¼šè¿›è¡Œå¼€å‘</a>ã€‚</p>
<p>å¦‚æœç½‘ç«™è¦ä½¿ç”¨ Service Worker ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º HTTPS ã€‚å› ä¸º Service Worker ä¸­ä¼šæ¶‰åŠåˆ°è¯·æ±‚æ‹¦æˆªï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ HTTPS åè®®æ¥ä¿è¯å®‰å…¨ã€‚ å¦å¤–ï¼Œå¦‚æœéœ€è¦æœ¬åœ°è°ƒè¯• Service Worker çš„è¯ï¼ŒÂ <code>localhost</code>Â  æ˜¯è¢«æ”¯æŒçš„ã€‚</p>
<h2>æ¦‚è¿°</h2>
<p>è‹¥æƒ³ç†è§£ Service Workers ç›¸å…³çš„ä¸€åˆ‡ï¼Œä½ é¦–å…ˆåº”è¯¥é˜…è¯»ä¸€ä¸‹ä¹‹å‰å‘å¸ƒçš„æœ‰å…³ <a href="https://github.com/Troland/how-javascript-works/blob/master/worker" target="_blank" rel="noopener noreferrer nofollow">Web Workers</a> çš„æ–‡ç« ã€‚</p>
<p>å¤§ä½“ä¸Šï¼ŒService Worker æ˜¯ä¸€ç§ Web Workerï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ª <a href="https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker" target="_blank" rel="noopener noreferrer nofollow">Shared Worker</a>ã€‚</p>
<ul>
<li>Service Worker è¿è¡Œåœ¨å…¶å…¨å±€è„šæœ¬ä¸Šä¸‹æ–‡ä¸­</li>
<li>ä¸æŒ‡å®šå’ŒæŸä¸ªç½‘é¡µç»‘å®š</li>
<li>ä¸èƒ½å¤Ÿè®¿é—® DOM</li>
</ul>
<p>Service Worker æ¥å£ä¹‹æ‰€ä»¥è®©äººæ„Ÿåˆ°å…´å¥‹çš„åŸå› ä¹‹ä¸€å³å®ƒæ”¯æŒç½‘ç»œåº”ç”¨ç¦»çº¿è¿è¡Œï¼Œè¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨æ§åˆ¶ç½‘ç»œåº”ç”¨çš„è¡Œä¸ºã€‚</p>
<h2>ç”Ÿå‘½å‘¨æœŸ</h2>
<p>Service Worker çš„ç”Ÿå‘½å‘¨æœŸå’Œç½‘é¡µå®Œå…¨ä¸ç›¸å…³ã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p>
<ul>
<li>ä¸‹è½½ï¼ˆDownloadï¼‰</li>
<li>å®‰è£…ï¼ˆInstallï¼‰</li>
<li>æ¿€æ´»ï¼ˆActivateï¼‰</li>
</ul>
<h3>ä¸‹è½½</h3>
<p>è¿™å‘ç”Ÿäºæµè§ˆå™¨ä¸‹è½½åŒ…å« Service Worker ç›¸å…³ä»£ç çš„ Â <code>.js</code>Â  æ–‡ä»¶ã€‚</p>
<h3>å®‰è£…</h3>
<p>ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ä¸­ä½¿ç”¨ Service Workerï¼Œé¦–å…ˆå¾—åœ¨ JavaScript ä»£ç ä¸­å¯¹å…¶è¿›è¡Œæ³¨å†Œã€‚å½“ Service Worker æ³¨å†Œçš„æ—¶å€™ï¼Œå®ƒä¼šè®©æµè§ˆå™¨åœ¨åå°å¼€å§‹å®‰è£… Service Worker çš„æ­¥éª¤ã€‚</p>
<p>å½“ä½ çš„åº”ç”¨ä¹‹å‰æœªæ³¨å†Œè¿‡ Service Worker çš„è¯ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°†ä¼šæ˜¯æ³¨å†Œç¯èŠ‚ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">if</span> (<span class="hljs-string">&#x27;serviceWorker&#x27;</span> <span class="hljs-keyword">in</span> navigator) {
  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;load&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) {
    navigator.<span class="hljs-property">serviceWorker</span>
      .<span class="hljs-title function_">register</span>(<span class="hljs-string">&#x27;/sw.js&#x27;</span>)
      .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">registeration</span> =&gt;</span> {
        <span class="hljs-comment">// success</span>
      })
      .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
        <span class="hljs-comment">// error</span>
      });
  });
}
</code></pre>
<p>è¯·æ³¨æ„ï¼Œä»¥ä¸Š <code>'/sw.js'</code> ä»£è¡¨ Service Worker ä½œç”¨åŸŸçš„èŒƒå›´ä¸ºæ ¹åŸŸï¼ˆä¹Ÿå°±æ˜¯ Service Worker è„šæœ¬çš„ä½ç½®ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ çš„é¡µé¢åœ¨ <code>'/example/a.html'</code> ä¸­ä¹Ÿå±äºè¯¥ Service Worker çš„æ§åˆ¶èŒƒå›´ã€‚</p>
<p>Chrome æµè§ˆå™¨ä¸‹ï¼Œå¯ä»¥åœ¨ Â <code>chrome://inspect /#service-workers</code>Â  ä¸­ï¼ŒæŸ¥çœ‹æœåŠ¡å·¥ä½œçº¿ç¨‹æ˜¯å¦å·²ç»æ³¨å†Œã€‚å¦‚æœè°ƒè¯•çš„è¯ï¼Œç”¨éšèº«æ¨¡å¼æ‰“å¼€çª—å£ä¼šéå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºä»éšèº«çª—å£åˆ›å»ºçš„ä»»ä½•æ³¨å†Œå’Œç¼“å­˜åœ¨è¯¥çª—å£å…³é—­åå‡å°†è¢«æ¸…é™¤ã€‚</p>
<p>é™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸Šä»£ç æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š</p>
<ul>
<li>éœ€è¦è¿›è¡Œç‰¹æ€§æ£€æµ‹ï¼Œåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒã€‚</li>
<li>æœ€å¥½åœ¨é¡µé¢æ‰€æœ‰èµ„æºéƒ½å·²ç»åŠ è½½å®Œæ¯•åï¼Œè¿™ä¸ªæ—¶å€™å»åŠ è½½ Service Worker æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ—¶é—´ç‚¹ã€‚å› ä¸ºåœ¨ç§»åŠ¨ç«¯ï¼Œé¡µé¢æ‰“å¼€é¦–å±æ—¶é—´éå¸¸å…³é”®ã€‚</li>
</ul>
<p>åœ¨å®‰è£…é˜¶æ®µï¼Œæœ€å¥½åŠ è½½å’Œç¼“å­˜ä¸€äº›é™æ€èµ„æºã€‚ä¸€æ—¦é™æ€èµ„æºç¼“å­˜æˆåŠŸï¼ŒService Worker çš„å®‰è£…ä¹Ÿå°±å®Œæˆäº†ã€‚å€˜è‹¥åŠ è½½å¤±è´¥ï¼Service Worker å°†ä¼šé‡è¯•ã€‚ä¸€æ—¦å®‰è£…æˆåŠŸï¼Œé™æ€èµ„æºä¹Ÿå°±ç¼“å­˜æˆåŠŸäº†ã€‚</p>
<p>å‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç»œåº”ç”¨ã€‚ç°åœ¨è¿˜æ²¡æœ‰æ³¨å†Œ Service Workerï¼Œè€Œä¸”æµè§ˆå™¨æ— æ³•äº‹å…ˆçŸ¥æ™“æ˜¯å¦ä¼šæœ€ç»ˆå®‰è£…å®ƒã€‚å¦‚æœè¿›è¡Œå®‰è£…ï¼Œåˆ™æµè§ˆå™¨å°†ä¼šä¸ºå¢åŠ çš„çº¿ç¨‹å¼€è¾Ÿé¢å¤–çš„ CPU å’Œå†…å­˜ï¼Œè€Œè¿™äº›èµ„æºåŸæœ¬æ˜¯ç”¨æ¥æ¸²æŸ“ç½‘é¡µçš„ã€‚</p>
<p><code>load</code> äº‹ä»¶ä¼šåŠ è½½å®Œæ‰€æœ‰çš„èµ„æºæ¯”å¦‚å›¾ç‰‡ï¼Œæ ·å¼ä¹‹åè§¦å‘ã€‚</p>
<p>æœ€ç»ˆçš„ç»“æœå³æ˜¯å¦‚æœåœ¨é¡µé¢ä¸­å®‰è£… Service Workerï¼Œå°†æœ‰å¯èƒ½å¯¼è‡´é¡µé¢å»¶è¿ŸåŠ è½½å’Œæ¸²æŸ“ï¼ä¸èƒ½å¤Ÿè®©ç”¨æˆ·å°½å¿«åœ°è®¿é—®ç½‘é¡µã€‚</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯è¿™åªä¼šå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ã€‚åç»­çš„é¡µé¢è®¿é—®ä¸ä¼šè¢« Service Worker çš„å®‰è£…æ‰€å½±å“ã€‚ä¸€æ—¦åœ¨é¦–æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™æ¿€æ´»äº† Service Worker ï¼Œå®ƒå°±å¯ä»¥å¤„ç†åç»­çš„é¡µé¢è®¿é—®æ‰€è§¦å‘çš„é¡µé¢åŠ è½½/ç¼“å­˜äº‹ä»¶ã€‚è¿™æ˜¯æ­£ç¡®çš„ï¼ŒService Worker éœ€è¦åŠ è½½å¥½ä»¥å¤„ç†æœ‰é™çš„ç½‘ç»œå¸¦å®½ã€‚</p>
<h3>æ¿€æ´»</h3>
<p>å®‰è£…å®Œä¹‹åä¸‹ä¸€æ­¥å³æ¿€æ´»ã€‚è¯¥æ­¥éª¤æ˜¯æ“ä½œä¹‹å‰ç¼“å­˜èµ„æºçš„ç»ä½³æ—¶æœºã€‚</p>
<p>ä¸€æ—¦æ¿€æ´»ï¼ŒService Worker å°±å¯ä»¥å¼€å§‹æ§åˆ¶åœ¨å…¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰é¡µé¢ã€‚ä¸€ä¸ªæœ‰è¶£çš„äº‹å®å³ï¼šæ³¨å†Œäº† Service Worker çš„é¡µé¢ç›´åˆ°å†æ¬¡åŠ è½½çš„æ—¶å€™æ‰ä¼šè¢« Service Worker è¿›è¡Œå¤„ç†ã€‚å½“ Service Worker å¼€å§‹è¿›è¡Œæ§åˆ¶ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š</p>
<ul>
<li>å¤„ç†æ¥è‡ªé¡µé¢çš„ç½‘ç»œæˆ–è€…æ¶ˆæ¯è¯·æ±‚æ‰€è§¦å‘çš„ fetch åŠ message äº‹ä»¶</li>
<li>ä¸­æ­¢ä»¥èŠ‚çº¦å†…å­˜</li>
</ul>
<p>ä»¥ä¸‹å³å…¶ç”Ÿå‘½å‘¨æœŸï¼š</p>
<p><img src="/front-end/Users/mrsingsing/Desktop/9ffdbf83-64b9-4a9f-a15c-44282fe47d5e.png" alt="ServiceWorkerç”Ÿå‘½å‘¨æœŸ-æ¿€æ´»"></p>
<h2>å¤„ç† Service Worker å†…éƒ¨çš„å®‰è£…è¿‡ç¨‹</h2>
<p>åœ¨å—æ§é¡µé¢è¿è¡Œæ³¨å†Œ Service Worker çš„è¿‡ç¨‹ä¸­ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ Service Worker è„šæœ¬ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼Œå®ƒç›‘å¬ Service Worker å®ä¾‹çš„ Â <code>install</code>Â  äº‹ä»¶ã€‚</p>
<p>ä»¥ä¸‹ä¸ºå¤„ç† <code>install</code> å®‰è£…äº‹ä»¶æ‰€éœ€è¦æ‰§è¡Œçš„æ­¥éª¤ï¼š</p>
<ul>
<li>æ‰“å¼€ç¼“å­˜ç©ºé—´</li>
<li>ç¼“å­˜æ–‡ä»¶</li>
<li>ç¡®è®¤æ˜¯å¦æ‰€æœ‰çš„é™æ€èµ„æºå·²ç¼“å­˜</li>
</ul>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">CACHE_NAME</span> = <span class="hljs-string">&#x27;my-web-app-cache&#x27;</span>;
<span class="hljs-keyword">const</span> urlsToCache = [<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-string">&#x27;/styles/base.css&#x27;</span>, <span class="hljs-string">&#x27;/dist/bundle.js&#x27;</span>];

self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;install&#x27;</span>, <span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {
  <span class="hljs-comment">// å¼€å§‹ç¼“å­˜æ–‡ä»¶</span>
  <span class="hljs-comment">// event.waitUntilä½¿ç”¨promiseæ¥è·å¾—å®‰è£…æ—¶é•¿åŠå®‰è£…æ˜¯å¦å¤±è´¥</span>
  event.<span class="hljs-title function_">waitUntil</span>(
    caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">cache</span>) {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;æˆåŠŸæ‰“å¼€ç¼“å­˜ç©ºé—´&#x27;</span>);
      <span class="hljs-keyword">return</span> cache.<span class="hljs-title function_">addAll</span>(urlsToCache);
    })
  );
});
</code></pre>
<p>è¯·æ³¨æ„ï¼Œè¿™é‡Œé¢æœ‰ä¸ªç¼“å­˜ç©ºé—´çš„æ¦‚å¿µï¼Œä¹Ÿå³ <code>caches.open</code> é‡Œçš„å‚æ•°ã€‚å› ä¸ºæ¯ä¸ªé¡µé¢å¯¹åº”çš„ç¼“å­˜ç©ºé—´å¯èƒ½ä¸ç›¸åŒï¼Œæœ‰äº†ç¼“å­˜ç©ºé—´åä¹Ÿèƒ½æ›´å¥½çš„å¯¹ç¼“å­˜è¿›è¡Œæ§åˆ¶ã€‚æ‰“å¼€ç¼“å­˜ç©ºé—´åï¼Œä¹‹åå†è°ƒç”¨ <code>cache.addAll()</code> å¹¶ä¼ å…¥æ–‡ä»¶æ•°ç»„è¿›è¡Œç¼“å­˜ã€‚</p>
<p>ä¸Šè¿°ä¸­ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½æˆåŠŸç¼“å­˜æ‰ç®—æˆåŠŸï¼Œå¦‚æœæœ‰ä»»ä½•æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œé‚£ä¹ˆå®‰è£…æ­¥éª¤å°±ä¼šå¤±è´¥ã€‚æ‰€ä»¥å¦‚æœç¼“å­˜åˆ—è¡¨è¿‡é•¿çš„è¯ï¼Œå°†ä¼šå¢åŠ ç¼“å­˜å¤±è´¥çš„å‡ ç‡ã€‚</p>
<p>å¦‚æœ <code>sw.js</code> ä¸€ç›´éƒ½ä¸å˜åŒ–çš„è¯ï¼Œé‚£ä¹ˆ <code>install</code> å®‰è£…äº‹ä»¶åªæœ‰åœ¨é¦–æ¬¡å®‰è£…çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ã€‚</p>
<p>å¤„ç† Â <code>install</code>Â  äº‹ä»¶å®Œå…¨æ˜¯å¯é€‰ï¼Œå½“ä¸è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œè·³è¿‡ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤å³å¯ã€‚</p>
<h2>ç¼“å­˜è¿è¡Œæ—¶è¯·æ±‚</h2>
<p>è¯¥éƒ¨åˆ†æ‰æ˜¯å¹²è´§ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°å¦‚ä½•æ‹¦æˆªè¯·æ±‚ç„¶åè¿”å›å·²åˆ›å»ºçš„ç¼“å­˜ï¼ˆä»¥åŠåˆ›å»ºæ–°çš„ç¼“å­˜ï¼‰ã€‚</p>
<p>å½“ Service Worker å®‰è£…å®Œæˆä¹‹åï¼Œç”¨æˆ·ä¼šå¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢æˆ–è€…åˆ·æ–°å½“å‰é¡µé¢ï¼ŒService Worker å°†ä¼šè§¦å‘ fetch äº‹ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ¼”ç¤ºäº†å¦‚ä½•è¿”å›ç¼“å­˜çš„é™æ€èµ„æºæˆ–æ‰§è¡Œä¸€ä¸ªæ–°çš„è¯·æ±‚å¹¶ç¼“å­˜è¿”å›ç»“æœçš„è¿‡ç¨‹çš„ç¤ºä¾‹ï¼š</p>
<pre class="hljs"><code class="language-js">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;fetch&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  event.<span class="hljs-title function_">respondWith</span>(
    <span class="hljs-comment">// è¯¥æ–¹æ³•æŸ¥è¯¢è¯·æ±‚ç„¶åè¿”å›Service Workeråˆ›å»ºçš„ä»»ä½•ç¼“å­˜æ•°æ®</span>
    caches.<span class="hljs-title function_">match</span>(event.<span class="hljs-property">request</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) {
      <span class="hljs-comment">// è‹¥æœ‰ç¼“å­˜,åˆ™è¿”å›</span>
      <span class="hljs-keyword">if</span> (response) {
        <span class="hljs-keyword">return</span> response;
      }

      <span class="hljs-comment">// å¤åˆ¶è¯·æ±‚ã€‚è¯·æ±‚æ˜¯ä¸€ä¸ªæµä¸”åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ã€‚å› ä¸ºä¹‹å‰å·²ç»é€šè¿‡ç¼“å­˜ä½¿ç”¨è¿‡ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨fetch,éœ€è¦å¤åˆ¶ä¸‹è¯¥è¯·æ±‚</span>
      <span class="hljs-keyword">const</span> fetchRequest = event.<span class="hljs-property">request</span>.<span class="hljs-title function_">clone</span>();

      <span class="hljs-comment">// æ²¡æœ‰æ‰¾åˆ°ç¼“å­˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰§è¡Œfetchä»¥å‘èµ·è¯·æ±‚å¹¶è¿”å›è¯·æ±‚æ•°æ®</span>
      <span class="hljs-keyword">return</span> <span class="hljs-title function_">fetch</span>(fetchRequest).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>) {
        <span class="hljs-comment">// æ£€æµ‹è¿”å›æ•°æ®æ˜¯å¦æœ‰æ•ˆ</span>
        <span class="hljs-keyword">if</span> (!response || response.<span class="hljs-property">status</span> !== <span class="hljs-number">200</span> || !response.<span class="hljs-property">type</span> !== <span class="hljs-string">&#x27;basic&#x27;</span>) {
          <span class="hljs-keyword">return</span> response;
        }

        <span class="hljs-comment">// å¤åˆ¶è¿”å›æ•°æ®,å› ä¸ºå®ƒä¹Ÿæ˜¯æµã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦æµè§ˆå™¨å’Œç¼“å­˜ä¸€æ ·ä½¿ç”¨è¿”å›æ•°æ®,æ‰€ä»¥å¿…é¡»å¤åˆ¶å®ƒã€‚è¿™æ ·å°±æœ‰ä¸¤ä¸ªæµ</span>
        <span class="hljs-keyword">const</span> responseToCache = response.<span class="hljs-title function_">clone</span>();

        caches.<span class="hljs-title function_">open</span>(<span class="hljs-variable constant_">CACHE_NAME</span>).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">cache</span>) {
          <span class="hljs-comment">// æŠŠè¯·æ±‚æ·»åŠ åˆ°ç¼“å­˜ä¸­ä»¥å¤‡ä¹‹åçš„æŸ¥è¯¢ç”¨</span>
          cache.<span class="hljs-title function_">put</span>(event.<span class="hljs-property">request</span>, responseToCache);
        });

        <span class="hljs-keyword">return</span> response;
      });
    })
  );
});
</code></pre>
<p>ä¸Šè¿°æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šæœ‰ç¼“å­˜çš„è¯ç›´æ¥è¿”å›ç¼“å­˜æ–‡ä»¶ï¼Œæ²¡ç¼“å­˜çš„è¯è·å–æºæ–‡ä»¶å¹¶è¿”å›ã€‚å¦‚æœåšçš„å¥½çš„è¯ï¼Œå¯ä»¥åœ¨å‘ç°æ²¡ç¼“å­˜çš„æ—¶å€™ï¼ŒæŠŠå®ƒå…ˆç¼“å­˜ä¸‹æ¥ï¼Œå†è¿›è¡Œè¿”å›ã€‚</p>
<p>å¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼š</p>
<ul>
<li><code>event.respondWith()</code> ä¼šå†³å®šå¦‚ä½•å“åº” <code>fetch</code> äº‹ä»¶ã€‚ <code>caches.match()</code> æŸ¥è¯¢è¯·æ±‚ç„¶åè¿”å›ä¹‹å‰åˆ›å»ºçš„ç¼“å­˜ä¸­çš„ä»»æ„ç¼“å­˜æ•°æ®å¹¶è¿”å› promiseã€‚</li>
<li>å¦‚æœæœ‰ï¼Œåˆ™è¿”å›è¯¥ç¼“å­˜æ•°æ®ã€‚</li>
<li>å¦åˆ™ï¼Œæ‰§è¡Œ <code>fetch</code> ã€‚</li>
<li>æ£€æŸ¥è¿”å›çš„çŠ¶æ€ç æ˜¯å¦æ˜¯ <code>200</code>ã€‚åŒæ—¶æ£€æŸ¥å“åº”ç±»å‹æ˜¯å¦ä¸º basicï¼Œå³æ£€æŸ¥è¯·æ±‚æ˜¯å¦åŒåŸŸã€‚å½“å‰åœºæ™¯ä¸ç¼“å­˜ç¬¬ä¸‰æ–¹èµ„æºçš„è¯·æ±‚ã€‚</li>
<li>æŠŠè¿”å›æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚</li>
</ul>
<p>å› ä¸ºè¯·æ±‚å’Œå“åº”éƒ½æ˜¯æµè€Œæµæ•°æ®åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¿…é¡»è¿›è¡Œå¤åˆ¶ã€‚è€Œä¸”ç”±äºç¼“å­˜å’Œæµè§ˆå™¨éƒ½éœ€è¦ä½¿ç”¨å®ƒä»¬ï¼Œæ‰€ä»¥å¿…é¡»è¿›è¡Œå¤åˆ¶ã€‚</p>
<h2>æ›´æ–° Service Worker</h2>
<p>å½“ç”¨æˆ·è®¿é—®ç½‘ç»œåº”ç”¨çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šåœ¨åå°è¯•å›¾é‡æ–°ä¸‹è½½ Service Worker æ–‡ä»¶ã€‚</p>
<p>æµè§ˆå™¨ä¸€æ—¦åˆ¤æ–­åˆ°æ–°çš„æœåŠ¡å·¥ä½œçº¿ç¨‹æ–‡ä»¶ä¸å…¶å½“å‰æ‰€ç”¨æ–‡ä»¶å­˜åœ¨<strong>å­—èŠ‚å·®å¼‚</strong>ï¼Œåˆ™å°†å…¶è§†ä¸ºâ€œæ–°æœåŠ¡å·¥ä½œçº¿ç¨‹â€ã€‚æ¥ä¸‹æ¥å°±ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š</p>
<ol>
<li>æ–°çš„æœåŠ¡å·¥ä½œçº¿ç¨‹å¯åŠ¨ï¼Œå¹¶è§¦å‘ <code>install</code> å®‰è£…äº‹ä»¶ã€‚</li>
<li>æ­¤æ—¶ï¼Œæ—§æœåŠ¡å·¥ä½œçº¿ç¨‹ä»æ§åˆ¶ç€å½“å‰é¡µé¢ï¼Œå› æ­¤æ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å°†è¿›å…¥ <code>waiting</code> ç­‰å¾…çŠ¶æ€ã€‚</li>
<li>å½“ç½‘ç«™ä¸Šå½“å‰æ‰“å¼€çš„é¡µé¢å…³é—­æ—¶ï¼Œæ—§æœåŠ¡å·¥ä½œçº¿ç¨‹å°†ä¼šè¢«ç»ˆæ­¢ï¼Œæ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å°†ä¼šå–å¾—æ§åˆ¶æƒã€‚</li>
<li>æ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å–å¾—æ§åˆ¶æƒåï¼Œå°†ä¼šè§¦å‘å…¶ <code>activate</code> æ¿€æ´»äº‹ä»¶ã€‚</li>
</ol>
<p>é€šå¸¸åœ¨ <code>activate</code> æ¿€æ´»äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¸…é™¤æ—§ç‰ˆæœ¬çš„ç¼“å­˜ã€‚</p>
<p>ä¸ºä»€ä¹ˆæ‰€æœ‰è¿™ä¸€åˆ‡æ˜¯å¿…é¡»çš„å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†é¿å…åœ¨ä¸åŒé€‰é¡¹å¡ä¸­åŒæ—¶è¿è¡Œä¸åŒç‰ˆæœ¬çš„çš„ç½‘ç»œåº”ç”¨æ‰€é€ æˆçš„é—®é¢˜ï¼Œä¸€äº›åœ¨ç½‘é¡µä¸­å®é™…å­˜åœ¨çš„é—®é¢˜ä¸”æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ–°çš„ BUGï¼ˆæ¯”å¦‚å½“åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°å­˜å‚¨æ•°æ®çš„æ—¶å€™å´æ‹¥æœ‰ä¸åŒçš„æ•°æ®åº“ç»“æ„ï¼‰ã€‚</p>
<h2>ä»ç¼“å­˜ä¸­åˆ é™¤æ•°æ®</h2>
<p><code>activate</code> å›è°ƒä¸­æœ€ä¸ºå¸¸è§çš„æ­¥éª¤å³ç¼“å­˜ç®¡ç†ã€‚å› ä¸ºè‹¥æƒ³åˆ é™¤å®‰è£…æ­¥éª¤ä¸­è€æ—§çš„ç¼“å­˜ï¼Œè€Œè¿™åˆä¼šå¯¼è‡´ Service Workers æ— æ³•è·å–è¯¥ç¼“å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œæ‰€ä»¥ï¼Œè¿™æ—¶å€™éœ€è¦è¿›è¡Œç¼“å­˜ç®¡ç†ã€‚</p>
<p>è¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æŠŠæœªåœ¨ç™½åå•ä¸­çš„ç¼“å­˜åˆ é™¤ï¼ˆè¯¥æƒ…å†µä¸‹ï¼Œä»¥ <code>page-1</code> æˆ–è€… <code>page-2</code> æ¥è¿›è¡Œå‘½åï¼‰ï¼š</p>
<pre class="hljs"><code class="language-js">self.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">&#x27;activate&#x27;</span>, <span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) {
  <span class="hljs-keyword">const</span> cacheWhitelist = [<span class="hljs-string">&#x27;page-1&#x27;</span>, <span class="hljs-string">&#x27;page-2&#x27;</span>];

  event.<span class="hljs-title function_">waitUntil</span>(
    <span class="hljs-comment">// è·å¾—ç¼“å­˜ä¸­æ‰€æœ‰é”®</span>
    caches.<span class="hljs-title function_">keys</span>().<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">cacheNames</span>) {
      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(
        <span class="hljs-comment">// éå†æ‰€æœ‰çš„ç¼“å­˜æ–‡ä»¶</span>
        cacheNames.<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span>(<span class="hljs-params">cacheName</span>) {
          <span class="hljs-comment">// è‹¥ç¼“å­˜æ–‡ä»¶ä¸åœ¨ç™½åå•ä¸­ï¼Œåˆ é™¤ä¹‹</span>
          <span class="hljs-keyword">if</span> (cacheWhitelist.<span class="hljs-title function_">indexOf</span>(cacheName) === -<span class="hljs-number">1</span>) {
            <span class="hljs-keyword">return</span> caches.<span class="hljs-title function_">delete</span>(cacheName);
          }
        })
      );
    })
  );
});
</code></pre>
<h2>æ³¨æ„äº‹é¡¹</h2>
<h3>Cookie è®¾ç½®</h3>
<p>åœ¨ Service Worker ä¸­ä½¿ç”¨ <code>fetch</code> çš„æ—¶å€™ï¼Œè¯·æ±‚å¤´ä¸­é»˜è®¤ä¸åŒ…å« Cookieï¼Œå¦‚æœè¦æ·»åŠ  Cookie çš„è¯ï¼Œéœ€è¦å¢åŠ  <code>credentials</code> å‚æ•°ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-title function_">fetch</span>(url, {
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>,
});
</code></pre>
<h3>HTTPS è¦æ±‚</h3>
<p>å½“å¤„äºå¼€å‘é˜¶æ®µçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ localhost æ¥ä½¿ç”¨ Service Workers ï¼Œä½†å½“å¤„äºå‘å¸ƒç¯å¢ƒçš„æ—¶å€™ï¼Œå¿…é¡»éƒ¨ç½²å¥½ HTTPSï¼ˆè¿™ä¹Ÿæ˜¯ä½¿ç”¨ HTTPS çš„æœ€åä¸€ä¸ªåŸå› äº†ï¼‰ã€‚</p>
<p>å¯ä»¥åˆ©ç”¨ Service Worker åŠ«æŒç½‘ç»œè¿æ¥å’Œä¼ªé€ å“åº”æ•°æ®ã€‚å¦‚æœä¸ä½¿ç”¨ HTTPSï¼Œç½‘ç»œåº”ç”¨ä¼šå®¹æ˜“é­å—<a href="https://en.wikipedia.org/wiki/Man-in-the-middle_attack" target="_blank" rel="noopener noreferrer nofollow">ä¸­é—´äºº</a> æ”»å‡»ã€‚</p>
<p>ä¸ºäº†ä¿è¯å®‰å…¨ï¼Œå¿…é¡»é€šè¿‡ HTTPS åœ¨é¡µé¢ä¸Šæ³¨å†Œ Service Workersï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æµè§ˆå™¨æ¥æ”¶åˆ°çš„ Service Worker æ²¡æœ‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚</p>
<h2>åº”ç”¨åœºæ™¯</h2>
<p>ä»¥ä¸‹ç½—åˆ—äº†å‡ ç‚¹å½“å‰ä»¥åŠå°†æ¥ Service Worker èƒ½åšçš„äº‹æƒ…ï¼š</p>
<ul>
<li>æ‹¦æˆªç½‘ç»œ</li>
<li>ç¦»çº¿ç¼“å­˜ï¼šå¯ä»¥å°† H5 åº”ç”¨ä¸­ä¸å˜åŒ–çš„èµ„æºæˆ–è€…å¾ˆå°‘å˜åŒ–çš„èµ„æºé•¿ä¹…çš„å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæå‡åŠ è½½é€Ÿåº¦ã€é™ä½æµé‡æ¶ˆè€—ã€é™ä½æœåŠ¡å™¨å‹åŠ›ã€‚å¦‚ä¸­é‡åº¦çš„ H5 æ¸¸æˆã€æ¡†æ¶æ•°æ®ç‹¬ç«‹çš„ Web èµ„è®¯å®¢æˆ·ç«¯ã€Web é‚®ä»¶å®¢æˆ·ç«¯ç­‰ã€‚</li>
<li>æ¶ˆæ¯æ¨é€ï¼šæ¿€æ´»æ²‰ç¡çš„ç”¨æˆ·ï¼Œæ¨é€å³æ—¶ä¿¡æ¯ã€å…¬å‘Šé€šå‘Šï¼Œæ¿€å‘æ›´æ–°ç­‰ã€‚å¦‚ Web èµ„è®¯å®¢æˆ·ç«¯ã€Web å³æ—¶é€šè®¯å·¥å…·ã€H5 æ¸¸æˆç­‰è¿è¥äº§å“ã€‚</li>
<li>äº‹ä»¶åŒæ­¥ï¼šç¡®ä¿ Web ç«¯äº§ç”Ÿçš„ä»»åŠ¡å³ä½¿åœ¨ç”¨æˆ·å…³é—­äº† Web é¡µé¢ä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆã€‚å¦‚ Web é‚®ä»¶å®¢æˆ·ç«¯ã€Web å³æ—¶é€šè®¯å·¥å…·ç­‰ã€‚</li>
<li>å®šæ—¶åŒæ­¥ï¼ˆæœªæ¥æ”¯æŒï¼‰ï¼šå‘¨æœŸæ€§çš„è§¦å‘ Service Worker è„šæœ¬ä¸­çš„å®šæ—¶åŒæ­¥äº‹ä»¶ï¼Œå¯å€ŸåŠ©å®ƒæå‰åˆ·æ–°ç¼“å­˜å†…å®¹ã€‚å¦‚ Web èµ„è®¯å®¢æˆ·ç«¯ã€‚</li>
<li>åœ°ç†å›´æ ï¼ˆæœªæ¥æ”¯æŒï¼‰ï¼šåœ°ç†å›´æ ï¼ˆGeo-fencingï¼‰æ˜¯ LBS çš„ä¸€ç§æ–°åº”ç”¨ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„æ …æ å›´å‡ºä¸€ä¸ªè™šæ‹Ÿåœ°ç†è¾¹ç•Œã€‚å½“æ‰‹æœºè¿›å…¥ã€ç¦»å¼€æŸä¸ªç‰¹å®šåœ°ç†åŒºåŸŸï¼Œæˆ–åœ¨è¯¥åŒºåŸŸå†…æ´»åŠ¨æ—¶ï¼Œæ‰‹æœºå¯ä»¥æ¥æ”¶è‡ªåŠ¨é€šçŸ¥å’Œè­¦å‘Šã€‚</li>
</ul>
<h2>æµè§ˆå™¨æ”¯æŒæƒ…å†µ</h2>
<p>Service Workers æ‹¥æœ‰è‰¯å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§ã€‚</p>
<pre class="hljs"><code class="language-jsx"><span class="hljs-keyword">import</span> <span class="hljs-title class_">React</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;react&#x27;</span>;
<span class="hljs-keyword">import</span> img <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../../assets/service-worker/server-worker-compatibility.png&#x27;</span>;

<span class="hljs-keyword">export</span> <span class="hljs-title function_">default</span> () =&gt; <span class="language-xml"><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;Service Workers æµè§ˆå™¨å…¼å®¹æ€§&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">{img}</span> <span class="hljs-attr">width</span>=<span class="hljs-string">{800}</span> /&gt;</span></span>;
</code></pre>
<h2>æ€»ç»“</h2>
<p>é™¤äº†ç¦»çº¿ç¼“å­˜å¤–ï¼Œåˆ©ç”¨ Service Worker è¿˜å¯ä»¥åšå¾ˆå¤šä»¤äººå…´å¥‹çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼š</p>
<ul>
<li>å®¢æˆ·ç«¯ç¼–è¯‘ï¼ˆæŠŠåŸæ¥æœ¬åœ°/æœåŠ¡ç«¯ Webpack æ‰“åŒ…ç¼–è¯‘çš„äº‹æƒ…æ”¾åœ¨ <code>client</code> ä¸­ï¼‰</li>
<li>é¢„è¯·æ±‚ Prefetchï¼ˆSSR æ¡†æ¶ next.js æä¾›äº† Link ç»„ä»¶æ¥å®ç°é¢„è¯·æ±‚æ¸²æŸ“ï¼‰</li>
</ul>
<p>åˆ©ç”¨ Service Worker èƒ½å¤§å¤§æå‡ Progress Web Appï¼ˆPWAï¼‰ çš„ä½“éªŒï¼Œç°åœ¨å„å¤§å‚å•†éƒ½è¡¨ç¤ºæ”¯æŒï¼Œä¹Ÿä»£è¡¨äº†æœªæ¥çš„è¶‹åŠ¿ã€‚å¦å¤–ï¼Œ Google æä¾›äº†ä¸€å¥— Service Worker åº“ï¼Œå¯ä»¥æ¶ˆé™¤æœåŠ¡å·¥ä½œçº¿ç¨‹æ ·æ¿æ–‡ä»¶ä»£ç ï¼Œä»è€Œç®€åŒ–å¼€å‘å·¥ä½œã€‚</p>
<ul>
<li><a href="https://github.com/GoogleChrome/sw-precache/" target="_blank" rel="noopener noreferrer nofollow">sw-precache</a>â€”ä¸æ„å»ºæµç¨‹é›†æˆï¼Œä»¥ç”ŸæˆæœåŠ¡å·¥ä½œçº¿ç¨‹ï¼Œç”¨äºé¢„ç¼“å­˜é™æ€èµ„äº§ï¼Œä¾‹å¦‚ Application Shellã€‚</li>
<li><a href="https://github.com/GoogleChrome/sw-toolbox/" target="_blank" rel="noopener noreferrer nofollow">sw-toolbox</a>â€”å®ç°å¸¸è§è¿è¡Œæ—¶ç¼“å­˜æ¨¡å¼ï¼Œä¾‹å¦‚åŠ¨æ€å†…å®¹ã€API è°ƒç”¨ä»¥åŠç¬¬ä¸‰æ–¹èµ„æºï¼Œå®ç°æ–¹æ³•å°±åƒç¼–å†™ README ä¸€æ ·ç®€å•ã€‚</li>
<li>sw-offline-google-analyticsâ€”ä¸´æ—¶ä¿ç•™å¹¶é‡è¯• Analytics è¯·æ±‚ï¼Œä»¥é¿å…è¯·æ±‚å› ç½‘ç»œæ–­å¼€è¿æ¥è€Œä¸¢å¤±ã€‚</li>
</ul>
<hr>
<p><strong>å‚è€ƒæ–‡æ¡£ï¼š</strong></p>
<ul>
<li><a href="https://www.w3.org/TR/service-workers" target="_blank" rel="noopener noreferrer nofollow">å®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼šService Worker</a></li>
<li><a href="https://github.com/Leslie2014/blog/issues/1" target="_blank" rel="noopener noreferrer nofollow">åˆè¯† Service Worker åŠç®€å•åº”ç”¨</a></li>
<li><a href="https://x5.tencent.com/product/service-worker.html" target="_blank" rel="noopener noreferrer nofollow">è…¾è®¯æµè§ˆå™¨æœåŠ¡ï¼šService Worker ç®€ä»‹</a></li>
<li><a href="http://www.fly63.com/article/detial/234" target="_blank" rel="noopener noreferrer nofollow">ServiceWorker çš„ç”Ÿå‘½å‘¨æœŸ</a></li>
<li><a href="https://github.com/neal1991/articles-translator/blob/master/Service%20worker%E4%BB%8B%E7%BB%8D" target="_blank" rel="noopener noreferrer nofollow">Githubï¼šService Worker Explained</a></li>
<li><a href="https://blog.csdn.net/ztguang/article/details/53750479" target="_blank" rel="noopener noreferrer nofollow">CSDNï¼šService Worker å…¥é—¨ - PWA å¼ºä¾èµ–äº Service Worker</a></li>
<li><a href="https://github.com/delapuente/service-workers-101" target="_blank" rel="noopener noreferrer nofollow">ğŸ“Githubï¼šService Worker 101</a></li>
<li><a href="https://jakearchibald.com/2014/service-worker-first-draft/" target="_blank" rel="noopener noreferrer nofollow">Service Worker - first draft published</a></li>
</ul>
</article></div></main><script src="/_next/static/chunks/webpack-53834dba86d90934.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n5:I[6213,[],\"OutletBoundary\"]\n7:I[6213,[],\"MetadataBoundary\"]\n9:I[6213,[],\"ViewportBoundary\"]\nb:I[4835,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/d4dd73d504c89c58.css\",\"style\"]\n:HL[\"/_next/static/css/485ff6fe79292a08.css\",\"style\"]\n:HL[\"/_next/static/css/0ff121a467c0636f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"1zJy3VHENUSg9vzcRvJ6P\",\"p\":\"\",\"c\":[\"\",\"front-end\",\"browser-object-model\",\"offline-and-storage\",\"service-worker\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"front-end\",{\"children\":[[\"slug\",\"browser-object-model/offline-and-storage/service-worker\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/d4dd73d504c89c58.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_4d318d __variable_ea5f4b antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"front-end\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/485ff6fe79292a08.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0ff121a467c0636f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"front-end\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"slug\",\"browser-object-model/offline-and-storage/service-worker\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"front-end\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",null,[\"$\",\"$L5\",null,{\"children\":\"$L6\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"6BJsEhMJC9U5C2KciZYvk\",{\"children\":[[\"$\",\"$L7\",null,{\"children\":\"$L8\"}],[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$b\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:T592f,"])</script><script>self.__next_f.push([1,"\u003ch1\u003eService Worker\u003c/h1\u003e\n\u003cp\u003eService Worker ä¹Ÿç§°æœåŠ¡å·¥ä½œçº¿ç¨‹ï¼Œæ˜¯æµè§ˆå™¨åœ¨åå°ç‹¬ç«‹ç½‘é¡µè¿è¡Œçš„è„šæœ¬ï¼Œä¹Ÿç®—ä½œæ˜¯ JavaScript å·¥ä½œçº¿ç¨‹ã€‚å®ƒæ— æ³•ç›´æ¥è®¿é—® DOMï¼Œå› æ­¤ï¼Œå¦‚æœä½ éœ€è¦æ“ä½œé¡µé¢çš„ DOM èŠ‚ç‚¹çš„è¯ï¼Œå¯ä»¥é€šè¿‡ Â \u003ca href=\"https://html.spec.whatwg.org/multipage/workers.html#dom-worker-postmessage\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003epostMessage\u003c/a\u003eÂ  æ¥è·Ÿæƒ³æ§åˆ¶çš„é¡µé¢è¿›è¡Œé€šä¿¡ã€‚ Service Worker ä¸­çš„ API å¤§é‡é‡‡ç”¨ Promise æ–¹å¼è®¾è®¡ï¼Œå› æ­¤ä»£ç æ¯”è¾ƒå‹å¥½ã€‚\u003c/p\u003e\n\u003cp\u003eåœ¨å…¼å®¹æ€§æ–¹é¢ï¼Œ Chrome Firefox Opera éƒ½å·²ç»æ”¯æŒï¼Œ Microsoft Edge ç°åœ¨ä¹Ÿè¡¨ç¤ºå…¬å¼€æ”¯æŒã€‚è€Œä¹‹å‰ Safari å› ä¸ºä¸è®¡åˆ’æ”¯æŒè¢«å¾ˆå¤šå¼€å‘è€…åæ§½ï¼Œè®¤ä¸ºå®ƒå°†ä¼šæ˜¯ä¸‹ä¸€ä»£ IE ã€‚è¿«äºå‹åŠ›ä¸‹ï¼Œç° Safari ä¹Ÿ\u003ca href=\"https://trac.webkit.org/wiki/FiveYearPlanFall2015\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eæš—ç¤ºæœªæ¥ä¼šè¿›è¡Œå¼€å‘\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœç½‘ç«™è¦ä½¿ç”¨ Service Worker ï¼Œä¼ è¾“åè®®å¿…é¡»ä¸º HTTPS ã€‚å› ä¸º Service Worker ä¸­ä¼šæ¶‰åŠåˆ°è¯·æ±‚æ‹¦æˆªï¼Œæ‰€ä»¥å¿…é¡»ä½¿ç”¨ HTTPS åè®®æ¥ä¿è¯å®‰å…¨ã€‚ å¦å¤–ï¼Œå¦‚æœéœ€è¦æœ¬åœ°è°ƒè¯• Service Worker çš„è¯ï¼ŒÂ \u003ccode\u003elocalhost\u003c/code\u003eÂ  æ˜¯è¢«æ”¯æŒçš„ã€‚\u003c/p\u003e\n\u003ch2\u003eæ¦‚è¿°\u003c/h2\u003e\n\u003cp\u003eè‹¥æƒ³ç†è§£ Service Workers ç›¸å…³çš„ä¸€åˆ‡ï¼Œä½ é¦–å…ˆåº”è¯¥é˜…è¯»ä¸€ä¸‹ä¹‹å‰å‘å¸ƒçš„æœ‰å…³ \u003ca href=\"https://github.com/Troland/how-javascript-works/blob/master/worker\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eWeb Workers\u003c/a\u003e çš„æ–‡ç« ã€‚\u003c/p\u003e\n\u003cp\u003eå¤§ä½“ä¸Šï¼ŒService Worker æ˜¯ä¸€ç§ Web Workerï¼Œæ›´å‡†ç¡®åœ°è¯´ï¼Œå®ƒæ›´åƒæ˜¯ä¸€ä¸ª \u003ca href=\"https://developer.mozilla.org/en-US/docs/Web/API/SharedWorker\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eShared Worker\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eService Worker è¿è¡Œåœ¨å…¶å…¨å±€è„šæœ¬ä¸Šä¸‹æ–‡ä¸­\u003c/li\u003e\n\u003cli\u003eä¸æŒ‡å®šå’ŒæŸä¸ªç½‘é¡µç»‘å®š\u003c/li\u003e\n\u003cli\u003eä¸èƒ½å¤Ÿè®¿é—® DOM\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eService Worker æ¥å£ä¹‹æ‰€ä»¥è®©äººæ„Ÿåˆ°å…´å¥‹çš„åŸå› ä¹‹ä¸€å³å®ƒæ”¯æŒç½‘ç»œåº”ç”¨ç¦»çº¿è¿è¡Œï¼Œè¿™ä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå®Œå…¨æ§åˆ¶ç½‘ç»œåº”ç”¨çš„è¡Œä¸ºã€‚\u003c/p\u003e\n\u003ch2\u003eç”Ÿå‘½å‘¨æœŸ\u003c/h2\u003e\n\u003cp\u003eService Worker çš„ç”Ÿå‘½å‘¨æœŸå’Œç½‘é¡µå®Œå…¨ä¸ç›¸å…³ã€‚å®ƒç”±ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eä¸‹è½½ï¼ˆDownloadï¼‰\u003c/li\u003e\n\u003cli\u003eå®‰è£…ï¼ˆInstallï¼‰\u003c/li\u003e\n\u003cli\u003eæ¿€æ´»ï¼ˆActivateï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eä¸‹è½½\u003c/h3\u003e\n\u003cp\u003eè¿™å‘ç”Ÿäºæµè§ˆå™¨ä¸‹è½½åŒ…å« Service Worker ç›¸å…³ä»£ç çš„ Â \u003ccode\u003e.js\u003c/code\u003eÂ  æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003ch3\u003eå®‰è£…\u003c/h3\u003e\n\u003cp\u003eä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ä¸­ä½¿ç”¨ Service Workerï¼Œé¦–å…ˆå¾—åœ¨ JavaScript ä»£ç ä¸­å¯¹å…¶è¿›è¡Œæ³¨å†Œã€‚å½“ Service Worker æ³¨å†Œçš„æ—¶å€™ï¼Œå®ƒä¼šè®©æµè§ˆå™¨åœ¨åå°å¼€å§‹å®‰è£… Service Worker çš„æ­¥éª¤ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ä½ çš„åº”ç”¨ä¹‹å‰æœªæ³¨å†Œè¿‡ Service Worker çš„è¯ï¼Œé‚£ä¹ˆç¬¬ä¸€æ­¥å°†ä¼šæ˜¯æ³¨å†Œç¯èŠ‚ã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-string\"\u003e\u0026#x27;serviceWorker\u0026#x27;\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003ein\u003c/span\u003e navigator) {\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;load\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    navigator.\u003cspan class=\"hljs-property\"\u003eserviceWorker\u003c/span\u003e\n      .\u003cspan class=\"hljs-title function_\"\u003eregister\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/sw.js\u0026#x27;\u003c/span\u003e)\n      .\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eregisteration\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// success\u003c/span\u003e\n      })\n      .\u003cspan class=\"hljs-title function_\"\u003ecatch\u003c/span\u003e(\u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eerr\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n        \u003cspan class=\"hljs-comment\"\u003e// error\u003c/span\u003e\n      });\n  });\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¯·æ³¨æ„ï¼Œä»¥ä¸Š \u003ccode\u003e'/sw.js'\u003c/code\u003e ä»£è¡¨ Service Worker ä½œç”¨åŸŸçš„èŒƒå›´ä¸ºæ ¹åŸŸï¼ˆä¹Ÿå°±æ˜¯ Service Worker è„šæœ¬çš„ä½ç½®ï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä½ çš„é¡µé¢åœ¨ \u003ccode\u003e'/example/a.html'\u003c/code\u003e ä¸­ä¹Ÿå±äºè¯¥ Service Worker çš„æ§åˆ¶èŒƒå›´ã€‚\u003c/p\u003e\n\u003cp\u003eChrome æµè§ˆå™¨ä¸‹ï¼Œå¯ä»¥åœ¨ Â \u003ccode\u003echrome://inspect /#service-workers\u003c/code\u003eÂ  ä¸­ï¼ŒæŸ¥çœ‹æœåŠ¡å·¥ä½œçº¿ç¨‹æ˜¯å¦å·²ç»æ³¨å†Œã€‚å¦‚æœè°ƒè¯•çš„è¯ï¼Œç”¨éšèº«æ¨¡å¼æ‰“å¼€çª—å£ä¼šéå¸¸æ–¹ä¾¿ï¼Œå› ä¸ºä»éšèº«çª—å£åˆ›å»ºçš„ä»»ä½•æ³¨å†Œå’Œç¼“å­˜åœ¨è¯¥çª—å£å…³é—­åå‡å°†è¢«æ¸…é™¤ã€‚\u003c/p\u003e\n\u003cp\u003eé™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸Šä»£ç æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eéœ€è¦è¿›è¡Œç‰¹æ€§æ£€æµ‹ï¼Œåˆ¤æ–­æµè§ˆå™¨æ˜¯å¦æ”¯æŒã€‚\u003c/li\u003e\n\u003cli\u003eæœ€å¥½åœ¨é¡µé¢æ‰€æœ‰èµ„æºéƒ½å·²ç»åŠ è½½å®Œæ¯•åï¼Œè¿™ä¸ªæ—¶å€™å»åŠ è½½ Service Worker æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„æ—¶é—´ç‚¹ã€‚å› ä¸ºåœ¨ç§»åŠ¨ç«¯ï¼Œé¡µé¢æ‰“å¼€é¦–å±æ—¶é—´éå¸¸å…³é”®ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåœ¨å®‰è£…é˜¶æ®µï¼Œæœ€å¥½åŠ è½½å’Œç¼“å­˜ä¸€äº›é™æ€èµ„æºã€‚ä¸€æ—¦é™æ€èµ„æºç¼“å­˜æˆåŠŸï¼ŒService Worker çš„å®‰è£…ä¹Ÿå°±å®Œæˆäº†ã€‚å€˜è‹¥åŠ è½½å¤±è´¥ï¼Service Worker å°†ä¼šé‡è¯•ã€‚ä¸€æ—¦å®‰è£…æˆåŠŸï¼Œé™æ€èµ„æºä¹Ÿå°±ç¼“å­˜æˆåŠŸäº†ã€‚\u003c/p\u003e\n\u003cp\u003eå‡è®¾ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—®ç½‘ç»œåº”ç”¨ã€‚ç°åœ¨è¿˜æ²¡æœ‰æ³¨å†Œ Service Workerï¼Œè€Œä¸”æµè§ˆå™¨æ— æ³•äº‹å…ˆçŸ¥æ™“æ˜¯å¦ä¼šæœ€ç»ˆå®‰è£…å®ƒã€‚å¦‚æœè¿›è¡Œå®‰è£…ï¼Œåˆ™æµè§ˆå™¨å°†ä¼šä¸ºå¢åŠ çš„çº¿ç¨‹å¼€è¾Ÿé¢å¤–çš„ CPU å’Œå†…å­˜ï¼Œè€Œè¿™äº›èµ„æºåŸæœ¬æ˜¯ç”¨æ¥æ¸²æŸ“ç½‘é¡µçš„ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003eload\u003c/code\u003e äº‹ä»¶ä¼šåŠ è½½å®Œæ‰€æœ‰çš„èµ„æºæ¯”å¦‚å›¾ç‰‡ï¼Œæ ·å¼ä¹‹åè§¦å‘ã€‚\u003c/p\u003e\n\u003cp\u003eæœ€ç»ˆçš„ç»“æœå³æ˜¯å¦‚æœåœ¨é¡µé¢ä¸­å®‰è£… Service Workerï¼Œå°†æœ‰å¯èƒ½å¯¼è‡´é¡µé¢å»¶è¿ŸåŠ è½½å’Œæ¸²æŸ“ï¼ä¸èƒ½å¤Ÿè®©ç”¨æˆ·å°½å¿«åœ°è®¿é—®ç½‘é¡µã€‚\u003c/p\u003e\n\u003cp\u003eéœ€è¦æ³¨æ„çš„æ˜¯è¿™åªä¼šå‘ç”Ÿåœ¨ç¬¬ä¸€æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™ã€‚åç»­çš„é¡µé¢è®¿é—®ä¸ä¼šè¢« Service Worker çš„å®‰è£…æ‰€å½±å“ã€‚ä¸€æ—¦åœ¨é¦–æ¬¡è®¿é—®é¡µé¢çš„æ—¶å€™æ¿€æ´»äº† Service Worker ï¼Œå®ƒå°±å¯ä»¥å¤„ç†åç»­çš„é¡µé¢è®¿é—®æ‰€è§¦å‘çš„é¡µé¢åŠ è½½/ç¼“å­˜äº‹ä»¶ã€‚è¿™æ˜¯æ­£ç¡®çš„ï¼ŒService Worker éœ€è¦åŠ è½½å¥½ä»¥å¤„ç†æœ‰é™çš„ç½‘ç»œå¸¦å®½ã€‚\u003c/p\u003e\n\u003ch3\u003eæ¿€æ´»\u003c/h3\u003e\n\u003cp\u003eå®‰è£…å®Œä¹‹åä¸‹ä¸€æ­¥å³æ¿€æ´»ã€‚è¯¥æ­¥éª¤æ˜¯æ“ä½œä¹‹å‰ç¼“å­˜èµ„æºçš„ç»ä½³æ—¶æœºã€‚\u003c/p\u003e\n\u003cp\u003eä¸€æ—¦æ¿€æ´»ï¼ŒService Worker å°±å¯ä»¥å¼€å§‹æ§åˆ¶åœ¨å…¶ä½œç”¨åŸŸå†…çš„æ‰€æœ‰é¡µé¢ã€‚ä¸€ä¸ªæœ‰è¶£çš„äº‹å®å³ï¼šæ³¨å†Œäº† Service Worker çš„é¡µé¢ç›´åˆ°å†æ¬¡åŠ è½½çš„æ—¶å€™æ‰ä¼šè¢« Service Worker è¿›è¡Œå¤„ç†ã€‚å½“ Service Worker å¼€å§‹è¿›è¡Œæ§åˆ¶ï¼Œå®ƒæœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå¤„ç†æ¥è‡ªé¡µé¢çš„ç½‘ç»œæˆ–è€…æ¶ˆæ¯è¯·æ±‚æ‰€è§¦å‘çš„ fetch åŠ message äº‹ä»¶\u003c/li\u003e\n\u003cli\u003eä¸­æ­¢ä»¥èŠ‚çº¦å†…å­˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ä¸‹å³å…¶ç”Ÿå‘½å‘¨æœŸï¼š\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/front-end/Users/mrsingsing/Desktop/9ffdbf83-64b9-4a9f-a15c-44282fe47d5e.png\" alt=\"ServiceWorkerç”Ÿå‘½å‘¨æœŸ-æ¿€æ´»\"\u003e\u003c/p\u003e\n\u003ch2\u003eå¤„ç† Service Worker å†…éƒ¨çš„å®‰è£…è¿‡ç¨‹\u003c/h2\u003e\n\u003cp\u003eåœ¨å—æ§é¡µé¢è¿è¡Œæ³¨å†Œ Service Worker çš„è¿‡ç¨‹ä¸­ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹ Service Worker è„šæœ¬ä¸­å‘ç”Ÿçš„äº‹æƒ…ï¼Œå®ƒç›‘å¬ Service Worker å®ä¾‹çš„ Â \u003ccode\u003einstall\u003c/code\u003eÂ  äº‹ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eä»¥ä¸‹ä¸ºå¤„ç† \u003ccode\u003einstall\u003c/code\u003e å®‰è£…äº‹ä»¶æ‰€éœ€è¦æ‰§è¡Œçš„æ­¥éª¤ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‰“å¼€ç¼“å­˜ç©ºé—´\u003c/li\u003e\n\u003cli\u003eç¼“å­˜æ–‡ä»¶\u003c/li\u003e\n\u003cli\u003eç¡®è®¤æ˜¯å¦æ‰€æœ‰çš„é™æ€èµ„æºå·²ç¼“å­˜\u003c/li\u003e\n\u003c/ul\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-variable constant_\"\u003eCACHE_NAME\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;my-web-app-cache\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e urlsToCache = [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;/\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/styles/base.css\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/dist/bundle.js\u0026#x27;\u003c/span\u003e];\n\nself.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;install\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-function\"\u003e\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e =\u0026gt;\u003c/span\u003e {\n  \u003cspan class=\"hljs-comment\"\u003e// å¼€å§‹ç¼“å­˜æ–‡ä»¶\u003c/span\u003e\n  \u003cspan class=\"hljs-comment\"\u003e// event.waitUntilä½¿ç”¨promiseæ¥è·å¾—å®‰è£…æ—¶é•¿åŠå®‰è£…æ˜¯å¦å¤±è´¥\u003c/span\u003e\n  event.\u003cspan class=\"hljs-title function_\"\u003ewaitUntil\u003c/span\u003e(\n    caches.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eCACHE_NAME\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecache\u003c/span\u003e) {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;æˆåŠŸæ‰“å¼€ç¼“å­˜ç©ºé—´\u0026#x27;\u003c/span\u003e);\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e cache.\u003cspan class=\"hljs-title function_\"\u003eaddAll\u003c/span\u003e(urlsToCache);\n    })\n  );\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eè¯·æ³¨æ„ï¼Œè¿™é‡Œé¢æœ‰ä¸ªç¼“å­˜ç©ºé—´çš„æ¦‚å¿µï¼Œä¹Ÿå³ \u003ccode\u003ecaches.open\u003c/code\u003e é‡Œçš„å‚æ•°ã€‚å› ä¸ºæ¯ä¸ªé¡µé¢å¯¹åº”çš„ç¼“å­˜ç©ºé—´å¯èƒ½ä¸ç›¸åŒï¼Œæœ‰äº†ç¼“å­˜ç©ºé—´åä¹Ÿèƒ½æ›´å¥½çš„å¯¹ç¼“å­˜è¿›è¡Œæ§åˆ¶ã€‚æ‰“å¼€ç¼“å­˜ç©ºé—´åï¼Œä¹‹åå†è°ƒç”¨ \u003ccode\u003ecache.addAll()\u003c/code\u003e å¹¶ä¼ å…¥æ–‡ä»¶æ•°ç»„è¿›è¡Œç¼“å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eä¸Šè¿°ä¸­ï¼Œæ‰€æœ‰çš„æ–‡ä»¶éƒ½æˆåŠŸç¼“å­˜æ‰ç®—æˆåŠŸï¼Œå¦‚æœæœ‰ä»»ä½•æ–‡ä»¶ä¸‹è½½å¤±è´¥ï¼Œé‚£ä¹ˆå®‰è£…æ­¥éª¤å°±ä¼šå¤±è´¥ã€‚æ‰€ä»¥å¦‚æœç¼“å­˜åˆ—è¡¨è¿‡é•¿çš„è¯ï¼Œå°†ä¼šå¢åŠ ç¼“å­˜å¤±è´¥çš„å‡ ç‡ã€‚\u003c/p\u003e\n\u003cp\u003eå¦‚æœ \u003ccode\u003esw.js\u003c/code\u003e ä¸€ç›´éƒ½ä¸å˜åŒ–çš„è¯ï¼Œé‚£ä¹ˆ \u003ccode\u003einstall\u003c/code\u003e å®‰è£…äº‹ä»¶åªæœ‰åœ¨é¦–æ¬¡å®‰è£…çš„æ—¶å€™æ‰ä¼šè°ƒç”¨ã€‚\u003c/p\u003e\n\u003cp\u003eå¤„ç† Â \u003ccode\u003einstall\u003c/code\u003eÂ  äº‹ä»¶å®Œå…¨æ˜¯å¯é€‰ï¼Œå½“ä¸è¿›è¡Œå¤„ç†çš„æ—¶å€™ï¼Œè·³è¿‡ä»¥ä¸Šå‡ ä¸ªæ­¥éª¤å³å¯ã€‚\u003c/p\u003e\n\u003ch2\u003eç¼“å­˜è¿è¡Œæ—¶è¯·æ±‚\u003c/h2\u003e\n\u003cp\u003eè¯¥éƒ¨åˆ†æ‰æ˜¯å¹²è´§ã€‚åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°å¦‚ä½•æ‹¦æˆªè¯·æ±‚ç„¶åè¿”å›å·²åˆ›å»ºçš„ç¼“å­˜ï¼ˆä»¥åŠåˆ›å»ºæ–°çš„ç¼“å­˜ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eå½“ Service Worker å®‰è£…å®Œæˆä¹‹åï¼Œç”¨æˆ·ä¼šå¯¼èˆªåˆ°å¦ä¸€ä¸ªé¡µé¢æˆ–è€…åˆ·æ–°å½“å‰é¡µé¢ï¼ŒService Worker å°†ä¼šè§¦å‘ fetch äº‹ä»¶ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªæ¼”ç¤ºäº†å¦‚ä½•è¿”å›ç¼“å­˜çš„é™æ€èµ„æºæˆ–æ‰§è¡Œä¸€ä¸ªæ–°çš„è¯·æ±‚å¹¶ç¼“å­˜è¿”å›ç»“æœçš„è¿‡ç¨‹çš„ç¤ºä¾‹ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003eself.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;fetch\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) {\n  event.\u003cspan class=\"hljs-title function_\"\u003erespondWith\u003c/span\u003e(\n    \u003cspan class=\"hljs-comment\"\u003e// è¯¥æ–¹æ³•æŸ¥è¯¢è¯·æ±‚ç„¶åè¿”å›Service Workeråˆ›å»ºçš„ä»»ä½•ç¼“å­˜æ•°æ®\u003c/span\u003e\n    caches.\u003cspan class=\"hljs-title function_\"\u003ematch\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003erequest\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) {\n      \u003cspan class=\"hljs-comment\"\u003e// è‹¥æœ‰ç¼“å­˜,åˆ™è¿”å›\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (response) {\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n      }\n\n      \u003cspan class=\"hljs-comment\"\u003e// å¤åˆ¶è¯·æ±‚ã€‚è¯·æ±‚æ˜¯ä¸€ä¸ªæµä¸”åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ã€‚å› ä¸ºä¹‹å‰å·²ç»é€šè¿‡ç¼“å­˜ä½¿ç”¨è¿‡ä¸€æ¬¡äº†ï¼Œæ‰€ä»¥ä¸ºäº†åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨fetch,éœ€è¦å¤åˆ¶ä¸‹è¯¥è¯·æ±‚\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fetchRequest = event.\u003cspan class=\"hljs-property\"\u003erequest\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eclone\u003c/span\u003e();\n\n      \u003cspan class=\"hljs-comment\"\u003e// æ²¡æœ‰æ‰¾åˆ°ç¼“å­˜ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ‰§è¡Œfetchä»¥å‘èµ·è¯·æ±‚å¹¶è¿”å›è¯·æ±‚æ•°æ®\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(fetchRequest).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eresponse\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment\"\u003e// æ£€æµ‹è¿”å›æ•°æ®æ˜¯å¦æœ‰æ•ˆ\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (!response || response.\u003cspan class=\"hljs-property\"\u003estatus\u003c/span\u003e !== \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e || !response.\u003cspan class=\"hljs-property\"\u003etype\u003c/span\u003e !== \u003cspan class=\"hljs-string\"\u003e\u0026#x27;basic\u0026#x27;\u003c/span\u003e) {\n          \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n        }\n\n        \u003cspan class=\"hljs-comment\"\u003e// å¤åˆ¶è¿”å›æ•°æ®,å› ä¸ºå®ƒä¹Ÿæ˜¯æµã€‚å› ä¸ºæˆ‘ä»¬æƒ³è¦æµè§ˆå™¨å’Œç¼“å­˜ä¸€æ ·ä½¿ç”¨è¿”å›æ•°æ®,æ‰€ä»¥å¿…é¡»å¤åˆ¶å®ƒã€‚è¿™æ ·å°±æœ‰ä¸¤ä¸ªæµ\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e responseToCache = response.\u003cspan class=\"hljs-title function_\"\u003eclone\u003c/span\u003e();\n\n        caches.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-variable constant_\"\u003eCACHE_NAME\u003c/span\u003e).\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecache\u003c/span\u003e) {\n          \u003cspan class=\"hljs-comment\"\u003e// æŠŠè¯·æ±‚æ·»åŠ åˆ°ç¼“å­˜ä¸­ä»¥å¤‡ä¹‹åçš„æŸ¥è¯¢ç”¨\u003c/span\u003e\n          cache.\u003cspan class=\"hljs-title function_\"\u003eput\u003c/span\u003e(event.\u003cspan class=\"hljs-property\"\u003erequest\u003c/span\u003e, responseToCache);\n        });\n\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e response;\n      });\n    })\n  );\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eä¸Šè¿°æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼šæœ‰ç¼“å­˜çš„è¯ç›´æ¥è¿”å›ç¼“å­˜æ–‡ä»¶ï¼Œæ²¡ç¼“å­˜çš„è¯è·å–æºæ–‡ä»¶å¹¶è¿”å›ã€‚å¦‚æœåšçš„å¥½çš„è¯ï¼Œå¯ä»¥åœ¨å‘ç°æ²¡ç¼“å­˜çš„æ—¶å€™ï¼ŒæŠŠå®ƒå…ˆç¼“å­˜ä¸‹æ¥ï¼Œå†è¿›è¡Œè¿”å›ã€‚\u003c/p\u003e\n\u003cp\u003eå¤§æ¦‚çš„æµç¨‹å¦‚ä¸‹ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eevent.respondWith()\u003c/code\u003e ä¼šå†³å®šå¦‚ä½•å“åº” \u003ccode\u003efetch\u003c/code\u003e äº‹ä»¶ã€‚ \u003ccode\u003ecaches.match()\u003c/code\u003e æŸ¥è¯¢è¯·æ±‚ç„¶åè¿”å›ä¹‹å‰åˆ›å»ºçš„ç¼“å­˜ä¸­çš„ä»»æ„ç¼“å­˜æ•°æ®å¹¶è¿”å› promiseã€‚\u003c/li\u003e\n\u003cli\u003eå¦‚æœæœ‰ï¼Œåˆ™è¿”å›è¯¥ç¼“å­˜æ•°æ®ã€‚\u003c/li\u003e\n\u003cli\u003eå¦åˆ™ï¼Œæ‰§è¡Œ \u003ccode\u003efetch\u003c/code\u003e ã€‚\u003c/li\u003e\n\u003cli\u003eæ£€æŸ¥è¿”å›çš„çŠ¶æ€ç æ˜¯å¦æ˜¯ \u003ccode\u003e200\u003c/code\u003eã€‚åŒæ—¶æ£€æŸ¥å“åº”ç±»å‹æ˜¯å¦ä¸º basicï¼Œå³æ£€æŸ¥è¯·æ±‚æ˜¯å¦åŒåŸŸã€‚å½“å‰åœºæ™¯ä¸ç¼“å­˜ç¬¬ä¸‰æ–¹èµ„æºçš„è¯·æ±‚ã€‚\u003c/li\u003e\n\u003cli\u003eæŠŠè¿”å›æ•°æ®æ·»åŠ åˆ°ç¼“å­˜ä¸­ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå› ä¸ºè¯·æ±‚å’Œå“åº”éƒ½æ˜¯æµè€Œæµæ•°æ®åªèƒ½è¢«ä½¿ç”¨ä¸€æ¬¡ï¼Œæ‰€ä»¥å¿…é¡»è¿›è¡Œå¤åˆ¶ã€‚è€Œä¸”ç”±äºç¼“å­˜å’Œæµè§ˆå™¨éƒ½éœ€è¦ä½¿ç”¨å®ƒä»¬ï¼Œæ‰€ä»¥å¿…é¡»è¿›è¡Œå¤åˆ¶ã€‚\u003c/p\u003e\n\u003ch2\u003eæ›´æ–° Service Worker\u003c/h2\u003e\n\u003cp\u003eå½“ç”¨æˆ·è®¿é—®ç½‘ç»œåº”ç”¨çš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šåœ¨åå°è¯•å›¾é‡æ–°ä¸‹è½½ Service Worker æ–‡ä»¶ã€‚\u003c/p\u003e\n\u003cp\u003eæµè§ˆå™¨ä¸€æ—¦åˆ¤æ–­åˆ°æ–°çš„æœåŠ¡å·¥ä½œçº¿ç¨‹æ–‡ä»¶ä¸å…¶å½“å‰æ‰€ç”¨æ–‡ä»¶å­˜åœ¨\u003cstrong\u003eå­—èŠ‚å·®å¼‚\u003c/strong\u003eï¼Œåˆ™å°†å…¶è§†ä¸ºâ€œæ–°æœåŠ¡å·¥ä½œçº¿ç¨‹â€ã€‚æ¥ä¸‹æ¥å°±ä¼šåšä»¥ä¸‹äº‹æƒ…ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eæ–°çš„æœåŠ¡å·¥ä½œçº¿ç¨‹å¯åŠ¨ï¼Œå¹¶è§¦å‘ \u003ccode\u003einstall\u003c/code\u003e å®‰è£…äº‹ä»¶ã€‚\u003c/li\u003e\n\u003cli\u003eæ­¤æ—¶ï¼Œæ—§æœåŠ¡å·¥ä½œçº¿ç¨‹ä»æ§åˆ¶ç€å½“å‰é¡µé¢ï¼Œå› æ­¤æ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å°†è¿›å…¥ \u003ccode\u003ewaiting\u003c/code\u003e ç­‰å¾…çŠ¶æ€ã€‚\u003c/li\u003e\n\u003cli\u003eå½“ç½‘ç«™ä¸Šå½“å‰æ‰“å¼€çš„é¡µé¢å…³é—­æ—¶ï¼Œæ—§æœåŠ¡å·¥ä½œçº¿ç¨‹å°†ä¼šè¢«ç»ˆæ­¢ï¼Œæ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å°†ä¼šå–å¾—æ§åˆ¶æƒã€‚\u003c/li\u003e\n\u003cli\u003eæ–°æœåŠ¡å·¥ä½œçº¿ç¨‹å–å¾—æ§åˆ¶æƒåï¼Œå°†ä¼šè§¦å‘å…¶ \u003ccode\u003eactivate\u003c/code\u003e æ¿€æ´»äº‹ä»¶ã€‚\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eé€šå¸¸åœ¨ \u003ccode\u003eactivate\u003c/code\u003e æ¿€æ´»äº‹ä»¶ä¸­ï¼Œæˆ‘ä»¬ä¼šæ¸…é™¤æ—§ç‰ˆæœ¬çš„ç¼“å­˜ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºä»€ä¹ˆæ‰€æœ‰è¿™ä¸€åˆ‡æ˜¯å¿…é¡»çš„å‘¢ï¼Ÿè¿™æ˜¯ä¸ºäº†é¿å…åœ¨ä¸åŒé€‰é¡¹å¡ä¸­åŒæ—¶è¿è¡Œä¸åŒç‰ˆæœ¬çš„çš„ç½‘ç»œåº”ç”¨æ‰€é€ æˆçš„é—®é¢˜ï¼Œä¸€äº›åœ¨ç½‘é¡µä¸­å®é™…å­˜åœ¨çš„é—®é¢˜ä¸”æœ‰å¯èƒ½ä¼šäº§ç”Ÿæ–°çš„ BUGï¼ˆæ¯”å¦‚å½“åœ¨æµè§ˆå™¨ä¸­æœ¬åœ°å­˜å‚¨æ•°æ®çš„æ—¶å€™å´æ‹¥æœ‰ä¸åŒçš„æ•°æ®åº“ç»“æ„ï¼‰ã€‚\u003c/p\u003e\n\u003ch2\u003eä»ç¼“å­˜ä¸­åˆ é™¤æ•°æ®\u003c/h2\u003e\n\u003cp\u003e\u003ccode\u003eactivate\u003c/code\u003e å›è°ƒä¸­æœ€ä¸ºå¸¸è§çš„æ­¥éª¤å³ç¼“å­˜ç®¡ç†ã€‚å› ä¸ºè‹¥æƒ³åˆ é™¤å®‰è£…æ­¥éª¤ä¸­è€æ—§çš„ç¼“å­˜ï¼Œè€Œè¿™åˆä¼šå¯¼è‡´ Service Workers æ— æ³•è·å–è¯¥ç¼“å­˜ä¸­çš„æ–‡ä»¶æ•°æ®ï¼Œæ‰€ä»¥ï¼Œè¿™æ—¶å€™éœ€è¦è¿›è¡Œç¼“å­˜ç®¡ç†ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™é‡Œæœ‰ä¸€ä¸ªç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•æŠŠæœªåœ¨ç™½åå•ä¸­çš„ç¼“å­˜åˆ é™¤ï¼ˆè¯¥æƒ…å†µä¸‹ï¼Œä»¥ \u003ccode\u003epage-1\u003c/code\u003e æˆ–è€… \u003ccode\u003epage-2\u003c/code\u003e æ¥è¿›è¡Œå‘½åï¼‰ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003eself.\u003cspan class=\"hljs-title function_\"\u003eaddEventListener\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;activate\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003eevent\u003c/span\u003e) {\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cacheWhitelist = [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;page-1\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;page-2\u0026#x27;\u003c/span\u003e];\n\n  event.\u003cspan class=\"hljs-title function_\"\u003ewaitUntil\u003c/span\u003e(\n    \u003cspan class=\"hljs-comment\"\u003e// è·å¾—ç¼“å­˜ä¸­æ‰€æœ‰é”®\u003c/span\u003e\n    caches.\u003cspan class=\"hljs-title function_\"\u003ekeys\u003c/span\u003e().\u003cspan class=\"hljs-title function_\"\u003ethen\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecacheNames\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003ePromise\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eall\u003c/span\u003e(\n        \u003cspan class=\"hljs-comment\"\u003e// éå†æ‰€æœ‰çš„ç¼“å­˜æ–‡ä»¶\u003c/span\u003e\n        cacheNames.\u003cspan class=\"hljs-title function_\"\u003emap\u003c/span\u003e(\u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003ecacheName\u003c/span\u003e) {\n          \u003cspan class=\"hljs-comment\"\u003e// è‹¥ç¼“å­˜æ–‡ä»¶ä¸åœ¨ç™½åå•ä¸­ï¼Œåˆ é™¤ä¹‹\u003c/span\u003e\n          \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (cacheWhitelist.\u003cspan class=\"hljs-title function_\"\u003eindexOf\u003c/span\u003e(cacheName) === -\u003cspan class=\"hljs-number\"\u003e1\u003c/span\u003e) {\n            \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e caches.\u003cspan class=\"hljs-title function_\"\u003edelete\u003c/span\u003e(cacheName);\n          }\n        })\n      );\n    })\n  );\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eæ³¨æ„äº‹é¡¹\u003c/h2\u003e\n\u003ch3\u003eCookie è®¾ç½®\u003c/h3\u003e\n\u003cp\u003eåœ¨ Service Worker ä¸­ä½¿ç”¨ \u003ccode\u003efetch\u003c/code\u003e çš„æ—¶å€™ï¼Œè¯·æ±‚å¤´ä¸­é»˜è®¤ä¸åŒ…å« Cookieï¼Œå¦‚æœè¦æ·»åŠ  Cookie çš„è¯ï¼Œéœ€è¦å¢åŠ  \u003ccode\u003ecredentials\u003c/code\u003e å‚æ•°ã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-title function_\"\u003efetch\u003c/span\u003e(url, {\n  \u003cspan class=\"hljs-attr\"\u003ecredentials\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;include\u0026#x27;\u003c/span\u003e,\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003eHTTPS è¦æ±‚\u003c/h3\u003e\n\u003cp\u003eå½“å¤„äºå¼€å‘é˜¶æ®µçš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ localhost æ¥ä½¿ç”¨ Service Workers ï¼Œä½†å½“å¤„äºå‘å¸ƒç¯å¢ƒçš„æ—¶å€™ï¼Œå¿…é¡»éƒ¨ç½²å¥½ HTTPSï¼ˆè¿™ä¹Ÿæ˜¯ä½¿ç”¨ HTTPS çš„æœ€åä¸€ä¸ªåŸå› äº†ï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003eå¯ä»¥åˆ©ç”¨ Service Worker åŠ«æŒç½‘ç»œè¿æ¥å’Œä¼ªé€ å“åº”æ•°æ®ã€‚å¦‚æœä¸ä½¿ç”¨ HTTPSï¼Œç½‘ç»œåº”ç”¨ä¼šå®¹æ˜“é­å—\u003ca href=\"https://en.wikipedia.org/wiki/Man-in-the-middle_attack\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eä¸­é—´äºº\u003c/a\u003e æ”»å‡»ã€‚\u003c/p\u003e\n\u003cp\u003eä¸ºäº†ä¿è¯å®‰å…¨ï¼Œå¿…é¡»é€šè¿‡ HTTPS åœ¨é¡µé¢ä¸Šæ³¨å†Œ Service Workersï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯æµè§ˆå™¨æ¥æ”¶åˆ°çš„ Service Worker æ²¡æœ‰åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹ã€‚\u003c/p\u003e\n\u003ch2\u003eåº”ç”¨åœºæ™¯\u003c/h2\u003e\n\u003cp\u003eä»¥ä¸‹ç½—åˆ—äº†å‡ ç‚¹å½“å‰ä»¥åŠå°†æ¥ Service Worker èƒ½åšçš„äº‹æƒ…ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eæ‹¦æˆªç½‘ç»œ\u003c/li\u003e\n\u003cli\u003eç¦»çº¿ç¼“å­˜ï¼šå¯ä»¥å°† H5 åº”ç”¨ä¸­ä¸å˜åŒ–çš„èµ„æºæˆ–è€…å¾ˆå°‘å˜åŒ–çš„èµ„æºé•¿ä¹…çš„å­˜å‚¨åœ¨å®¢æˆ·ç«¯ï¼Œæå‡åŠ è½½é€Ÿåº¦ã€é™ä½æµé‡æ¶ˆè€—ã€é™ä½æœåŠ¡å™¨å‹åŠ›ã€‚å¦‚ä¸­é‡åº¦çš„ H5 æ¸¸æˆã€æ¡†æ¶æ•°æ®ç‹¬ç«‹çš„ Web èµ„è®¯å®¢æˆ·ç«¯ã€Web é‚®ä»¶å®¢æˆ·ç«¯ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003eæ¶ˆæ¯æ¨é€ï¼šæ¿€æ´»æ²‰ç¡çš„ç”¨æˆ·ï¼Œæ¨é€å³æ—¶ä¿¡æ¯ã€å…¬å‘Šé€šå‘Šï¼Œæ¿€å‘æ›´æ–°ç­‰ã€‚å¦‚ Web èµ„è®¯å®¢æˆ·ç«¯ã€Web å³æ—¶é€šè®¯å·¥å…·ã€H5 æ¸¸æˆç­‰è¿è¥äº§å“ã€‚\u003c/li\u003e\n\u003cli\u003eäº‹ä»¶åŒæ­¥ï¼šç¡®ä¿ Web ç«¯äº§ç”Ÿçš„ä»»åŠ¡å³ä½¿åœ¨ç”¨æˆ·å…³é—­äº† Web é¡µé¢ä¹Ÿå¯ä»¥é¡ºåˆ©å®Œæˆã€‚å¦‚ Web é‚®ä»¶å®¢æˆ·ç«¯ã€Web å³æ—¶é€šè®¯å·¥å…·ç­‰ã€‚\u003c/li\u003e\n\u003cli\u003eå®šæ—¶åŒæ­¥ï¼ˆæœªæ¥æ”¯æŒï¼‰ï¼šå‘¨æœŸæ€§çš„è§¦å‘ Service Worker è„šæœ¬ä¸­çš„å®šæ—¶åŒæ­¥äº‹ä»¶ï¼Œå¯å€ŸåŠ©å®ƒæå‰åˆ·æ–°ç¼“å­˜å†…å®¹ã€‚å¦‚ Web èµ„è®¯å®¢æˆ·ç«¯ã€‚\u003c/li\u003e\n\u003cli\u003eåœ°ç†å›´æ ï¼ˆæœªæ¥æ”¯æŒï¼‰ï¼šåœ°ç†å›´æ ï¼ˆGeo-fencingï¼‰æ˜¯ LBS çš„ä¸€ç§æ–°åº”ç”¨ï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªè™šæ‹Ÿçš„æ …æ å›´å‡ºä¸€ä¸ªè™šæ‹Ÿåœ°ç†è¾¹ç•Œã€‚å½“æ‰‹æœºè¿›å…¥ã€ç¦»å¼€æŸä¸ªç‰¹å®šåœ°ç†åŒºåŸŸï¼Œæˆ–åœ¨è¯¥åŒºåŸŸå†…æ´»åŠ¨æ—¶ï¼Œæ‰‹æœºå¯ä»¥æ¥æ”¶è‡ªåŠ¨é€šçŸ¥å’Œè­¦å‘Šã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eæµè§ˆå™¨æ”¯æŒæƒ…å†µ\u003c/h2\u003e\n\u003cp\u003eService Workers æ‹¥æœ‰è‰¯å¥½çš„æµè§ˆå™¨å…¼å®¹æ€§ã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-jsx\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eReact\u003c/span\u003e \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;react\u0026#x27;\u003c/span\u003e;\n\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e img \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;../../assets/service-worker/server-worker-compatibility.png\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003eexport\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003edefault\u003c/span\u003e () =\u0026gt; \u003cspan class=\"language-xml\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eimg\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ealt\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;Service Workers æµè§ˆå™¨å…¼å®¹æ€§\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{img}\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003ewidth\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e{800}\u003c/span\u003e /\u0026gt;\u003c/span\u003e\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eæ€»ç»“\u003c/h2\u003e\n\u003cp\u003eé™¤äº†ç¦»çº¿ç¼“å­˜å¤–ï¼Œåˆ©ç”¨ Service Worker è¿˜å¯ä»¥åšå¾ˆå¤šä»¤äººå…´å¥‹çš„åŠŸèƒ½ã€‚æ¯”å¦‚ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eå®¢æˆ·ç«¯ç¼–è¯‘ï¼ˆæŠŠåŸæ¥æœ¬åœ°/æœåŠ¡ç«¯ Webpack æ‰“åŒ…ç¼–è¯‘çš„äº‹æƒ…æ”¾åœ¨ \u003ccode\u003eclient\u003c/code\u003e ä¸­ï¼‰\u003c/li\u003e\n\u003cli\u003eé¢„è¯·æ±‚ Prefetchï¼ˆSSR æ¡†æ¶ next.js æä¾›äº† Link ç»„ä»¶æ¥å®ç°é¢„è¯·æ±‚æ¸²æŸ“ï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eåˆ©ç”¨ Service Worker èƒ½å¤§å¤§æå‡ Progress Web Appï¼ˆPWAï¼‰ çš„ä½“éªŒï¼Œç°åœ¨å„å¤§å‚å•†éƒ½è¡¨ç¤ºæ”¯æŒï¼Œä¹Ÿä»£è¡¨äº†æœªæ¥çš„è¶‹åŠ¿ã€‚å¦å¤–ï¼Œ Google æä¾›äº†ä¸€å¥— Service Worker åº“ï¼Œå¯ä»¥æ¶ˆé™¤æœåŠ¡å·¥ä½œçº¿ç¨‹æ ·æ¿æ–‡ä»¶ä»£ç ï¼Œä»è€Œç®€åŒ–å¼€å‘å·¥ä½œã€‚\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/GoogleChrome/sw-precache/\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003esw-precache\u003c/a\u003eâ€”ä¸æ„å»ºæµç¨‹é›†æˆï¼Œä»¥ç”ŸæˆæœåŠ¡å·¥ä½œçº¿ç¨‹ï¼Œç”¨äºé¢„ç¼“å­˜é™æ€èµ„äº§ï¼Œä¾‹å¦‚ Application Shellã€‚\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/GoogleChrome/sw-toolbox/\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003esw-toolbox\u003c/a\u003eâ€”å®ç°å¸¸è§è¿è¡Œæ—¶ç¼“å­˜æ¨¡å¼ï¼Œä¾‹å¦‚åŠ¨æ€å†…å®¹ã€API è°ƒç”¨ä»¥åŠç¬¬ä¸‰æ–¹èµ„æºï¼Œå®ç°æ–¹æ³•å°±åƒç¼–å†™ README ä¸€æ ·ç®€å•ã€‚\u003c/li\u003e\n\u003cli\u003esw-offline-google-analyticsâ€”ä¸´æ—¶ä¿ç•™å¹¶é‡è¯• Analytics è¯·æ±‚ï¼Œä»¥é¿å…è¯·æ±‚å› ç½‘ç»œæ–­å¼€è¿æ¥è€Œä¸¢å¤±ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003chr\u003e\n\u003cp\u003e\u003cstrong\u003eå‚è€ƒæ–‡æ¡£ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://www.w3.org/TR/service-workers\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eå®˜æ–¹è‹±æ–‡æ–‡æ¡£ï¼šService Worker\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/Leslie2014/blog/issues/1\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eåˆè¯† Service Worker åŠç®€å•åº”ç”¨\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://x5.tencent.com/product/service-worker.html\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eè…¾è®¯æµè§ˆå™¨æœåŠ¡ï¼šService Worker ç®€ä»‹\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.fly63.com/article/detial/234\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eServiceWorker çš„ç”Ÿå‘½å‘¨æœŸ\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/neal1991/articles-translator/blob/master/Service%20worker%E4%BB%8B%E7%BB%8D\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eGithubï¼šService Worker Explained\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://blog.csdn.net/ztguang/article/details/53750479\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eCSDNï¼šService Worker å…¥é—¨ - PWA å¼ºä¾èµ–äº Service Worker\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://github.com/delapuente/service-workers-101\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eğŸ“Githubï¼šService Worker 101\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://jakearchibald.com/2014/service-worker-first-draft/\" target=\"_blank\" rel=\"noopener noreferrer nofollow\"\u003eService Worker - first draft published\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"markdown-body\",\"children\":[\"$\",\"article\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$c\"}}]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"front-end\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"front-end knowledge\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script></body></html>