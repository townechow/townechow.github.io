1:"$Sreact.fragment"
2:I[5244,[],""]
3:I[3866,[],""]
5:I[6213,[],"OutletBoundary"]
7:I[6213,[],"MetadataBoundary"]
9:I[6213,[],"ViewportBoundary"]
b:I[4835,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/ec0a9d078e716e00.css","style"]
:HL["/_next/static/css/485ff6fe79292a08.css","style"]
:HL["/_next/static/css/0ff121a467c0636f.css","style"]
0:{"P":null,"b":"NW9bMA21iAaih0TqCHqj1","p":"","c":["","front-end","core-modules","ecmascript-function-objects","function-declarations","async-function-definitions"],"i":false,"f":[[["",{"children":["front-end",{"children":[["slug","core-modules/ecmascript-function-objects/function-declarations/async-function-definitions","oc"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/ec0a9d078e716e00.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_4d318d __variable_ea5f4b antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":["front-end",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/485ff6fe79292a08.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/0ff121a467c0636f.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","main",null,{"children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","front-end","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]}]]}],{"children":[["slug","core-modules/ecmascript-function-objects/function-declarations/async-function-definitions","oc"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","front-end","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L4",null,["$","$L5",null,{"children":"$L6"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","tBwTgKC7DWld2xj2PFaZ1",{"children":[["$","$L7",null,{"children":"$L8"}],["$","$L9",null,{"children":"$La"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$b","$undefined"],"s":false,"S":true}
c:T784f,<h1>å¼‚æ­¥å‡½æ•°</h1>
<p><code>async</code> å‡½æ•°æ˜¯ <a href="/front-end/standard-built-in-objects/control-abstraction-objects/generator">Generator</a> å‡½æ•°çš„è¯­æ³•ç³–ã€‚ä½¿ç”¨å…³é”®å­— <code>async</code> æ¥è¡¨ç¤ºï¼Œåœ¨å‡½æ•°å†…éƒ¨æ˜¯ä½¿ç”¨ <code>await</code> å‘½ä»¤æ¥è¡¨ç¤ºå¼‚æ­¥ã€‚</p>
<p>ç›¸è¾ƒäº Generatorï¼Œ<code>async</code> å‡½æ•°çš„æ”¹è¿›åœ¨äºä»¥ä¸‹å››ç‚¹ï¼š</p>
<ul>
<li><strong>å†…ç½®æ‰§è¡Œå™¨</strong>ï¼šGenerator å‡½æ•°çš„æ‰§è¡Œå¿…é¡»é æ‰§è¡Œå™¨ï¼Œè€Œ <code>async</code> å‡½æ•°è‡ªå¸¦æ‰§è¡Œå™¨ï¼Œè°ƒç”¨æ–¹å¼ä¸æ™®é€šå‡½æ•°ä¸€è‡´ã€‚</li>
<li><strong>æ›´å¥½çš„è¯­ä¹‰</strong>ï¼š<code>async</code> å’Œ <code>await</code> ç›¸è¾ƒäºæ˜Ÿå·ï¼ˆ<code>*</code>ï¼‰å’Œ <code>yield</code> æ›´åŠ è¯­ä¹‰åŒ–ã€‚<code>async</code> è¡¨ç¤ºå‡½æ•°ä¸­æœ‰å¼‚æ­¥æ“ä½œï¼Œ<code>await</code> è¡¨ç¤ºç´§è·Ÿåœ¨åé¢çš„è¡¨è¾¾å¼éœ€è¦ç­‰å¾…ç»“æœã€‚</li>
<li><strong>æ›´å¹¿çš„é€‚ç”¨æ€§</strong>ï¼š<code>co</code> æ¨¡å—çº¦å®šï¼Œ<code>yield</code> å‘½ä»¤åé¢åªèƒ½æ˜¯ Thunk å‡½æ•°æˆ– Promise å¯¹è±¡ï¼Œè€Œ <code>async</code> å‡½æ•°çš„ <code>await</code> å‘½ä»¤åé¢åˆ™å¯ä»¥æ˜¯ Promise å’ŒåŸå§‹ç±»å‹çš„å€¼ï¼ˆNumberã€String å’Œ Booleanï¼Œä½†è¿™æ—¶ä¼šè‡ªåŠ¨è½¬æˆç«‹å³ <code>fulfilled</code> çŠ¶æ€çš„ Promise å¯¹è±¡ï¼‰ã€‚</li>
<li><strong>è¿”å›å€¼æ˜¯ Promise</strong>ï¼š<code>async</code> å‡½æ•°çš„è¿”å›å€¼æ˜¯ Promise å¯¹è±¡ï¼Œè¿™æ¯” Generator å‡½æ•°çš„è¿”å›å€¼æ˜¯ Iterator å¯¹è±¡æ–¹ä¾¿å¤šäº†ã€‚ä½ å¯ä»¥ç”¨ <code>then</code> æ–¹æ³•æŒ‡å®šä¸‹ä¸€æ­¥çš„æ“ä½œã€‚</li>
</ul>
<p>è¿›ä¸€æ­¥è¯´ï¼Œ<code>async</code> å‡½æ•°å®Œå…¨å¯ä»¥çœ‹ä½œå¤šä¸ªå¼‚æ­¥æ“ä½œï¼ŒåŒ…è£…æˆçš„ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè€Œ <code>await</code> å‘½ä»¤å°±æ˜¯å†…éƒ¨ <code>then</code> å‘½ä»¤çš„è¯­æ³•ç³–ã€‚</p>
<p><strong><code>async</code>å‡½æ•°ä¸ Generator å‡½æ•°çš„å¯¹æ¯”</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left"></th>
<th style="text-align:left">async å‡½æ•°</th>
<th style="text-align:left">Generator å‡½æ•°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>å®šä¹‰æ–¹å¼</strong></td>
<td style="text-align:left"><code>async function(){}</code></td>
<td style="text-align:left"><code>function* (){}</code></td>
</tr>
<tr>
<td style="text-align:left"><strong>å¼‚æ­¥è¯­å¥å‘½ä»¤</strong></td>
<td style="text-align:left"><code>await</code></td>
<td style="text-align:left"><code>yield</code></td>
</tr>
</tbody>
</table>
<h2>åŸºæœ¬ç”¨æ³•</h2>
<h3>å¼‚æ­¥å‡½æ•°çš„å£°æ˜</h3>
<p>å‡¡æ˜¯åœ¨å‡½æ•°å£°æ˜å‰æ·»åŠ  <code>async</code> å…³é”®å­—çš„å‡½æ•°åœ¨æ‰§è¡Œåéƒ½ä¼šè‡ªåŠ¨è¿”å› Promise å¯¹è±¡ã€‚</p>
<p><code>async</code> å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨ <code>then</code> æ–¹æ³•æ·»åŠ å›è°ƒå‡½æ•°ã€‚å½“å‡½æ•°æ‰§è¡Œçš„æ—¶å€™ï¼Œä¸€æ—¦é‡åˆ° <code>await</code> å°±ä¼šå…ˆè¿”å›ï¼Œç­‰åˆ°å¼‚æ­¥æ“ä½œå®Œæˆï¼Œå†æ¥ç€æ‰§è¡Œå‡½æ•°ä½“å†…åé¢çš„è¯­å¥ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">timeout</span>(<span class="hljs-params">ms</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, ms));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">arg1, ms</span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">timeout</span>(ms);
  <span class="hljs-keyword">return</span> arg1;
}

<span class="hljs-title function_">foo</span>(<span class="hljs-string">&#x27;Hello world!&#x27;</span>, <span class="hljs-number">500</span>).<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
<span class="hljs-comment">// &#x27;Hello world!&#x27;</span>
</code></pre>
<h3>å¼‚æ­¥å‡½æ•°çš„è¯­å¥</h3>
<p><code>await</code> å‘½ä»¤å¿…é¡»åœ¨ <code>async</code> å‡½æ•°é‡Œä½¿ç”¨ï¼Œä¸èƒ½å•ç‹¬ä½¿ç”¨ã€‚</p>
<p>ç”±äº <code>async</code> å‡½æ•°è¿”å›çš„æ˜¯ Promise å¯¹è±¡ï¼Œå¯ä»¥ä½œä¸º <code>await</code> å‘½ä»¤çš„å‚æ•°ã€‚</p>
<h3>å¼‚æ­¥è¯­å¥è¿”å›å€¼</h3>
<p><code>await</code> åéœ€è·Ÿ Promiseã€‚</p>
<p><code>await</code> ä½œç”¨ä¹‹ä¸€å°±æ˜¯è·å–éšå Promise å¯¹è±¡æˆåŠŸçŠ¶æ€ä¼ é€’å‡ºæ¥çš„å‚æ•°ã€‚</p>
<p><code>await</code> å‘½ä»¤åªèƒ½ç”¨åœ¨ <code>async</code> å‡½æ•°ä¸­ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚</p>
<h2>è¯­æ³•</h2>
<h3>è¿”å›å€¼ç±»å‹</h3>
<p><code>async</code> å‡½æ•°è¿”å›ä¸€ä¸ª Promise å¯¹è±¡</p>
<p><code>async</code> å‡½æ•°å†…éƒ¨ <code>return</code> è¯­å¥è¿”å›çš„å€¼ï¼Œä¼šæˆä¸º <code>then</code> æ–¹æ³•å›è°ƒå‡½æ•°çš„å‚æ•°ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Hello world!&#x27;</span>;
}

<span class="hljs-title function_">foo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res));
<span class="hljs-comment">// &#x27;Hello world!&#x27;</span>
</code></pre>
<p>å¦‚æœ <code>async</code> å‡½æ•°å†…éƒ¨æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™ä¼šå¯¼è‡´è¿”å›çš„ Promise å¯¹è±¡çŠ¶æ€å˜ä¸º <code>rejected</code> çŠ¶æ€ã€‚æŠ›å‡ºçš„é”™è¯¯è€Œä¼šè¢« <code>catch</code> æ–¹æ³•å›è°ƒå‡½æ•°æ¥æ”¶åˆ°ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&#x27;Error&#x27;</span>);
}

<span class="hljs-title function_">foo</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res))
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err));
</code></pre>
<h3>è¿”å›å€¼çŠ¶æ€å˜åŒ–</h3>
<p><code>async</code> å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡ï¼Œå¿…é¡»ç­‰åˆ°å†…éƒ¨æ‰€æœ‰ <code>await</code> å‘½ä»¤åé¢çš„ Promise å¯¹è±¡æ‰§è¡Œå®Œï¼Œæ‰ä¼šå‘ç”ŸçŠ¶æ€æ”¹å˜ï¼Œé™¤éé‡åˆ° <code>return</code> è¯­å¥æˆ–è€…æŠ›å‡ºé”™è¯¯ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰ <code>async</code> å‡½æ•°å†…éƒ¨çš„å¼‚æ­¥æ“ä½œæ‰§è¡Œå®Œï¼Œæ‰ä¼šæ‰§è¡Œ <code>then</code> æ–¹æ³•æŒ‡å®šçš„å›è°ƒå‡½æ•°ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title function_">delay</span> = (<span class="hljs-params">timeout</span>) =&gt; <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, timeout));

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">1000</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">2000</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>(<span class="hljs-number">3000</span>);
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;done&#x27;</span>;
}

<span class="hljs-title function_">foo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-variable language_">console</span>.<span class="hljs-property">log</span>);
<span class="hljs-comment">// &#x27;done&#x27;</span>
</code></pre>
<p>ä¸Šé¢ä»£ç ä¸­ï¼Œå‡½æ•° <code>foo</code> å†…éƒ¨æœ‰ä¸‰ä¸ªå»¶è¿Ÿå‡½æ•°ã€‚åªæœ‰è¿™ä¸‰ä¸ªæ“ä½œä¾æ¬¡å®Œæˆï¼Œæ‰ä¼šæ‰§è¡Œ <code>then</code> æ–¹æ³•é‡Œé¢çš„ <code>console.log</code>ã€‚</p>
<h3>å¼‚æ­¥è¯­å¥è¿”å›å€¼</h3>
<p>æ­£å¸¸æƒ…å†µä¸‹ï¼Œå¼‚æ­¥è¯­å¥ <code>await</code> å‘½ä»¤åé¢æ˜¯ä¸€ä¸ª Promise å¯¹è±¡ï¼Œè¿”å›è¯¥å¯¹è±¡çš„ç»“æœã€‚å¦‚æœä¸æ˜¯ Promise å¯¹è±¡ï¼Œå°±ç›´æ¥è¿”å›å¯¹åº”çš„å€¼ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> funciont <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>){
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-number">1</span>
}

fn.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res));
<span class="hljs-comment">// 1</span>
</code></pre>
<h2>å¼‚å¸¸å¤„ç†</h2>
<h3>æ•æ‰å¼‚å¸¸</h3>
<p>ä»»ä½•ä¸€ä¸ª <code>await</code> è¯­å¥åé¢çš„ Promise å¯¹è±¡å˜ä¸º <code>rejected</code> çŠ¶æ€ï¼Œé‚£ä¹ˆæ•´ä¸ª <code>async</code> å‡½æ•°éƒ½ä¼šä¸­æ–­æ‰§è¡Œã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>);
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;Hello world!&#x27;</span>);
  <span class="hljs-comment">// ä¸ä¼šæ‰§è¡Œ</span>
}
</code></pre>
<p>å½“ <code>async</code> å¼‚æ­¥å‡½æ•°ä¸­åªè¦æœ‰ä¸€ä¸ª <code>await</code> å¼‚æ­¥è¯­å¥è¿”å›çš„ Promise å¤„äº <code>rejected</code> çŠ¶æ€ï¼Œåˆ™åé¢çš„ <code>await</code> å¼‚æ­¥è¯­å¥éƒ½ä¸ä¼šæ‰§è¡Œã€‚</p>
<p><strong>è§£å†³æ–¹æ³•</strong>ï¼šä½¿ç”¨ <a href="/front-end/basic-concept/statements-and-declarations/the-try-statement">try-catch è¯­å¥</a> æˆ–åœ¨ <code>await</code> è¿”å›çš„ Promise æ·»åŠ  <code>catch</code> æ–¹æ³•æ•æ‰é”™è¯¯ã€‚</p>
<p>æœ‰æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›å³ä½¿å‰ä¸€ä¸ªå¼‚æ­¥æ“ä½œå¤±è´¥ï¼Œä¹Ÿä¸è¦ä¸­æ–­åé¢çš„å¼‚æ­¥æ“ä½œã€‚è¿™æ—¶å¯ä»¥å°†ç¬¬ä¸€ä¸ª <code>await</code> æ”¾åœ¨ <code>try...catch</code> ç»“æ„é‡Œé¢ï¼Œè¿™æ ·ä¸ç®¡è¿™ä¸ªå¼‚æ­¥æ“ä½œæ˜¯å¦æˆåŠŸï¼Œç¬¬äºŒä¸ª <code>await</code> éƒ½ä¼šæ‰§è¡Œã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">try</span> {
    <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>);
  } <span class="hljs-keyword">catch</span> (err) {
    <span class="hljs-comment">// do something</span>
  }

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;Hello world!&#x27;</span>);
}

<span class="hljs-title function_">foo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res));
<span class="hljs-comment">// &#x27;Hello world!&#x27;</span>
</code></pre>
<p>å¦ä¸€ç§æ–¹æ³•æ˜¯ <code>await</code> åé¢çš„ Promise å¯¹è±¡å†è·Ÿä¸€ä¸ª <code>catch</code> æ–¹æ³•ï¼Œå¤„ç†å‰é¢å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-string">&#x27;Error!&#x27;</span>).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e));

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-string">&#x27;Hello world!&#x27;</span>);
}

<span class="hljs-title function_">foo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res));
<span class="hljs-comment">// &#x27;Error!&#x27;</span>
<span class="hljs-comment">// &#x27;Hello world!&#x27;</span>
</code></pre>
<h3>æ“ä½œä¸­æ–­</h3>
<p>å¦‚æœ <code>await</code> åé¢çš„å¼‚æ­¥æ“ä½œå‡ºé”™ï¼Œé‚£ä¹ˆç­‰åŒäº <code>async</code> å‡½æ•°è¿”å›çš„ Promise å¯¹è±¡è¢« <code>reject</code>ã€‚</p>
<p>ä½¿ç”¨ <code>try...catch</code> è¯­å¥ï¼Œå®ç°å¤šæ¬¡é‡å¤å°è¯•ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> superagent = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;superagent&#x27;</span>);
<span class="hljs-keyword">const</span> <span class="hljs-variable constant_">NUM_RETRIES</span> = <span class="hljs-number">3</span>;

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">let</span> i;
  <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable constant_">NUM_RETRIES</span>; i++) {
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">await</span> superagent.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;https://google.com/this-throws-an-error&#x27;</span>);
      <span class="hljs-keyword">break</span>;
    } <span class="hljs-keyword">catch</span> (err) {
      <span class="hljs-comment">// do something</span>
    }
  }

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(i);
  <span class="hljs-comment">// 3</span>
}

<span class="hljs-title function_">foo</span>();
</code></pre>
<p>å¦‚æœ <code>await</code> æ“ä½œæˆåŠŸï¼Œå°±ä¼šä½¿ç”¨ <code>break</code> è¯­å¥é€€å‡ºå¾ªç¯ï¼›å¦‚æœå¤±è´¥ï¼Œä¼šè¢« <code>catch</code> è¯­å¥æ•æ‰ï¼Œç„¶åè¿›å…¥ä¸‹ä¸€è½®å¾ªç¯ã€‚</p>
<h2>å®ç°åŸç†</h2>
<p><code>async</code> å‡½æ•°çš„å®ç°åŸç†ï¼Œå°±æ˜¯å°† Generator å‡½æ•°å’Œè‡ªåŠ¨æ‰§è¡Œå™¨ï¼ŒåŒ…è£…åœ¨ä¸€ä¸ªå‡½æ•°é‡Œã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// ...</span>
}
</code></pre>
<p>ç›¸å½“äºï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">args</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title function_">spawn</span>(<span class="hljs-keyword">function</span>* () {
    <span class="hljs-comment">// ...</span>
  });
}
</code></pre>
<p>æ‰€æœ‰çš„ <code>async</code> å‡½æ•°éƒ½å¯ä»¥å†™æˆä¸Šé¢çš„ç¬¬äºŒç§å½¢å¼ï¼Œå…¶ä¸­çš„ <code>spawn</code> å‡½æ•°å°±æ˜¯è‡ªåŠ¨æ‰§è¡Œå™¨ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">spawn</span>(<span class="hljs-params">genF</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">resolve, reject</span>) {
    <span class="hljs-keyword">const</span> gen = <span class="hljs-title function_">genF</span>();
    <span class="hljs-keyword">function</span> <span class="hljs-title function_">step</span>(<span class="hljs-params">nextF</span>) {
      <span class="hljs-keyword">let</span> next;
      <span class="hljs-keyword">try</span> {
        next = <span class="hljs-title function_">nextF</span>();
      } <span class="hljs-keyword">catch</span> (e) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">reject</span>(e);
      }
      <span class="hljs-keyword">if</span> (next.<span class="hljs-property">done</span>) {
        <span class="hljs-keyword">return</span> <span class="hljs-title function_">resolve</span>(next.<span class="hljs-property">value</span>);
      }
      <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(next.<span class="hljs-property">value</span>).<span class="hljs-title function_">then</span>(
        <span class="hljs-keyword">function</span> (<span class="hljs-params">v</span>) {
          <span class="hljs-title function_">step</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
            <span class="hljs-keyword">return</span> gen.<span class="hljs-title function_">next</span>(v);
          });
        },
        <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
          <span class="hljs-title function_">step</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
            <span class="hljs-keyword">return</span> gen.<span class="hljs-keyword">throw</span>(e);
          });
        }
      );
    }
    <span class="hljs-title function_">step</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
      <span class="hljs-keyword">return</span> gen.<span class="hljs-title function_">next</span>(<span class="hljs-literal">undefined</span>);
    });
  });
}
</code></pre>
<h2>æœ€ä½³å®è·µ</h2>
<h3>å¼‚æ­¥é˜»å¡</h3>
<p>åé¢è¯·æ±‚çš„å‘é€æ€»æ˜¯éœ€è¦ä¾èµ–ä¸Šä¸€ä¸ªè¯·æ±‚è¿”å›çš„æ•°æ®ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">request</span>(<span class="hljs-params">time</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, rejecr</span>) =&gt;</span> {
    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {
      <span class="hljs-title function_">resolve</span>(time);
    }, time);
  });
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getResult</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">let</span> p1 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(<span class="hljs-number">500</span>);
  <span class="hljs-keyword">let</span> p2 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(p1 + <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">let</span> p3 = <span class="hljs-keyword">await</span> <span class="hljs-title function_">request</span>(p2 + <span class="hljs-number">1000</span>);
  <span class="hljs-keyword">return</span> p3;
}

<span class="hljs-title function_">getResult</span>()
  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(res);
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(err);
  });
</code></pre>
<h3>å¼‚æ­¥éé˜»å¡</h3>
<p>åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸‹ï¼Œå¼€å‘è€…å¯èƒ½éœ€è¦å¤„ç†å¤šä¸ªè¿ç»­æ­¥éª¤çš„æ“ä½œï¼Œä½†æ˜¯è¿™äº›æ“ä½œæœªå¿…ç›¸äº’ä¾èµ–ã€‚å› æ­¤éœ€è¦å¯¹è¿™äº›æ“ä½œè¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>ç»¼åˆä¸Šè¿° <a href="/front-end/core-modules/ecmascript-function-objects/function-declarations/#%E5%BC%82%E6%AD%A5%E9%98%BB%E5%A1%9E">å¼‚æ­¥é˜»å¡</a> å’Œ <a href="/front-end/core-modules/ecmascript-function-objects/function-declarations/#%E5%BC%82%E6%AD%A5%E5%B9%B6%E5%8F%91">å¼‚æ­¥å¹¶å‘</a>ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ Event Loop çš„ä¼˜åŠ¿å¹¶å‘æ‰§è¡Œè¿™äº›éé˜»å¡å¼‚æ­¥å‡½æ•°ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-comment">// é€‰æ‹©æŠ«è¨</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">selectPizza</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// å¼‚æ­¥è·å–æŠ«è¨æ•°æ®</span>
  <span class="hljs-keyword">const</span> pizzaData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getPizzaData</span>();
  <span class="hljs-comment">// é€‰æ‹©æŠ«è¨</span>
  <span class="hljs-keyword">const</span> chosenPizza = <span class="hljs-title function_">choosePizza</span>();
  <span class="hljs-comment">// å¼‚æ­¥æ·»åŠ é€‰ä¸­æŠ«è¨åˆ°è´­ç‰©è½¦</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">addPizzaToCart</span>(chosenPizza);
}

<span class="hljs-comment">// é€‰æ‹©é¥®æ–™</span>
<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">selectDrink</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// å¼‚æ­¥è·å–é¥®æ–™æ•°æ®</span>
  <span class="hljs-keyword">const</span> drinkData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">getDrinkData</span>();
  <span class="hljs-comment">// é€‰æ‹©é¥®æ–™</span>
  <span class="hljs-keyword">const</span> chosenDrink = <span class="hljs-title function_">chooseDrink</span>();
  <span class="hljs-comment">// å¼‚æ­¥æ·»åŠ é€‰ä¸­é¥®æ–™åˆ°è´­ç‰©è½¦</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">addDrinkToCart</span>(chosenDrink);
}

(<span class="hljs-title function_">async</span> () =&gt; {
  <span class="hljs-comment">// å¹¶å‘æ‰§è¡Œè¿™äº›éé˜»å¡å¼‚æ­¥å‡½æ•°</span>
  <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">selectPizza</span>(), <span class="hljs-title function_">selectDrink</span>()]).<span class="hljs-title function_">then</span>(orderItems);
})();
</code></pre>
<p>è¡¥å……ä¸€ç§ä¸ä¹‹ç›¸å…³çš„æ¯”è¾ƒä¼˜é›…çš„å†™æ³•ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(<span class="hljs-title function_">selectPizza</span>().<span class="hljs-title function_">then</span>(choosePizza), <span class="hljs-title function_">selectDrink</span>().<span class="hljs-title function_">then</span>(chooseDrink));
</code></pre>
<h3>å¼‚æ­¥å¹¶å‘</h3>
<p>å¤šä¸ªç½‘ç»œè¯·æ±‚æ˜¯éç»§å‘å…³ç³»ï¼Œæœ€å¥½ä½¿ç”¨ <code>Promise.all</code> æ–¹æ³•å®ç°åŒæ—¶è§¦å‘ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> [userList, orderList] = <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([<span class="hljs-title function_">getUserList</span>(), <span class="hljs-title function_">getOrderList</span>()]);

<span class="hljs-keyword">let</span> userPromise = <span class="hljs-title function_">getUserList</span>();
<span class="hljs-keyword">let</span> orderPromise = <span class="hljs-title function_">getOrderList</span>();

<span class="hljs-keyword">let</span> user = <span class="hljs-keyword">await</span> userPromise;
<span class="hljs-keyword">let</span> order = <span class="hljs-keyword">await</span> orderPromise;
</code></pre>
<p>ä¸Šé¢ä¸¤ç§å†™æ³•ï¼Œ<code>getUserList</code> å’Œ <code>getOrderList</code> éƒ½æ˜¯åŒæ—¶è§¦å‘ï¼Œè¿™æ ·å°±ä¼šç¼©çŸ­ç¨‹åºçš„æ‰§è¡Œæ—¶é—´ã€‚</p>
<h3>æœªçŸ¥æ•°é‡çš„å¼‚æ­¥å¹¶å‘</h3>
<p>æ‰¿æ¥ä¸Šä¸ªå®è·µæ–¹æ¡ˆï¼Œå½“æˆ‘ä»¬éœ€è¦è§£å†³æœªçŸ¥æ•°é‡çš„ Promise çš„æ—¶å€™ï¼Œæˆ‘ä»¬åªéœ€è¦åˆ›å»ºæ•°ç»„å¹¶å­˜å‚¨å®ƒä»¬ï¼Œç„¶ååŒæ ·ä½¿ç”¨ <code>Promise.all</code> æ–¹æ³•å°±èƒ½å¤Ÿå¹¶å‘åœ°ç­‰å¾…æ‰€æœ‰ Promise è¿”å›ç»“æœã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong>ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {
  <span class="hljs-comment">// æ‰¹é‡é…ç½®é¡¹</span>
  <span class="hljs-keyword">const</span> items = <span class="hljs-keyword">await</span> <span class="hljs-title function_">batchDisposal</span>();
  <span class="hljs-comment">// æ¯ä¸ªé…ç½®é¡¹å¯¹åº”ä¸€ä¸ªå¼‚æ­¥è¯·æ±‚</span>
  <span class="hljs-keyword">const</span> promises = items.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-title function_">sendRequest</span>(item));
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);
}
</code></pre>
<h3>ä¸ç­‰å¾…ç»“æœçš„å¼‚æ­¥å¾ªç¯</h3>
<p><code>await</code> æ¯æ¬¡å¾ªç¯ä»»åŠ¡ï¼Œæ³¨æ„éå†æ‰§è¡Œçš„åŒ¿åå‡½æ•°ä¹Ÿè¦è®¾ç½®ä¸º <code>async</code> å¼‚æ­¥å‡½æ•°ã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">delay</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">300</span>));
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">delayedLog</span>(<span class="hljs-params">item</span>) {
  <span class="hljs-comment">// notice that we can await a function that returns promise</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title function_">delay</span>();
  <span class="hljs-comment">// log item only after a delay</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(item);
}

<span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">tasks</span>) {
  tasks.<span class="hljs-title function_">forEach</span>(<span class="hljs-title function_">async</span> (item) =&gt; {
    <span class="hljs-keyword">await</span> <span class="hljs-title function_">delayLog</span>(item);
  });

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;DONE!&#x27;</span>);
}
</code></pre>
<h3>å¼‚æ­¥ä¸²è¡Œéå†</h3>
<p>è¦ç­‰å¾…æ‰€æœ‰çš„ç»“æœè¿”å›ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å›åˆ°è€å¼çš„ <code>for</code> å¾ªç¯å†™æ³•ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">tasks</span>) {
  <span class="hljs-keyword">let</span> result = [];

  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> task <span class="hljs-keyword">of</span> tasks) {
    <span class="hljs-keyword">try</span> {
      result.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">await</span> <span class="hljs-title function_">task</span>());
    } <span class="hljs-keyword">catch</span> (err) {
      result.<span class="hljs-title function_">push</span>(<span class="hljs-literal">null</span>);
    }
  }

  <span class="hljs-keyword">return</span> result;
}
</code></pre>
<p>ä¸Šé¢è¿™æ®µçš„éå†æ˜¯ <strong>ä¸²è¡Œ</strong> æ‰§è¡Œçš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒè½¬æ¢æˆ <strong>å¹¶è¡Œ</strong> çš„ã€‚</p>
<h3>å¼‚æ­¥å¹¶è¡Œéå†</h3>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡æ›´æ”¹ä¸Šé¢çš„ä»£ç æ¥å®ç°å¹¶è¡Œçš„å¼‚æ­¥æ“ä½œï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">execute</span>(<span class="hljs-params">tasks</span>) {
  <span class="hljs-comment">// map tasks to promises</span>
  <span class="hljs-keyword">const</span> promises = tasks.<span class="hljs-title function_">map</span>(delayLog);
  <span class="hljs-comment">// wait until all promises are resolved</span>
  <span class="hljs-keyword">await</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>(promises);

  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;DONE!&#x27;</span>);
}
</code></pre>
<h2>å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="http://es6.ruanyifeng.com/#docs/async" target="_blank" rel="noopener noreferrer nofollow">ğŸ“š ã€ŠECMAScript 6 å…¥é—¨ã€‹</a></li>
<li><a href="https://juejin.im/post/5beea5f5f265da61590b40cd" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ è¯‘æ–‡ï¼šæ›´å¿«çš„ async å‡½æ•°å’Œ Promise</a></li>
<li><a href="https://zhuanlan.zhihu.com/p/30500894" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ è¯‘æ–‡ï¼šå›¾ä¸ä¾‹è§£è¯» Async/Await</a></li>
</ul>
4:["$","div",null,{"className":"markdown-body","children":["$","article",null,{"dangerouslySetInnerHTML":{"__html":"$c"}}]}]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"front-end"}],["$","meta","2",{"name":"description","content":"front-end knowledge"}],["$","link","3",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
6:null
