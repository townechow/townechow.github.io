<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="preload" href="/_next/static/media/569ce4b8f30dc480-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="preload" href="/_next/static/media/93f479601ee12b01-s.p.woff2" as="font" crossorigin="" type="font/woff2"/><link rel="stylesheet" href="/_next/static/css/ec0a9d078e716e00.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/485ff6fe79292a08.css" data-precedence="next"/><link rel="stylesheet" href="/_next/static/css/0ff121a467c0636f.css" data-precedence="next"/><link rel="preload" as="script" fetchPriority="low" href="/_next/static/chunks/webpack-53834dba86d90934.js"/><script src="/_next/static/chunks/4bd1b696-20882bf820444624.js" async=""></script><script src="/_next/static/chunks/517-98ed787e5f259f2c.js" async=""></script><script src="/_next/static/chunks/main-app-f33d3e3aed85e21f.js" async=""></script><meta name="next-size-adjust" content=""/><title>front-end</title><meta name="description" content="front-end knowledge"/><link rel="icon" href="/favicon.ico" type="image/x-icon" sizes="16x16"/><script src="/_next/static/chunks/polyfills-42372ed130431b0a.js" noModule=""></script></head><body class="__variable_4d318d __variable_ea5f4b antialiased"><main><div class="markdown-body"><h1>åŒæºç­–ç•¥</h1><article><h1>åŒæºç­–ç•¥</h1>
<p><strong>åŒæºç­–ç•¥</strong>é™åˆ¶ä»ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å…³é”®çš„å®‰å…¨æœºåˆ¶ã€‚</p>
<p>åŒæºéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</p>
<ul>
<li>åè®®ç›¸åŒ</li>
<li>åŸŸåç›¸åŒ</li>
<li>ç«¯å£ç›¸åŒ</li>
</ul>
<p>ä»¥ <code>http://www.a.com</code> ä¸ºä¾‹</p>
<ul>
<li><code>http://www.a.com/foo</code> åŒæº</li>
<li><code>http://a.com/foo</code> ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><code>http://a.edu/foo</code> ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><code>http://b.a.com/foo</code> ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰</li>
<li><code>http://a.com:81/foo</code> ä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰</li>
<li><code>https://a.com/foo</code> ä¸åŒæºï¼ˆåè®®ä¸åŒï¼‰</li>
</ul>
<p>å¦‚æœæ˜¯éåŒæºï¼Œåˆ™ä»¥ä¸‹è¡Œä¸ºä¼šå—åˆ°é™åˆ¶ï¼š</p>
<ul>
<li>Cookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–</li>
<li>DOM æ— æ³•è·å–</li>
<li>AJAX è¯·æ±‚ä¸èƒ½å‘é€</li>
</ul>
<p><strong>ä¸ºä»€ä¹ˆè¦å®ç°è·¨åŸŸè¯·æ±‚ï¼Ÿ</strong></p>
<p>å·¥ç¨‹æœåŠ¡åŒ–åï¼Œä¸åŒèŒè´£çš„æœåŠ¡åˆ†æ•£åœ¨ä¸åŒçš„å·¥ç¨‹ä¸­ï¼Œå¾€å¾€è¿™äº›å·¥ç¨‹çš„åŸŸåæ˜¯ä¸åŒçš„ï¼Œä½†ä¸€ä¸ªéœ€æ±‚å¯èƒ½å¯¹åº”åˆ°å¤šä¸ªæœåŠ¡ï¼Œè¿™æ—¶ä¾¿éœ€è¦è°ƒç”¨ä¸åŒæœåŠ¡çš„æ¥å£ï¼Œå› æ­¤ä¼šå‡ºç°è·¨åŸŸã€‚</p>
<p>åŒæºç­–ç•¥ä»…å­˜åœ¨äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œä¸å­˜åœ¨ Androidã€iOSã€NodeJSã€Pythonã€Java ç­‰å…¶ä»–ç¯å¢ƒã€‚</p>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šè·¨åŸŸè¯·æ±‚èƒ½æˆåŠŸå‘é€ï¼ŒæœåŠ¡ç«¯èƒ½æ¥æ”¶è¯·æ±‚å¹¶æ­£å¸¸è¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº†ã€‚</p>
<h2>è·¨æºç½‘ç»œè®¿é—®</h2>
<p>ä¸¥æ ¼æ¥è¯´ï¼Œæµè§ˆå™¨å¹¶ä¸æ˜¯æ‹’ç»æ‰€æœ‰çš„è·¨åŸŸè¯·æ±‚ï¼Œå®é™…ä¸Šæ‹’ç»çš„æ˜¯è·¨åŸŸçš„è¯»æ“ä½œã€‚</p>
<p>åŒæºç­–ç•¥æ§åˆ¶äº†ä¸åŒæºä¹‹é—´çš„äº¤äº’ï¼Œè¿™äº›äº¤äº’é€šå¸¸åˆ†ä¸ºä¸‰ç±»ï¼š</p>
<ul>
<li>âœ… é€šå¸¸æµè§ˆå™¨å…è®¸è¿›è¡Œè·¨åŸŸ <strong>å†™æ“ä½œ</strong>ï¼ˆCross-origin writesï¼‰ï¼Œå¦‚é“¾æ¥ã€é‡å®šå‘ä»¥åŠè¡¨å•æäº¤</li>
<li>âœ… é€šå¸¸æµè§ˆå™¨å…è®¸è·¨åŸŸ <strong>èµ„æºåµŒå…¥</strong>ï¼ˆCross-origin embeddingï¼‰ï¼Œå¦‚ <code>img</code>ã€<code>script</code> æ ‡ç­¾</li>
<li>âŒ é€šå¸¸æµè§ˆå™¨ä¸å…è®¸è·¨åŸŸ <strong>è¯»æ“ä½œ</strong>ï¼ˆCross-origin readsï¼‰ï¼Œä½†å¸¸å¯ä»¥é€šè¿‡å†…åµŒèµ„æºæ¥å·§å¦™åœ°è¿›è¡Œè¯»å–è®¿é—®ã€‚ä¾‹å¦‚å¯ä»¥è¯»å–åµŒå¥—å›¾ç‰‡çš„é«˜åº¦å’Œå®½åº¦ï¼Œè°ƒç”¨å†…åµŒè„šæœ¬çš„æ–¹æ³•</li>
</ul>
<h2>è§£å†³æ–¹æ¡ˆ</h2>
<ul>
<li>CORS è·¨åŸŸèµ„æºå…±äº«</li>
<li>Node ä»£ç†è·¨åŸŸ</li>
<li>Nginx ä»£ç†è·¨åŸŸ</li>
<li>JSONP</li>
<li>WebSocket</li>
<li>window.postMessage</li>
<li>document.domain + iframe</li>
<li>window.location.hash + iframe</li>
<li>window.name + iframe</li>
</ul>
<h3>CORS</h3>
<p>CORS äº¦å³ <a href="../http/access-control">è·¨åŸŸèµ„æºå…±äº«</a>ï¼Œæ˜¯ä¸€ç§ HTTP æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å“åº”å¤´æ¥å‘Šè¯‰æµè§ˆå™¨è®©å…¶è¿è¡Œåœ¨ä¸€ä¸ª <code>origin</code> (<code>domain</code>) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ª <strong>ä¸åŒæºæœåŠ¡å™¨</strong> ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨ <strong>ä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯å£</strong> è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ª <strong>è·¨åŸŸ HTTP è¯·æ±‚</strong>ã€‚</p>
<p>å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé€šå¸¸ä½¿ç”¨ CORS æ—¶ï¼Œå¼‚æ­¥è¯·æ±‚ä¼šè¢«åˆ†ä¸º<strong>ç®€å•è¯·æ±‚</strong>å’Œ<strong>éç®€å•è¯·æ±‚</strong>ï¼Œéç®€å•è¯·æ±‚çš„åŒºåˆ«æ˜¯ä¼šå…ˆå‘é€ä¸€ä¸ª <strong>é¢„æ£€è¯·æ±‚</strong>ï¼ˆPreflight Requestï¼‰ã€‚</p>
<p><strong>æœåŠ¡å™¨é¢„æ£€è¯·æ±‚ / å“åº”å¤´</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">å“åº”å¤´</th>
<th style="text-align:left">æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Access-Control-Allow-Headers</code></td>
<td style="text-align:left">è¯·æ±‚å¤´ï¼Œå“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º <code>*</code>ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>Access-Control-Allow-Methods</code></td>
<td style="text-align:left">è¯·æ±‚å¤´ï¼Œå“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º <code>*</code>ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>Access-Control-Allow-Origin</code></td>
<td style="text-align:left">å“åº”å¤´ï¼Œé¢„è¯·æ±‚ / æ­£å¸¸è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º <code>*</code>ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>Access-Control-Allow-Credentials</code></td>
<td style="text-align:left">å“åº”å¤´ï¼Œé¢„è¯·æ±‚/æ­£å¸¸è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹è¦è®¾ç½®ä¸º <code>true</code>ï¼‰</td>
</tr>
<tr>
<td style="text-align:left"><code>Access-Control-Max-Age</code></td>
<td style="text-align:left">å“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆå•ä½ <code>s</code>ï¼‰</td>
</tr>
</tbody>
</table>
<p><code>Access-Control-Allow-Origin</code> åªèƒ½é˜»æ­¢æµè§ˆå™¨ç«¯æ‹¿åˆ°æœåŠ¡å™¨è¿”å›æ•°æ®ï¼ŒæœåŠ¡ç«¯çš„å¤„ç†è¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œè¦é…åˆ <code>token</code> é‰´æƒä»¤ç‰Œç­‰ç­–ç•¥æ¥é˜²èŒƒã€‚</p>
<p>ğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ <a href="../http/access-control">HTTP è·¨åŸŸèµ„æºå…±äº«</a></p>
<h4>åŸç”Ÿå®ç°</h4>
<p>åœ¨ Node.js ä¸­ <code>CORS</code> çš„å®ç°ï¼š</p>
<pre class="hljs"><code class="language-js">app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {
  ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>, ctx.<span class="hljs-property">headers</span>.<span class="hljs-property">origin</span>);
  ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="hljs-literal">true</span>);
  ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Access-Control-Request-Method&#x27;</span>, <span class="hljs-string">&#x27;PUT,POST,GET,DELETE,OPTIONS&#x27;</span>);
  ctx.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Headers&#x27;</span>, <span class="hljs-string">&#x27;Origin, X-Requested-With, Content-Type, Accept, cc&#x27;</span>);
});
</code></pre>
<h4>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</h4>
<p>ä»¥ Koa ä¸ºä¾‹å­ï¼Œè§£ç¦æŒ‡å®šåŸŸåçš„è·¨åŸŸè¯·æ±‚é—®é¢˜ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);
<span class="hljs-keyword">const</span> cors = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa2-cors&#x27;</span>); <span class="hljs-comment">// ä½¿ç”¨æ’ä»¶è§£å†³è·¨åŸŸå¤„ç†</span>

<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();

app.<span class="hljs-title function_">use</span>(
  <span class="hljs-title function_">cors</span>({
    <span class="hljs-attr">origin</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">ctx</span>) {
      <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">url</span> === <span class="hljs-string">&#x27;/login&#x27;</span>) {
        <span class="hljs-comment">// å…è®¸æ¥è‡ªæ‰€æœ‰åŸŸåçš„è¯·æ±‚</span>
        <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;*&#x27;</span>;
      }

      <span class="hljs-comment">// åªå…è®¸ http://localhost:8080 è¿™ä¸ªåŸŸåçš„è¯·æ±‚</span>
      <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;http://localhost:8080&#x27;</span>;
    },
    <span class="hljs-comment">// æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’</span>
    <span class="hljs-attr">maxAge</span>: <span class="hljs-number">5</span>,
    <span class="hljs-comment">// æ˜¯å¦å…è®¸å‘é€ Cookie</span>
    <span class="hljs-attr">credentials</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-comment">// è®¾ç½®æ‰€å…è®¸çš„ HTTP è¯·æ±‚æ–¹æ³•</span>
    <span class="hljs-attr">allowMethods</span>: [<span class="hljs-string">&#x27;GET&#x27;</span>, <span class="hljs-string">&#x27;POST&#x27;</span>, <span class="hljs-string">&#x27;PUT&#x27;</span>, <span class="hljs-string">&#x27;DELETE&#x27;</span>, <span class="hljs-string">&#x27;OPTIONS&#x27;</span>],
    <span class="hljs-comment">// è®¾ç½®æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µ</span>
    <span class="hljs-attr">allowHeaders</span>: [<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;Authorization&#x27;</span>, <span class="hljs-string">&#x27;Accept&#x27;</span>],
    <span class="hljs-comment">// è®¾ç½®è·å–å…¶ä»–è‡ªå®šä¹‰å­—æ®µ</span>
    <span class="hljs-attr">exposeHeaders</span>: [<span class="hljs-string">&#x27;WWW-Authenticate&#x27;</span>, <span class="hljs-string">&#x27;Server-Authorization&#x27;</span>],
  })
);
</code></pre>
<blockquote>
<p><a href="https://github.com/zadzbw/koa2-cors">koa2-cors</a> å†…éƒ¨å®ç°è¯·å‚ç…§æºç ã€‚</p>
</blockquote>
<h4>å…³äº Cookie é—®é¢˜</h4>
<p>è¦ä¼ é€’ Cookie éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p>
<ol>
<li>Web è¯·æ±‚è®¾ç½® <code>withCredentials</code></li>
</ol>
<p>è¿™é‡Œé»˜è®¤æƒ…å†µä¸‹åœ¨è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨æ˜¯ä¸å¸¦ Cookie çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® <code>withCredentials</code> æ¥è¿›è¡Œä¼ é€’ Cookieã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-comment">// åŸç”Ÿ XMLHttpRequest çš„è®¾ç½®æ–¹å¼</span>
<span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XHRHttpRequest</span>();
xhr.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// Axios è®¾ç½®æ–¹å¼</span>
axios.<span class="hljs-property">default</span>.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span>;
</code></pre>
<ol start="2">
<li><code>Access-Control-Allow-Credentials</code> ä¸º <code>true</code></li>
<li><code>Access-Control-Allow-Origin</code> ä¸ºé <code>*</code></li>
</ol>
<p>è¿™é‡Œçš„è¯·æ±‚æ–¹å¼ï¼Œåœ¨ Chrome ä¸­æ˜¯èƒ½çœ‹åˆ°è¿”å›å€¼çš„ï¼Œä½†æ˜¯åªè¦ä¸æ»¡è¶³ä»¥ä¸Šå…¶ä¸€ï¼Œæµè§ˆå™¨ä¼šæŠ¥é”™ï¼Œæ— æ³•è·å–æ•°æ®ã€‚</p>
<h3>Node ä»£ç†</h3>
<p>åˆ©ç”¨ Node + Express + Http-Proxy-Middleware æ­å»ºä¸€ä¸ª Proxy æœåŠ¡å™¨ã€‚</p>
<p><strong>å‰ç«¯å®ç°</strong></p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> xhr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XMLHttpRequest</span>();

<span class="hljs-comment">// å‰ç«¯å¼€å…³ï¼šæµè§ˆå™¨æ˜¯å¦è¯»å†™cookie</span>
xhr.<span class="hljs-property">withCredentials</span> = <span class="hljs-literal">true</span>;

<span class="hljs-comment">// è®¿é—®http-proxy-middlewareä»£ç†æœåŠ¡å™¨</span>
xhr.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;get&#x27;</span>, <span class="hljs-string">&#x27;http://www.domain1.com:3000/login?user=admin&#x27;</span>, <span class="hljs-literal">true</span>);
xhr.<span class="hljs-title function_">send</span>();
</code></pre>
<p><strong>æœåŠ¡å™¨å®ç°</strong></p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> express = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;express&#x27;</span>);
<span class="hljs-keyword">const</span> proxy = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;http-proxy-middleware&#x27;</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-title function_">express</span>();

app.<span class="hljs-title function_">use</span>(
  <span class="hljs-string">&#x27;/&#x27;</span>,
  <span class="hljs-title function_">proxy</span>({
    <span class="hljs-comment">// ä»£ç†è·¨åŸŸç›®æ ‡æ¥å£</span>
    <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://www.domain2.com:8080&#x27;</span>,
    <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,

    <span class="hljs-comment">// ä¿®æ”¹å“åº”å¤´ä¿¡æ¯ï¼Œå®ç°è·¨åŸŸå¹¶å…è®¸å¸¦cookie</span>
    <span class="hljs-attr">onProxyRes</span>: <span class="hljs-keyword">function</span> (<span class="hljs-params">proxyRes, req, res</span>) {
      res.<span class="hljs-title function_">header</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Origin&#x27;</span>, <span class="hljs-string">&#x27;http://www.domain1.com&#x27;</span>);
      res.<span class="hljs-title function_">header</span>(<span class="hljs-string">&#x27;Access-Control-Allow-Credentials&#x27;</span>, <span class="hljs-string">&#x27;true&#x27;</span>);
    },

    <span class="hljs-comment">// ä¿®æ”¹å“åº”ä¿¡æ¯ä¸­çš„cookieåŸŸå</span>
    <span class="hljs-attr">cookieDomainRewrite</span>: <span class="hljs-string">&#x27;www.domain1.com&#x27;</span>, <span class="hljs-comment">// å¯ä»¥ä¸ºfalseï¼Œè¡¨ç¤ºä¸ä¿®æ”¹</span>
  })
);

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>);
<span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;Proxy server is listen at port 3000...&#x27;</span>);
</code></pre>
<p>æœ¬è´¨ä¸Šä¸ CORS ä¸­åˆ—ä¸¾çš„ Koa çš„ä¾‹å­çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯è§£é™¤ CORS çš„é™åˆ¶ï¼Œä½†è¿™é‡Œæ›´å¼ºè°ƒçš„æ˜¯å¼€å‘æ—¶ä¸åç«¯æ¥å£è”è°ƒçš„åœºæ™¯ä½¿ç”¨ï¼Œå³å¯åŠ¨å‰ç«¯é¡¹ç›®çš„åŒæ—¶ï¼Œä¹Ÿå¯åŠ¨ä¸€ä¸ªå¼€å‘æœ¬åœ°çš„ Node ä»£ç†æœåŠ¡ç”¨äºè½¬å‘å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ã€‚</p>
<h3>Nginx åå‘ä»£ç†</h3>
<p>Nginx å¯å®ç°ç”¨äºåå‘ä»£ç†çš„å¼‚æ­¥ Web æœåŠ¡å™¨ï¼Œä»–é™¤äº†ç”¨äºåå‘ä»£ç†ä»¥å¤–è¿˜å¯ä»¥ç”¨äºè´Ÿè½½å‡è¡¡ã€ HTTP ç¼“å­˜ã€‚</p>
<pre class="hljs"><code class="language-nginx"><span class="hljs-section">http</span> {
  <span class="hljs-attribute">include</span>               mime.types;
  <span class="hljs-attribute">default_type</span>          application/octet-stream;
  <span class="hljs-attribute">client_max_body_size</span>  <span class="hljs-number">2000M</span>;
  <span class="hljs-attribute">keepalive_timeout</span>     <span class="hljs-number">65</span>;

  <span class="hljs-comment"># è™šæ‹ŸæœåŠ¡å™¨</span>
  <span class="hljs-section">server</span> {
    <span class="hljs-attribute">listen</span>       <span class="hljs-number">8080</span>;
    <span class="hljs-attribute">server_name</span>  localhost;

    <span class="hljs-comment"># CORS è®¾ç½®</span>
    <span class="hljs-comment"># æŒ‡å®šå“åº”èµ„æºæ˜¯å¦å…è®¸ä¸ç»™å®šçš„ origin å…±äº«</span>
    <span class="hljs-attribute">add_header</span> Access-Control-Allow-Origin *;
    <span class="hljs-comment"># é…ç½®æ˜¯å¦å…è®¸å°†å¯¹è¯·æ±‚çš„å“åº”æš´éœ²ç»™é¡µé¢</span>
    <span class="hljs-attribute">add_header</span> Access-Control-Allow-Credentials <span class="hljs-string">&#x27;true&#x27;</span>;
    <span class="hljs-comment"># é…ç½®å…è®¸è·¨åŸŸçš„è¯·æ±‚å¤´</span>
    <span class="hljs-attribute">add_header</span> Access-Control-Allow-Headers <span class="hljs-string">&#x27;Authorization,Content-Type,Accept,Origin,User-Agent,Cache-Control,X-Mx-ReqToken,X-Requested-With&#x27;</span>;
    <span class="hljs-comment"># é…ç½®å…è®¸è·¨åŸŸçš„è¯·æ±‚æ–¹æ³•</span>
    <span class="hljs-attribute">add_header</span> Access-Control-Allow-Methods <span class="hljs-string">&#x27;GET,POST,Options&#x27;</span>;

    <span class="hljs-comment"># è·³è¿‡æœåŠ¡ç«¯æ ¡éªŒï¼Œç›´æ¥è¿”å› 200</span>
    <span class="hljs-attribute">if</span> (<span class="hljs-variable">$request_method</span> = <span class="hljs-string">&#x27;OPTIONS&#x27;</span>) {
      <span class="hljs-attribute">return</span> <span class="hljs-number">200</span>;
    }

    <span class="hljs-section">location</span> / {
        <span class="hljs-attribute">root</span>        /data/example/dist;
        <span class="hljs-attribute">index</span>       index.html index.htm;
        <span class="hljs-attribute">try_files</span>   <span class="hljs-variable">$uri</span> /index.html;
        <span class="hljs-attribute">add_header</span>  Cache-Control <span class="hljs-string">&quot;private, no-store, no-cache, must-revalidate, proxy-revalidate&quot;</span>;
    }

    <span class="hljs-section">location</span> /api/ {
        <span class="hljs-attribute">proxy_pass</span>  https://xxx.xxx.xxx/req/;
    }
  }
}
</code></pre>
<ul>
<li>å¯¹äºç®€å•è¯·æ±‚ï¼Œå¦‚ GETï¼Œåªéœ€è¦åœ¨ HTTP Response åæ·»åŠ  Access-Control-Allow-Origin</li>
<li>å¯¹äºéç®€å•è¯·æ±‚ï¼Œå¦‚ POSTã€PUTã€DELETE ç­‰ï¼Œæµè§ˆå™¨ä¼šåˆ†ä¸¤æ¬¡åº”ç­”ã€‚ç¬¬ä¸€æ¬¡ Preflightï¼ˆ<code>method: OPTIONS</code>ï¼‰ï¼Œä¸»è¦éªŒè¯æ¥æºæ˜¯å¦åˆæ³•ï¼Œå¹¶è¿”å›å…è®¸çš„ <code>Headers</code> ç­‰ï¼›ç¬¬äºŒæ¬¡æ‰æ˜¯çœŸæ­£çš„ HTTP åº”ç­”ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¿…é¡»å¤„ç† <code>OPTIONS</code> åº”ç­”ã€‚</li>
</ul>
<p>ç”±äºæµè§ˆå™¨ç¬¬ä¸€æ¬¡ Preflight é¢„æ£€ï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯¹å…¶è¯·æ±‚è¿›è¡Œæ ¡éªŒï¼Œä½†æ˜¯æœåŠ¡ç«¯æœ¬èº«æ²¡æœ‰å¼€å¯ CORSï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æœåŠ¡ç«¯è¿”å› 405 Method Not Allowed æˆ–è€… 403 Forbiddenã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ Nginx å¯¹è¯¥è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œç›´æ¥è¿”å› 200ï¼Œè·³è¿‡æœåŠ¡ç«¯æ ¡éªŒã€‚</p>
<h3>JSONP</h3>
<p><strong>å®ç°åŸç†</strong></p>
<p>åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> è„šæœ¬æ ‡ç­¾ï¼Œé€šè¿‡è·¨åŸŸè„šæœ¬åµŒå…¥ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ–¹æ³•å®ç°è¯·æ±‚ç¬¬ä¸‰æ–¹æœåŠ¡å™¨æ•°æ®å†…å®¹ã€‚é™¤äº†é€‚ç”¨äº <code>&lt;script&gt;</code> è„šæœ¬æ ‡ç­¾ï¼ŒHTML ä¸­åŒ…å« <code>src</code> å’Œ <code>href</code> å±æ€§çš„æ ‡ç­¾å‡ä¸å—åŒæºç­–ç•¥é™åˆ¶ã€‚</p>
<p><strong>å®ç°æ­¥éª¤</strong></p>
<ol>
<li>åŠ¨æ€åˆ›å»º <code>&lt;script&gt;</code> æ ‡ç­¾</li>
<li>æ ‡ç­¾ <code>src</code> å±æ€§è®¾ç½®æ¥å£åœ°å€</li>
<li>æ¥å£å‚æ•°ï¼Œå¿…é¡»è¦å¸¦ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°åï¼Œè¦ä¸ç„¶åå°æ— æ³•è¿”å›æ•°æ®ï¼Œé€šå¸¸ä¸º <code>callback</code> æˆ– <code>cb</code></li>
<li>é€šè¿‡å®šä¹‰å‡½æ•°åå»æ¥æ”¶åå°è¿”å›æ•°æ®</li>
</ol>
<p>å‰ç«¯å®ç°ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-comment">// åŠ¨æ€åˆ›å»ºè„šæœ¬æ ‡ç­¾</span>
<span class="hljs-keyword">const</span> script = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;script&#x27;</span>);

<span class="hljs-comment">// è®¾ç½®æ¥å£åœ°å€</span>
script.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://localhost:8080/api/jsonp?cb=jsonpCallback&#x27;</span>;

<span class="hljs-comment">// æ’å…¥é¡µé¢</span>
<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">appendChild</span>(script);

<span class="hljs-comment">// é€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°æ¥æ”¶å“åº”æ•°æ®</span>
<span class="hljs-variable language_">window</span>.<span class="hljs-property">jsonpCallback</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">res</span>) {
  <span class="hljs-comment">// do something with response data</span>
};
</code></pre>
<p>åç«¯å®ç°ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Koa</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa&#x27;</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>);
<span class="hljs-keyword">const</span> app = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Koa</span>();

app.<span class="hljs-title function_">use</span>(<span class="hljs-title function_">async</span> (ctx, next) =&gt; {
  <span class="hljs-keyword">if</span> (ctx.<span class="hljs-property">path</span> === <span class="hljs-string">&#x27;/api/jsonp&#x27;</span>) {
    <span class="hljs-keyword">const</span> { cb } = ctx.<span class="hljs-property">query</span>;
    ctx.<span class="hljs-property">body</span> = <span class="hljs-string">`<span class="hljs-subst">${cb}</span>(<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify({ msg })}</span>)`</span>;
    <span class="hljs-keyword">return</span>;
  }
});

app.<span class="hljs-title function_">listen</span>(<span class="hljs-number">8080</span>);
</code></pre>
<p>ç”±äº <code>&lt;script&gt;</code> å…ƒç´ è¯·æ±‚çš„è„šæœ¬ï¼Œç›´æ¥ä½œä¸ºä»£ç è¿è¡Œã€‚è¿™æ—¶ï¼Œåªè¦æµè§ˆå™¨å®šä¹‰äº†å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°å°±ä¼šç«‹å³è°ƒç”¨ã€‚ä½œä¸ºå‚æ•°çš„ JSON æ•°æ®è¢«è§†ä¸º JavaScript å¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤é¿å…äº†ä½¿ç”¨ <code>JSON.parse</code> çš„æ­¥éª¤ã€‚</p>
<p><strong>ç¼ºç‚¹</strong>ï¼š</p>
<ul>
<li>éå¸¸é«˜çš„è·¨ç«™è„šæœ¬æ”»å‡»é£é™©</li>
<li>åªèƒ½å®ç° GET è¯·æ±‚</li>
<li>æ¥å£å‡ºç°é”™è¯¯æ—¶ï¼Œå¾ˆéš¾è¿›è¡Œé”™è¯¯è¯†åˆ«å¤„ç†</li>
</ul>
<h3>WebSocket</h3>
<p>WebSocket æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿ç”¨ <code>ws://</code>ï¼ˆéåŠ å¯†ï¼‰å’Œ <code>wss://</code>ï¼ˆåŠ å¯†ï¼‰ä½œä¸ºåè®®å‰ç¼€ã€‚è¯¥åè®®ä¸å®è¡ŒåŒæºæ”¿ç­–ï¼Œåªè¦æœåŠ¡å™¨æ”¯æŒï¼Œå°±å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œè·¨æºé€šä¿¡ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼ŒWebSocket é€šè¿‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹æŒä¹…çš„è¿æ¥ï¼ŒåŒæ–¹å¯ä»¥éšæ—¶å‘é€æ•°æ®ã€‚</p>
<p>è¿™ç§æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰ä½¿ç”¨ HTTP åè®®è¿›è¡Œé€šä¿¡ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰æµè§ˆå™¨è·¨åŸŸçš„é™åˆ¶ã€‚</p>
<p>å‰ç«¯éƒ¨åˆ†ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> socket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>(<span class="hljs-string">&#x27;ws://localhost:8080&#x27;</span>);

socket.<span class="hljs-property">onopen</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  socket.<span class="hljs-title function_">send</span>(<span class="hljs-string">&#x27;Client Socket is openning&#x27;</span>);
};

socket.<span class="hljs-property">onmessage</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
};
</code></pre>
<p>åç«¯éƒ¨åˆ†ï¼š</p>
<pre class="hljs"><code class="language-js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">WebSocket</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ws&#x27;</span>);
<span class="hljs-keyword">const</span> server = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebSocket</span>.<span class="hljs-title class_">Server</span>({ <span class="hljs-attr">port</span>: <span class="hljs-number">8080</span> });

server.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;connection&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">socket</span>) {
  socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;message&#x27;</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) {
    socket.<span class="hljs-title function_">send</span>(data);
  });
});
</code></pre>
<p>ğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ <a href="../../html5-scripting-programming/connectivity/web-socket">WebSocket</a></p>
<h3>window.postMessage</h3>
<p>é€šå¸¸ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒé¡µé¢çš„è„šæœ¬ï¼Œåªæœ‰å½“æ‰§è¡Œå®ƒä»¬çš„é¡µé¢ä½äºå…·æœ‰ç›¸åŒçš„åè®®ï¼ˆé€šå¸¸ä¸º HTTPSï¼‰ï¼Œç«¯å£å·ï¼ˆ443 ä¸º HTTPS çš„é»˜è®¤å€¼ï¼‰ï¼Œä»¥åŠä¸»æœºï¼ˆä¸¤ä¸ªé¡µé¢çš„æ¨¡æ•° <code>document.domain</code> è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼‰æ—¶ï¼Œè¿™ä¸¤ä¸ªè„šæœ¬æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚<code>window.postMessage</code> æ–¹æ³•æä¾›äº†ä¸€ç§å—æ§æœºåˆ¶æ¥è§„é¿æ­¤é™åˆ¶ï¼Œåªè¦æ­£ç¡®çš„ä½¿ç”¨ï¼Œè¿™ç§æ–¹æ³•å°±å¾ˆå®‰å…¨ã€‚</p>
<p><code>window.postMessage(message, targetOrigin)</code> æ–¹æ³•æ˜¯ HTML5 æ–°å¼•è¿›çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå‘å…¶ä»–çš„ <code>window</code> å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œæ— è®ºè¿™ä¸ª <code>window</code> å¯¹è±¡æ˜¯å±äºåŒæºæˆ–ä¸åŒæºï¼Œç›®å‰ IE8+ã€Firefoxã€Chromeã€Opera ç­‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒè¯¥æ–¹æ³•ã€‚</p>
<p><strong>ç”¨é€”ï¼š</strong></p>
<ol>
<li>é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’</li>
<li>å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’</li>
<li>é¡µé¢ä¸åµŒå¥—çš„ iframe æ¶ˆæ¯ä¼ é€’</li>
</ol>
<pre class="hljs"><code class="language-js">otherWindow.<span class="hljs-title function_">postMessage</span>(message, targetOrigin, [transfer]);
</code></pre>
<ul>
<li><code>otherWindow</code>ï¼šå…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ iframe çš„ <code>contentWindow</code> å±æ€§ã€æ‰§è¡Œ <code>window.open</code> è¿”å›çš„çª—å£ã€æˆ–è€…æ˜¯å‘½åè¿‡æˆ–æ•°å€¼ç´¢å¼•çš„ <code>window.iframes</code></li>
<li><code>message</code>ï¼šå°†è¦å‘é€åˆ°å…¶ä»– <code>window</code> çš„æ•°æ®</li>
<li><code>targetOrigin</code>ï¼šé€šè¿‡çª—å£çš„ <code>origin</code> å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶</li>
<li><code>transfer</code>ï¼ˆå¯é€‰ï¼‰ï¼šæ˜¯ä¸€ä¸²å’Œ <code>message</code> åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒ</li>
</ul>
<p>å‘é€ç«¯é¡µé¢ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;iframe&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:8080/&quot;</span> <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;load()&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span>(<span class="hljs-params"></span>) {
    iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">&#x27;Hello world!&#x27;</span>, <span class="hljs-string">&#x27;http://localhost:8080/&#x27;</span>);

    <span class="hljs-variable language_">window</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
    };
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>æ¥æ”¶ç«¯é¡µé¢ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(e.<span class="hljs-property">data</span>);
    <span class="hljs-comment">// Hello world!</span>
    e.<span class="hljs-property">source</span>.<span class="hljs-title function_">postMessage</span>(e.<span class="hljs-property">data</span>, e.<span class="hljs-property">origin</span>);
  };
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>ğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ <a href="../../browser-object-model/connectivity/post-message">PostMessage</a></p>
<h3>document.domain + iframe</h3>
<p>Cookie æ˜¯æœåŠ¡å™¨å†™å…¥æµè§ˆå™¨çš„ä¸€å°æ®µä¿¡æ¯ï¼Œåªæœ‰åŒæºçš„ç½‘é¡µæ‰èƒ½å…±äº«ã€‚</p>
<p>ä½†æ˜¯ï¼Œä¸¤ä¸ªç½‘é¡µä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒï¼Œæµè§ˆå™¨åªéœ€è¦è®¾ç½® <code>document.domain</code> ä¸ºæ›´é«˜çº§åˆ«çš„åŸŸå°±èƒ½å®ç° Cookie å…±äº«ã€‚</p>
<p>ğŸŒ° <strong>ä»£ç ç¤ºä¾‹</strong></p>
<p>ä»¥ <code>a.foo.com</code> å’Œ <code>b.foo.com</code> ä¸ºä¾‹ï¼Œåªè¦è®¾ç½®ç›¸åŒçš„ <code>document.domain</code>ï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº« Cookieã€‚</p>
<pre class="hljs"><code class="language-js"><span class="hljs-variable language_">document</span>.<span class="hljs-property">domain</span> = <span class="hljs-string">&#x27;foo.com&#x27;</span>;
</code></pre>
<p>âš ï¸ <strong>æ³¨æ„</strong>ï¼šè¿™ç§æ–¹æ³•åªé€‚ç”¨äº Cookie å’Œ iframe çª—å£ï¼ŒlocalStorage å’Œ IndexDB æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè§„é¿åŒæºç­–ç•¥ï¼Œéœ€è¦é‡‡ç”¨ä¸‹æ–‡æåŠçš„ <a href="#postMessage">PostMessage API</a>ã€‚</p>
<p>å¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½® Cookie çš„æ—¶å€™ï¼ŒæŒ‡å®š Cookie çš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåã€‚</p>
<pre class="hljs"><code class="language-http"><span class="hljs-attribute">Set-Cookie</span><span class="hljs-punctuation">: </span>key=value; domain=.example; path=/
</code></pre>
<p>é‚£ä¹ˆï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ª Cookieã€‚</p>
<h3>window.location.hash + iframe</h3>
<p>å¦‚æœä¸¤ä¸ªç½‘é¡µä¸åŒæºï¼Œå°±æ— æ³•æ‹¿åˆ°å¯¹æ–¹çš„ DOMã€‚å…¸å‹çš„ä¾‹å­æ˜¯ <code>iframe</code> çª—å£å’Œ <code>window.open</code> æ–¹æ³•æ‰“å¼€çš„çª—å£ï¼Œå®ƒä»¬ä¸çˆ¶çª—å£æ— æ³•é€šä¿¡ã€‚</p>
<p>é€šè¿‡ <code>url</code> å¸¦ <code>hash</code> é”šç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªéè·¨åŸŸçš„ä¸­é—´é¡µé¢æ¥ä¼ é€’æ•°æ®ã€‚</p>
<p><strong>å®ç°æµç¨‹</strong></p>
<p>ä¸€å¼€å§‹ <code>a.html</code> ç»™ <code>c.html</code> ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å <code>c.html</code> æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ <code>b.html</code>ï¼Œæœ€å <code>b.html</code> å°†ç»“æœæ”¾åˆ° <code>a.html</code> çš„ hash å€¼ä¸­ã€‚åŒæ ·çš„ï¼Œ<code>a.html</code> å’Œ <code>b.html</code> æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯ <code>http://localhost:8000/</code>ï¼Œè€Œ <code>c.html</code> æ˜¯ <code>http://localhost:8080/</code>ã€‚</p>
<p><code>a.html</code>ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:8080/hash/c.html#param1&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(location.<span class="hljs-property">hash</span>);

  <span class="hljs-variable language_">window</span>.<span class="hljs-property">onhashchange</span> = <span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(location.<span class="hljs-property">hash</span>);
  };
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>b.html</code>ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">location</span>.<span class="hljs-property">hash</span> = location.<span class="hljs-property">hash</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>c.html</code>ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(location.<span class="hljs-property">hash</span>);

  <span class="hljs-keyword">const</span> iframe = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&#x27;iframe&#x27;</span>);

  iframe.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://localhost:8000/hash/b.html#name2&#x27;</span>;

  <span class="hljs-variable language_">document</span>.<span class="hljs-property">body</span>.<span class="hljs-title function_">appendChild</span>(iframe);
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h3>window.name + iframe</h3>
<p><code>window</code> å¯¹è±¡çš„ <code>name</code> å±æ€§æ˜¯ä¸€ä¸ªå¾ˆç‰¹åˆ«çš„å±æ€§ï¼Œå½“è¯¥ <code>window</code> çš„ <code>location</code> å˜åŒ–ï¼Œç„¶åé‡æ–°åŠ è½½ï¼Œå®ƒçš„ <code>name</code> å±æ€§å¯ä»¥ä¾ç„¶ä¿æŒä¸å˜ã€‚</p>
<p>å…¶ä¸­ <code>a.html</code> å’Œ <code>b.html</code> æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯ <code>http://localhost:8000/</code>ï¼Œè€Œ <code>c.html</code> æ˜¯ <code>http://localhost:8080/</code>ã€‚</p>
<p><code>a.html</code>ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">iframe</span>
  <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;iframe&quot;</span>
  <span class="hljs-attr">frameborder</span>=<span class="hljs-string">&quot;0&quot;</span>
  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;http://localhost:8080/name/c.html&quot;</span>
  <span class="hljs-attr">onload</span>=<span class="hljs-string">&quot;load()&quot;</span>
&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">iframe</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-keyword">let</span> first = <span class="hljs-literal">true</span>;
  <span class="hljs-comment">// onload äº‹ä»¶ä¼šè§¦å‘ 2 æ¬¡ï¼Œç¬¬ 1 æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äº window.name</span>
  <span class="hljs-keyword">function</span> <span class="hljs-title function_">load</span>(<span class="hljs-params"></span>) {
    <span class="hljs-keyword">if</span> (first) {
      <span class="hljs-comment">// ç¬¬ 1 æ¬¡ onloadï¼ˆè·¨åŸŸé¡µï¼‰æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢</span>
      iframe.<span class="hljs-property">src</span> = <span class="hljs-string">&#x27;http://localhost:8000/name/b.html&#x27;</span>;
      first = <span class="hljs-literal">false</span>;
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">// ç¬¬ 2 æ¬¡ onloadï¼ˆåŒåŸŸ b.html é¡µï¼‰æˆåŠŸåï¼Œè¯»å–åŒåŸŸ window.name ä¸­æ•°æ®</span>
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(iframe.<span class="hljs-property">contentWindow</span>.<span class="hljs-property">name</span>);
    }
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p><code>b.html</code> ä¸ºä¸­é—´ä»£ç†é¡µï¼Œä¸ <code>a.html</code> åŒåŸŸï¼Œå†…å®¹ä¸ºç©ºã€‚</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span>
</code></pre>
<p><code>c.html</code>ï¼š</p>
<pre class="hljs"><code class="language-html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;application/javascript&quot;</span>&gt;</span><span class="language-javascript">
  <span class="hljs-variable language_">window</span>.<span class="hljs-property">name</span> = <span class="hljs-string">&#x27;Hello world!&#x27;</span>;
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<h2>é˜»æ­¢è·¨æºè®¿é—®</h2>
<ul>
<li>é˜»æ­¢è·¨åŸŸå†™æ“ä½œï¼Œåªè¦æ£€æµ‹è¯·æ±‚ä¸­çš„ä¸€ä¸ªä¸å¯æµ‹çš„æ ‡è®°ï¼ˆCSRF tokenï¼‰å³å¯ï¼Œè¿™ä¸ªæ ‡è®°è¢«ç§°ä¸º <a href="https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29">Cross-Site Request Forgery (CSRF)</a> æ ‡è®°ã€‚å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ ‡è®°æ¥é˜»æ­¢é¡µé¢çš„è·¨ç«™è¯»æ“ä½œã€‚</li>
<li>é˜»æ­¢è·¨ç«™åµŒå…¥ï¼Œéœ€è¦ç¡®ä¿ä½ çš„èµ„æºä¸èƒ½æ˜¯ä»¥ä¸Šåˆ—å‡ºçš„å¯åµŒå…¥èµ„æºæ ¼å¼ã€‚å¤šæ•°æƒ…å†µä¸‹æµè§ˆå™¨éƒ½ä¸ä¼šéµå®ˆ <code>Content-Type</code> æ¶ˆæ¯å¤´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ HTML æ–‡æ¡£ä¸­æŒ‡å®š <code>&lt;script&gt;</code> æ ‡è®°ï¼Œåˆ™æµè§ˆå™¨å°†å°è¯•å°† HTML è§£æä¸º JavaScriptã€‚ å½“æ‚¨çš„èµ„æºä¸æ˜¯æ‚¨ç½‘ç«™çš„å…¥å£ç‚¹æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ CSRF ä»¤ç‰Œæ¥é˜²æ­¢åµŒå…¥ã€‚</li>
<li>é˜»æ­¢èµ„æºçš„è·¨ç«™è¯»å–ï¼Œéœ€è¦ä¿è¯è¯¥èµ„æºæ˜¯ä¸å¯åµŒå…¥çš„ã€‚é˜»æ­¢åµŒå…¥è¡Œä¸ºæ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåµŒå…¥èµ„æºé€šå¸¸å‘å…¶æš´éœ²ä¿¡æ¯ã€‚</li>
</ul>
<h2>å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy">ğŸ“– MDN: æµè§ˆå™¨çš„åŒæºç­–ç•¥</a></li>
<li><a href="http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html">ğŸ“ æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•</a></li>
<li><a href="https://juejin.im/post/5a6320d56fb9a01cb64ee191">ğŸ“ æˆ‘çŸ¥é“çš„è·¨åŸŸä¸å®‰å…¨</a></li>
<li><a href="https://mp.weixin.qq.com/s/Nk8YPYQDUJOKgQ9Qa7byag">ğŸ“ 10 ç§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆé™„ç»ˆææ–¹æ¡ˆï¼‰</a></li>
</ul>
</article></div></main><script src="/_next/static/chunks/webpack-53834dba86d90934.js" async=""></script><script>(self.__next_f=self.__next_f||[]).push([0])</script><script>self.__next_f.push([1,"1:\"$Sreact.fragment\"\n2:I[5244,[],\"\"]\n3:I[3866,[],\"\"]\n5:I[6213,[],\"OutletBoundary\"]\n7:I[6213,[],\"MetadataBoundary\"]\n9:I[6213,[],\"ViewportBoundary\"]\nb:I[4835,[],\"\"]\n:HL[\"/_next/static/media/569ce4b8f30dc480-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/media/93f479601ee12b01-s.p.woff2\",\"font\",{\"crossOrigin\":\"\",\"type\":\"font/woff2\"}]\n:HL[\"/_next/static/css/ec0a9d078e716e00.css\",\"style\"]\n:HL[\"/_next/static/css/485ff6fe79292a08.css\",\"style\"]\n:HL[\"/_next/static/css/0ff121a467c0636f.css\",\"style\"]\n"])</script><script>self.__next_f.push([1,"0:{\"P\":null,\"b\":\"P2aiewlOc1Z9OPuSRFf3D\",\"p\":\"\",\"c\":[\"\",\"front-end\",\"computer-networks\",\"web-security\",\"same-origin-policy\"],\"i\":false,\"f\":[[[\"\",{\"children\":[\"front-end\",{\"children\":[[\"slug\",\"computer-networks/web-security/same-origin-policy\",\"oc\"],{\"children\":[\"__PAGE__\",{}]}]}]},\"$undefined\",\"$undefined\",true],[\"\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/ec0a9d078e716e00.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"html\",null,{\"lang\":\"en\",\"children\":[\"$\",\"body\",null,{\"className\":\"__variable_4d318d __variable_ea5f4b antialiased\",\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":[[],[[\"$\",\"title\",null,{\"children\":\"404: This page could not be found.\"}],[\"$\",\"div\",null,{\"style\":{\"fontFamily\":\"system-ui,\\\"Segoe UI\\\",Roboto,Helvetica,Arial,sans-serif,\\\"Apple Color Emoji\\\",\\\"Segoe UI Emoji\\\"\",\"height\":\"100vh\",\"textAlign\":\"center\",\"display\":\"flex\",\"flexDirection\":\"column\",\"alignItems\":\"center\",\"justifyContent\":\"center\"},\"children\":[\"$\",\"div\",null,{\"children\":[[\"$\",\"style\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"body{color:#000;background:#fff;margin:0}.next-error-h1{border-right:1px solid rgba(0,0,0,.3)}@media (prefers-color-scheme:dark){body{color:#fff;background:#000}.next-error-h1{border-right:1px solid rgba(255,255,255,.3)}}\"}}],[\"$\",\"h1\",null,{\"className\":\"next-error-h1\",\"style\":{\"display\":\"inline-block\",\"margin\":\"0 20px 0 0\",\"padding\":\"0 23px 0 0\",\"fontSize\":24,\"fontWeight\":500,\"verticalAlign\":\"top\",\"lineHeight\":\"49px\"},\"children\":404}],[\"$\",\"div\",null,{\"style\":{\"display\":\"inline-block\"},\"children\":[\"$\",\"h2\",null,{\"style\":{\"fontSize\":14,\"fontWeight\":400,\"lineHeight\":\"49px\",\"margin\":0},\"children\":\"This page could not be found.\"}]}]]}]}]]],\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]}]]}],{\"children\":[\"front-end\",[\"$\",\"$1\",\"c\",{\"children\":[[[\"$\",\"link\",\"0\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/485ff6fe79292a08.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}],[\"$\",\"link\",\"1\",{\"rel\":\"stylesheet\",\"href\":\"/_next/static/css/0ff121a467c0636f.css\",\"precedence\":\"next\",\"crossOrigin\":\"$undefined\",\"nonce\":\"$undefined\"}]],[\"$\",\"main\",null,{\"children\":[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"front-end\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]}]]}],{\"children\":[[\"slug\",\"computer-networks/web-security/same-origin-policy\",\"oc\"],[\"$\",\"$1\",\"c\",{\"children\":[null,[\"$\",\"$L2\",null,{\"parallelRouterKey\":\"children\",\"segmentPath\":[\"children\",\"front-end\",\"children\",\"$0:f:0:1:2:children:2:children:0\",\"children\"],\"error\":\"$undefined\",\"errorStyles\":\"$undefined\",\"errorScripts\":\"$undefined\",\"template\":[\"$\",\"$L3\",null,{}],\"templateStyles\":\"$undefined\",\"templateScripts\":\"$undefined\",\"notFound\":\"$undefined\",\"forbidden\":\"$undefined\",\"unauthorized\":\"$undefined\"}]]}],{\"children\":[\"__PAGE__\",[\"$\",\"$1\",\"c\",{\"children\":[\"$L4\",null,[\"$\",\"$L5\",null,{\"children\":\"$L6\"}]]}],{},null,false]},null,false]},null,false]},null,false],[\"$\",\"$1\",\"h\",{\"children\":[null,[\"$\",\"$1\",\"YcfpmHxsSPmBQSu2kItii\",{\"children\":[[\"$\",\"$L7\",null,{\"children\":\"$L8\"}],[\"$\",\"$L9\",null,{\"children\":\"$La\"}],[\"$\",\"meta\",null,{\"name\":\"next-size-adjust\",\"content\":\"\"}]]}]]}],false]],\"m\":\"$undefined\",\"G\":[\"$b\",\"$undefined\"],\"s\":false,\"S\":true}\n"])</script><script>self.__next_f.push([1,"c:T92be,"])</script><script>self.__next_f.push([1,"\u003ch1\u003eåŒæºç­–ç•¥\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003eåŒæºç­–ç•¥\u003c/strong\u003eé™åˆ¶ä»ä¸€ä¸ªæºåŠ è½½çš„æ–‡æ¡£æˆ–è„šæœ¬å¦‚ä½•ä¸æ¥è‡ªå¦ä¸€ä¸ªæºçš„èµ„æºè¿›è¡Œäº¤äº’ï¼Œè¿™æ˜¯ä¸€ä¸ªç”¨äºéš”ç¦»æ½œåœ¨æ¶æ„æ–‡ä»¶çš„å…³é”®çš„å®‰å…¨æœºåˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eåŒæºéœ€è¦æ»¡è¶³ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eåè®®ç›¸åŒ\u003c/li\u003e\n\u003cli\u003eåŸŸåç›¸åŒ\u003c/li\u003e\n\u003cli\u003eç«¯å£ç›¸åŒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eä»¥ \u003ccode\u003ehttp://www.a.com\u003c/code\u003e ä¸ºä¾‹\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ehttp://www.a.com/foo\u003c/code\u003e åŒæº\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://a.com/foo\u003c/code\u003e ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://a.edu/foo\u003c/code\u003e ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://b.a.com/foo\u003c/code\u003e ä¸åŒæºï¼ˆåŸŸåä¸åŒï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttp://a.com:81/foo\u003c/code\u003e ä¸åŒæºï¼ˆç«¯å£ä¸åŒï¼‰\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003ehttps://a.com/foo\u003c/code\u003e ä¸åŒæºï¼ˆåè®®ä¸åŒï¼‰\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå¦‚æœæ˜¯éåŒæºï¼Œåˆ™ä»¥ä¸‹è¡Œä¸ºä¼šå—åˆ°é™åˆ¶ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eCookieã€LocalStorage å’Œ IndexDB æ— æ³•è¯»å–\u003c/li\u003e\n\u003cli\u003eDOM æ— æ³•è·å–\u003c/li\u003e\n\u003cli\u003eAJAX è¯·æ±‚ä¸èƒ½å‘é€\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eä¸ºä»€ä¹ˆè¦å®ç°è·¨åŸŸè¯·æ±‚ï¼Ÿ\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eå·¥ç¨‹æœåŠ¡åŒ–åï¼Œä¸åŒèŒè´£çš„æœåŠ¡åˆ†æ•£åœ¨ä¸åŒçš„å·¥ç¨‹ä¸­ï¼Œå¾€å¾€è¿™äº›å·¥ç¨‹çš„åŸŸåæ˜¯ä¸åŒçš„ï¼Œä½†ä¸€ä¸ªéœ€æ±‚å¯èƒ½å¯¹åº”åˆ°å¤šä¸ªæœåŠ¡ï¼Œè¿™æ—¶ä¾¿éœ€è¦è°ƒç”¨ä¸åŒæœåŠ¡çš„æ¥å£ï¼Œå› æ­¤ä¼šå‡ºç°è·¨åŸŸã€‚\u003c/p\u003e\n\u003cp\u003eåŒæºç­–ç•¥ä»…å­˜åœ¨äºæµè§ˆå™¨å®¢æˆ·ç«¯ï¼Œä¸å­˜åœ¨ Androidã€iOSã€NodeJSã€Pythonã€Java ç­‰å…¶ä»–ç¯å¢ƒã€‚\u003c/p\u003e\n\u003cp\u003eâš ï¸ \u003cstrong\u003eæ³¨æ„\u003c/strong\u003eï¼šè·¨åŸŸè¯·æ±‚èƒ½æˆåŠŸå‘é€ï¼ŒæœåŠ¡ç«¯èƒ½æ¥æ”¶è¯·æ±‚å¹¶æ­£å¸¸è¿”å›ç»“æœï¼Œåªæ˜¯ç»“æœè¢«æµè§ˆå™¨æ‹¦æˆªäº†ã€‚\u003c/p\u003e\n\u003ch2\u003eè·¨æºç½‘ç»œè®¿é—®\u003c/h2\u003e\n\u003cp\u003eä¸¥æ ¼æ¥è¯´ï¼Œæµè§ˆå™¨å¹¶ä¸æ˜¯æ‹’ç»æ‰€æœ‰çš„è·¨åŸŸè¯·æ±‚ï¼Œå®é™…ä¸Šæ‹’ç»çš„æ˜¯è·¨åŸŸçš„è¯»æ“ä½œã€‚\u003c/p\u003e\n\u003cp\u003eåŒæºç­–ç•¥æ§åˆ¶äº†ä¸åŒæºä¹‹é—´çš„äº¤äº’ï¼Œè¿™äº›äº¤äº’é€šå¸¸åˆ†ä¸ºä¸‰ç±»ï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eâœ… é€šå¸¸æµè§ˆå™¨å…è®¸è¿›è¡Œè·¨åŸŸ \u003cstrong\u003eå†™æ“ä½œ\u003c/strong\u003eï¼ˆCross-origin writesï¼‰ï¼Œå¦‚é“¾æ¥ã€é‡å®šå‘ä»¥åŠè¡¨å•æäº¤\u003c/li\u003e\n\u003cli\u003eâœ… é€šå¸¸æµè§ˆå™¨å…è®¸è·¨åŸŸ \u003cstrong\u003eèµ„æºåµŒå…¥\u003c/strong\u003eï¼ˆCross-origin embeddingï¼‰ï¼Œå¦‚ \u003ccode\u003eimg\u003c/code\u003eã€\u003ccode\u003escript\u003c/code\u003e æ ‡ç­¾\u003c/li\u003e\n\u003cli\u003eâŒ é€šå¸¸æµè§ˆå™¨ä¸å…è®¸è·¨åŸŸ \u003cstrong\u003eè¯»æ“ä½œ\u003c/strong\u003eï¼ˆCross-origin readsï¼‰ï¼Œä½†å¸¸å¯ä»¥é€šè¿‡å†…åµŒèµ„æºæ¥å·§å¦™åœ°è¿›è¡Œè¯»å–è®¿é—®ã€‚ä¾‹å¦‚å¯ä»¥è¯»å–åµŒå¥—å›¾ç‰‡çš„é«˜åº¦å’Œå®½åº¦ï¼Œè°ƒç”¨å†…åµŒè„šæœ¬çš„æ–¹æ³•\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eè§£å†³æ–¹æ¡ˆ\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eCORS è·¨åŸŸèµ„æºå…±äº«\u003c/li\u003e\n\u003cli\u003eNode ä»£ç†è·¨åŸŸ\u003c/li\u003e\n\u003cli\u003eNginx ä»£ç†è·¨åŸŸ\u003c/li\u003e\n\u003cli\u003eJSONP\u003c/li\u003e\n\u003cli\u003eWebSocket\u003c/li\u003e\n\u003cli\u003ewindow.postMessage\u003c/li\u003e\n\u003cli\u003edocument.domain + iframe\u003c/li\u003e\n\u003cli\u003ewindow.location.hash + iframe\u003c/li\u003e\n\u003cli\u003ewindow.name + iframe\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eCORS\u003c/h3\u003e\n\u003cp\u003eCORS äº¦å³ \u003ca href=\"../http/access-control\"\u003eè·¨åŸŸèµ„æºå…±äº«\u003c/a\u003eï¼Œæ˜¯ä¸€ç§ HTTP æœºåˆ¶ï¼Œå®ƒä½¿ç”¨é¢å¤–çš„ HTTP å“åº”å¤´æ¥å‘Šè¯‰æµè§ˆå™¨è®©å…¶è¿è¡Œåœ¨ä¸€ä¸ª \u003ccode\u003eorigin\u003c/code\u003e (\u003ccode\u003edomain\u003c/code\u003e) ä¸Šçš„ Web åº”ç”¨è¢«å‡†è®¸è®¿é—®æ¥è‡ª \u003cstrong\u003eä¸åŒæºæœåŠ¡å™¨\u003c/strong\u003e ä¸Šçš„æŒ‡å®šçš„èµ„æºã€‚å½“ä¸€ä¸ªèµ„æºä»ä¸è¯¥èµ„æºæœ¬èº«æ‰€åœ¨çš„æœåŠ¡å™¨ \u003cstrong\u003eä¸åŒçš„åŸŸã€åè®®æˆ–ç«¯å£\u003c/strong\u003e è¯·æ±‚ä¸€ä¸ªèµ„æºæ—¶ï¼Œèµ„æºä¼šå‘èµ·ä¸€ä¸ª \u003cstrong\u003eè·¨åŸŸ HTTP è¯·æ±‚\u003c/strong\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œé€šå¸¸ä½¿ç”¨ CORS æ—¶ï¼Œå¼‚æ­¥è¯·æ±‚ä¼šè¢«åˆ†ä¸º\u003cstrong\u003eç®€å•è¯·æ±‚\u003c/strong\u003eå’Œ\u003cstrong\u003eéç®€å•è¯·æ±‚\u003c/strong\u003eï¼Œéç®€å•è¯·æ±‚çš„åŒºåˆ«æ˜¯ä¼šå…ˆå‘é€ä¸€ä¸ª \u003cstrong\u003eé¢„æ£€è¯·æ±‚\u003c/strong\u003eï¼ˆPreflight Requestï¼‰ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eæœåŠ¡å™¨é¢„æ£€è¯·æ±‚ / å“åº”å¤´\u003c/strong\u003e\u003c/p\u003e\n\u003ctable\u003e\n\u003cthead\u003e\n\u003ctr\u003e\n\u003cth style=\"text-align:left\"\u003eå“åº”å¤´\u003c/th\u003e\n\u003cth style=\"text-align:left\"\u003eæè¿°\u003c/th\u003e\n\u003c/tr\u003e\n\u003c/thead\u003e\n\u003ctbody\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003ccode\u003eAccess-Control-Allow-Headers\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eè¯·æ±‚å¤´ï¼Œå“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º \u003ccode\u003e*\u003c/code\u003eï¼‰\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003ccode\u003eAccess-Control-Allow-Methods\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eè¯·æ±‚å¤´ï¼Œå“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º \u003ccode\u003e*\u003c/code\u003eï¼‰\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eå“åº”å¤´ï¼Œé¢„è¯·æ±‚ / æ­£å¸¸è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹ä¸èƒ½ä¸º \u003ccode\u003e*\u003c/code\u003eï¼‰\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003ccode\u003eAccess-Control-Allow-Credentials\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eå“åº”å¤´ï¼Œé¢„è¯·æ±‚/æ­£å¸¸è¯·æ±‚ï¼ˆæºå¸¦ Cookie æƒ…å†µä¸‹è¦è®¾ç½®ä¸º \u003ccode\u003etrue\u003c/code\u003eï¼‰\u003c/td\u003e\n\u003c/tr\u003e\n\u003ctr\u003e\n\u003ctd style=\"text-align:left\"\u003e\u003ccode\u003eAccess-Control-Max-Age\u003c/code\u003e\u003c/td\u003e\n\u003ctd style=\"text-align:left\"\u003eå“åº”å¤´ï¼Œé¢„è¯·æ±‚ï¼ˆå•ä½ \u003ccode\u003es\u003c/code\u003eï¼‰\u003c/td\u003e\n\u003c/tr\u003e\n\u003c/tbody\u003e\n\u003c/table\u003e\n\u003cp\u003e\u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e åªèƒ½é˜»æ­¢æµè§ˆå™¨ç«¯æ‹¿åˆ°æœåŠ¡å™¨è¿”å›æ•°æ®ï¼ŒæœåŠ¡ç«¯çš„å¤„ç†è¿˜æ˜¯ä¼šæ‰§è¡Œï¼Œè¦é…åˆ \u003ccode\u003etoken\u003c/code\u003e é‰´æƒä»¤ç‰Œç­‰ç­–ç•¥æ¥é˜²èŒƒã€‚\u003c/p\u003e\n\u003cp\u003eğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ \u003ca href=\"../http/access-control\"\u003eHTTP è·¨åŸŸèµ„æºå…±äº«\u003c/a\u003e\u003c/p\u003e\n\u003ch4\u003eåŸç”Ÿå®ç°\u003c/h4\u003e\n\u003cp\u003eåœ¨ Node.js ä¸­ \u003ccode\u003eCORS\u003c/code\u003e çš„å®ç°ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003eapp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e (ctx, next) =\u0026gt; {\n  ctx.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Origin\u0026#x27;\u003c/span\u003e, ctx.\u003cspan class=\"hljs-property\"\u003eheaders\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e);\n  ctx.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Credentials\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\n  ctx.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Request-Method\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;PUT,POST,GET,DELETE,OPTIONS\u0026#x27;\u003c/span\u003e);\n  ctx.\u003cspan class=\"hljs-title function_\"\u003eset\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Headers\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Origin, X-Requested-With, Content-Type, Accept, cc\u0026#x27;\u003c/span\u003e);\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch4\u003eç¬¬ä¸‰æ–¹ä¸­é—´ä»¶\u003c/h4\u003e\n\u003cp\u003eä»¥ Koa ä¸ºä¾‹å­ï¼Œè§£ç¦æŒ‡å®šåŸŸåçš„è·¨åŸŸè¯·æ±‚é—®é¢˜ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;koa\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e cors = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;koa2-cors\u0026#x27;\u003c/span\u003e); \u003cspan class=\"hljs-comment\"\u003e// ä½¿ç”¨æ’ä»¶è§£å†³è·¨åŸŸå¤„ç†\u003c/span\u003e\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e();\n\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\n  \u003cspan class=\"hljs-title function_\"\u003ecors\u003c/span\u003e({\n    \u003cspan class=\"hljs-attr\"\u003eorigin\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ectx\u003c/span\u003e) {\n      \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ctx.\u003cspan class=\"hljs-property\"\u003eurl\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/login\u0026#x27;\u003c/span\u003e) {\n        \u003cspan class=\"hljs-comment\"\u003e// å…è®¸æ¥è‡ªæ‰€æœ‰åŸŸåçš„è¯·æ±‚\u003c/span\u003e\n        \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;*\u0026#x27;\u003c/span\u003e;\n      }\n\n      \u003cspan class=\"hljs-comment\"\u003e// åªå…è®¸ http://localhost:8080 è¿™ä¸ªåŸŸåçš„è¯·æ±‚\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:8080\u0026#x27;\u003c/span\u003e;\n    },\n    \u003cspan class=\"hljs-comment\"\u003e// æŒ‡å®šæœ¬æ¬¡é¢„æ£€è¯·æ±‚çš„æœ‰æ•ˆæœŸï¼Œå•ä½ä¸ºç§’\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003emaxAge\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e5\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// æ˜¯å¦å…è®¸å‘é€ Cookie\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecredentials\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n    \u003cspan class=\"hljs-comment\"\u003e// è®¾ç½®æ‰€å…è®¸çš„ HTTP è¯·æ±‚æ–¹æ³•\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eallowMethods\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;GET\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;POST\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;PUT\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;DELETE\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;OPTIONS\u0026#x27;\u003c/span\u003e],\n    \u003cspan class=\"hljs-comment\"\u003e// è®¾ç½®æœåŠ¡å™¨æ”¯æŒçš„æ‰€æœ‰å¤´ä¿¡æ¯å­—æ®µ\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eallowHeaders\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Content-Type\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Authorization\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Accept\u0026#x27;\u003c/span\u003e],\n    \u003cspan class=\"hljs-comment\"\u003e// è®¾ç½®è·å–å…¶ä»–è‡ªå®šä¹‰å­—æ®µ\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eexposeHeaders\u003c/span\u003e: [\u003cspan class=\"hljs-string\"\u003e\u0026#x27;WWW-Authenticate\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Server-Authorization\u0026#x27;\u003c/span\u003e],\n  })\n);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cblockquote\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/zadzbw/koa2-cors\"\u003ekoa2-cors\u003c/a\u003e å†…éƒ¨å®ç°è¯·å‚ç…§æºç ã€‚\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch4\u003eå…³äº Cookie é—®é¢˜\u003c/h4\u003e\n\u003cp\u003eè¦ä¼ é€’ Cookie éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eWeb è¯·æ±‚è®¾ç½® \u003ccode\u003ewithCredentials\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eè¿™é‡Œé»˜è®¤æƒ…å†µä¸‹åœ¨è·¨åŸŸè¯·æ±‚ï¼Œæµè§ˆå™¨æ˜¯ä¸å¸¦ Cookie çš„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½® \u003ccode\u003ewithCredentials\u003c/code\u003e æ¥è¿›è¡Œä¼ é€’ Cookieã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// åŸç”Ÿ XMLHttpRequest çš„è®¾ç½®æ–¹å¼\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e xhr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eXHRHttpRequest\u003c/span\u003e();\nxhr.\u003cspan class=\"hljs-property\"\u003ewithCredentials\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// Axios è®¾ç½®æ–¹å¼\u003c/span\u003e\naxios.\u003cspan class=\"hljs-property\"\u003edefault\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ewithCredentials\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003col start=\"2\"\u003e\n\u003cli\u003e\u003ccode\u003eAccess-Control-Allow-Credentials\u003c/code\u003e ä¸º \u003ccode\u003etrue\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e ä¸ºé \u003ccode\u003e*\u003c/code\u003e\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eè¿™é‡Œçš„è¯·æ±‚æ–¹å¼ï¼Œåœ¨ Chrome ä¸­æ˜¯èƒ½çœ‹åˆ°è¿”å›å€¼çš„ï¼Œä½†æ˜¯åªè¦ä¸æ»¡è¶³ä»¥ä¸Šå…¶ä¸€ï¼Œæµè§ˆå™¨ä¼šæŠ¥é”™ï¼Œæ— æ³•è·å–æ•°æ®ã€‚\u003c/p\u003e\n\u003ch3\u003eNode ä»£ç†\u003c/h3\u003e\n\u003cp\u003eåˆ©ç”¨ Node + Express + Http-Proxy-Middleware æ­å»ºä¸€ä¸ª Proxy æœåŠ¡å™¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå‰ç«¯å®ç°\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e xhr = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eXMLHttpRequest\u003c/span\u003e();\n\n\u003cspan class=\"hljs-comment\"\u003e// å‰ç«¯å¼€å…³ï¼šæµè§ˆå™¨æ˜¯å¦è¯»å†™cookie\u003c/span\u003e\nxhr.\u003cspan class=\"hljs-property\"\u003ewithCredentials\u003c/span\u003e = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// è®¿é—®http-proxy-middlewareä»£ç†æœåŠ¡å™¨\u003c/span\u003e\nxhr.\u003cspan class=\"hljs-title function_\"\u003eopen\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;get\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://www.domain1.com:3000/login?user=admin\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e);\nxhr.\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e();\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cstrong\u003eæœåŠ¡å™¨å®ç°\u003c/strong\u003e\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e express = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;express\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e proxy = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;http-proxy-middleware\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-title function_\"\u003eexpress\u003c/span\u003e();\n\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\n  \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/\u0026#x27;\u003c/span\u003e,\n  \u003cspan class=\"hljs-title function_\"\u003eproxy\u003c/span\u003e({\n    \u003cspan class=\"hljs-comment\"\u003e// ä»£ç†è·¨åŸŸç›®æ ‡æ¥å£\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003etarget\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://www.domain2.com:8080\u0026#x27;\u003c/span\u003e,\n    \u003cspan class=\"hljs-attr\"\u003echangeOrigin\u003c/span\u003e: \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e,\n\n    \u003cspan class=\"hljs-comment\"\u003e// ä¿®æ”¹å“åº”å¤´ä¿¡æ¯ï¼Œå®ç°è·¨åŸŸå¹¶å…è®¸å¸¦cookie\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003eonProxyRes\u003c/span\u003e: \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eproxyRes, req, res\u003c/span\u003e) {\n      res.\u003cspan class=\"hljs-title function_\"\u003eheader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Origin\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://www.domain1.com\u0026#x27;\u003c/span\u003e);\n      res.\u003cspan class=\"hljs-title function_\"\u003eheader\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Access-Control-Allow-Credentials\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;true\u0026#x27;\u003c/span\u003e);\n    },\n\n    \u003cspan class=\"hljs-comment\"\u003e// ä¿®æ”¹å“åº”ä¿¡æ¯ä¸­çš„cookieåŸŸå\u003c/span\u003e\n    \u003cspan class=\"hljs-attr\"\u003ecookieDomainRewrite\u003c/span\u003e: \u003cspan class=\"hljs-string\"\u003e\u0026#x27;www.domain1.com\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-comment\"\u003e// å¯ä»¥ä¸ºfalseï¼Œè¡¨ç¤ºä¸ä¿®æ”¹\u003c/span\u003e\n  })\n);\n\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e3000\u003c/span\u003e);\n\u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Proxy server is listen at port 3000...\u0026#x27;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæœ¬è´¨ä¸Šä¸ CORS ä¸­åˆ—ä¸¾çš„ Koa çš„ä¾‹å­çš„åŸç†æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯è§£é™¤ CORS çš„é™åˆ¶ï¼Œä½†è¿™é‡Œæ›´å¼ºè°ƒçš„æ˜¯å¼€å‘æ—¶ä¸åç«¯æ¥å£è”è°ƒçš„åœºæ™¯ä½¿ç”¨ï¼Œå³å¯åŠ¨å‰ç«¯é¡¹ç›®çš„åŒæ—¶ï¼Œä¹Ÿå¯åŠ¨ä¸€ä¸ªå¼€å‘æœ¬åœ°çš„ Node ä»£ç†æœåŠ¡ç”¨äºè½¬å‘å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·çš„è¯·æ±‚ã€‚\u003c/p\u003e\n\u003ch3\u003eNginx åå‘ä»£ç†\u003c/h3\u003e\n\u003cp\u003eNginx å¯å®ç°ç”¨äºåå‘ä»£ç†çš„å¼‚æ­¥ Web æœåŠ¡å™¨ï¼Œä»–é™¤äº†ç”¨äºåå‘ä»£ç†ä»¥å¤–è¿˜å¯ä»¥ç”¨äºè´Ÿè½½å‡è¡¡ã€ HTTP ç¼“å­˜ã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-nginx\"\u003e\u003cspan class=\"hljs-section\"\u003ehttp\u003c/span\u003e {\n  \u003cspan class=\"hljs-attribute\"\u003einclude\u003c/span\u003e               mime.types;\n  \u003cspan class=\"hljs-attribute\"\u003edefault_type\u003c/span\u003e          application/octet-stream;\n  \u003cspan class=\"hljs-attribute\"\u003eclient_max_body_size\u003c/span\u003e  \u003cspan class=\"hljs-number\"\u003e2000M\u003c/span\u003e;\n  \u003cspan class=\"hljs-attribute\"\u003ekeepalive_timeout\u003c/span\u003e     \u003cspan class=\"hljs-number\"\u003e65\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-comment\"\u003e# è™šæ‹ŸæœåŠ¡å™¨\u003c/span\u003e\n  \u003cspan class=\"hljs-section\"\u003eserver\u003c/span\u003e {\n    \u003cspan class=\"hljs-attribute\"\u003elisten\u003c/span\u003e       \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e;\n    \u003cspan class=\"hljs-attribute\"\u003eserver_name\u003c/span\u003e  localhost;\n\n    \u003cspan class=\"hljs-comment\"\u003e# CORS è®¾ç½®\u003c/span\u003e\n    \u003cspan class=\"hljs-comment\"\u003e# æŒ‡å®šå“åº”èµ„æºæ˜¯å¦å…è®¸ä¸ç»™å®šçš„ origin å…±äº«\u003c/span\u003e\n    \u003cspan class=\"hljs-attribute\"\u003eadd_header\u003c/span\u003e Access-Control-Allow-Origin *;\n    \u003cspan class=\"hljs-comment\"\u003e# é…ç½®æ˜¯å¦å…è®¸å°†å¯¹è¯·æ±‚çš„å“åº”æš´éœ²ç»™é¡µé¢\u003c/span\u003e\n    \u003cspan class=\"hljs-attribute\"\u003eadd_header\u003c/span\u003e Access-Control-Allow-Credentials \u003cspan class=\"hljs-string\"\u003e\u0026#x27;true\u0026#x27;\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e# é…ç½®å…è®¸è·¨åŸŸçš„è¯·æ±‚å¤´\u003c/span\u003e\n    \u003cspan class=\"hljs-attribute\"\u003eadd_header\u003c/span\u003e Access-Control-Allow-Headers \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Authorization,Content-Type,Accept,Origin,User-Agent,Cache-Control,X-Mx-ReqToken,X-Requested-With\u0026#x27;\u003c/span\u003e;\n    \u003cspan class=\"hljs-comment\"\u003e# é…ç½®å…è®¸è·¨åŸŸçš„è¯·æ±‚æ–¹æ³•\u003c/span\u003e\n    \u003cspan class=\"hljs-attribute\"\u003eadd_header\u003c/span\u003e Access-Control-Allow-Methods \u003cspan class=\"hljs-string\"\u003e\u0026#x27;GET,POST,Options\u0026#x27;\u003c/span\u003e;\n\n    \u003cspan class=\"hljs-comment\"\u003e# è·³è¿‡æœåŠ¡ç«¯æ ¡éªŒï¼Œç›´æ¥è¿”å› 200\u003c/span\u003e\n    \u003cspan class=\"hljs-attribute\"\u003eif\u003c/span\u003e (\u003cspan class=\"hljs-variable\"\u003e$request_method\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;OPTIONS\u0026#x27;\u003c/span\u003e) {\n      \u003cspan class=\"hljs-attribute\"\u003ereturn\u003c/span\u003e \u003cspan class=\"hljs-number\"\u003e200\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-section\"\u003elocation\u003c/span\u003e / {\n        \u003cspan class=\"hljs-attribute\"\u003eroot\u003c/span\u003e        /data/example/dist;\n        \u003cspan class=\"hljs-attribute\"\u003eindex\u003c/span\u003e       index.html index.htm;\n        \u003cspan class=\"hljs-attribute\"\u003etry_files\u003c/span\u003e   \u003cspan class=\"hljs-variable\"\u003e$uri\u003c/span\u003e /index.html;\n        \u003cspan class=\"hljs-attribute\"\u003eadd_header\u003c/span\u003e  Cache-Control \u003cspan class=\"hljs-string\"\u003e\u0026quot;private, no-store, no-cache, must-revalidate, proxy-revalidate\u0026quot;\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-section\"\u003elocation\u003c/span\u003e /api/ {\n        \u003cspan class=\"hljs-attribute\"\u003eproxy_pass\u003c/span\u003e  https://xxx.xxx.xxx/req/;\n    }\n  }\n}\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003eå¯¹äºç®€å•è¯·æ±‚ï¼Œå¦‚ GETï¼Œåªéœ€è¦åœ¨ HTTP Response åæ·»åŠ  Access-Control-Allow-Origin\u003c/li\u003e\n\u003cli\u003eå¯¹äºéç®€å•è¯·æ±‚ï¼Œå¦‚ POSTã€PUTã€DELETE ç­‰ï¼Œæµè§ˆå™¨ä¼šåˆ†ä¸¤æ¬¡åº”ç­”ã€‚ç¬¬ä¸€æ¬¡ Preflightï¼ˆ\u003ccode\u003emethod: OPTIONS\u003c/code\u003eï¼‰ï¼Œä¸»è¦éªŒè¯æ¥æºæ˜¯å¦åˆæ³•ï¼Œå¹¶è¿”å›å…è®¸çš„ \u003ccode\u003eHeaders\u003c/code\u003e ç­‰ï¼›ç¬¬äºŒæ¬¡æ‰æ˜¯çœŸæ­£çš„ HTTP åº”ç­”ï¼Œæ‰€ä»¥æœåŠ¡å™¨å¿…é¡»å¤„ç† \u003ccode\u003eOPTIONS\u003c/code\u003e åº”ç­”ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eç”±äºæµè§ˆå™¨ç¬¬ä¸€æ¬¡ Preflight é¢„æ£€ï¼Œå¯¼è‡´æœåŠ¡ç«¯å¯¹å…¶è¯·æ±‚è¿›è¡Œæ ¡éªŒï¼Œä½†æ˜¯æœåŠ¡ç«¯æœ¬èº«æ²¡æœ‰å¼€å¯ CORSï¼Œæ‰€ä»¥ä¼šå¯¼è‡´æœåŠ¡ç«¯è¿”å› 405 Method Not Allowed æˆ–è€… 403 Forbiddenã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨ Nginx å¯¹è¯¥è¯·æ±‚è¿›è¡Œæ‹¦æˆªï¼Œç›´æ¥è¿”å› 200ï¼Œè·³è¿‡æœåŠ¡ç«¯æ ¡éªŒã€‚\u003c/p\u003e\n\u003ch3\u003eJSONP\u003c/h3\u003e\n\u003cp\u003e\u003cstrong\u003eå®ç°åŸç†\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eåŠ¨æ€åˆ›å»º \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e è„šæœ¬æ ‡ç­¾ï¼Œé€šè¿‡è·¨åŸŸè„šæœ¬åµŒå…¥ä¸å—åŒæºç­–ç•¥é™åˆ¶çš„æ–¹æ³•å®ç°è¯·æ±‚ç¬¬ä¸‰æ–¹æœåŠ¡å™¨æ•°æ®å†…å®¹ã€‚é™¤äº†é€‚ç”¨äº \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e è„šæœ¬æ ‡ç­¾ï¼ŒHTML ä¸­åŒ…å« \u003ccode\u003esrc\u003c/code\u003e å’Œ \u003ccode\u003ehref\u003c/code\u003e å±æ€§çš„æ ‡ç­¾å‡ä¸å—åŒæºç­–ç•¥é™åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå®ç°æ­¥éª¤\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eåŠ¨æ€åˆ›å»º \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e æ ‡ç­¾\u003c/li\u003e\n\u003cli\u003eæ ‡ç­¾ \u003ccode\u003esrc\u003c/code\u003e å±æ€§è®¾ç½®æ¥å£åœ°å€\u003c/li\u003e\n\u003cli\u003eæ¥å£å‚æ•°ï¼Œå¿…é¡»è¦å¸¦ä¸€ä¸ªè‡ªå®šä¹‰å‡½æ•°åï¼Œè¦ä¸ç„¶åå°æ— æ³•è¿”å›æ•°æ®ï¼Œé€šå¸¸ä¸º \u003ccode\u003ecallback\u003c/code\u003e æˆ– \u003ccode\u003ecb\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003eé€šè¿‡å®šä¹‰å‡½æ•°åå»æ¥æ”¶åå°è¿”å›æ•°æ®\u003c/li\u003e\n\u003c/ol\u003e\n\u003cp\u003eå‰ç«¯å®ç°ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-comment\"\u003e// åŠ¨æ€åˆ›å»ºè„šæœ¬æ ‡ç­¾\u003c/span\u003e\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e script = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;script\u0026#x27;\u003c/span\u003e);\n\n\u003cspan class=\"hljs-comment\"\u003e// è®¾ç½®æ¥å£åœ°å€\u003c/span\u003e\nscript.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:8080/api/jsonp?cb=jsonpCallback\u0026#x27;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-comment\"\u003e// æ’å…¥é¡µé¢\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(script);\n\n\u003cspan class=\"hljs-comment\"\u003e// é€šè¿‡å®šä¹‰å›è°ƒå‡½æ•°æ¥æ”¶å“åº”æ•°æ®\u003c/span\u003e\n\u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ejsonpCallback\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eres\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// do something with response data\u003c/span\u003e\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eåç«¯å®ç°ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;koa\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e fs = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;fs\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e app = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eKoa\u003c/span\u003e();\n\napp.\u003cspan class=\"hljs-title function_\"\u003euse\u003c/span\u003e(\u003cspan class=\"hljs-title function_\"\u003easync\u003c/span\u003e (ctx, next) =\u0026gt; {\n  \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (ctx.\u003cspan class=\"hljs-property\"\u003epath\u003c/span\u003e === \u003cspan class=\"hljs-string\"\u003e\u0026#x27;/api/jsonp\u0026#x27;\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e { cb } = ctx.\u003cspan class=\"hljs-property\"\u003equery\u003c/span\u003e;\n    ctx.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e`\u003cspan class=\"hljs-subst\"\u003e${cb}\u003c/span\u003e(\u003cspan class=\"hljs-subst\"\u003e${\u003cspan class=\"hljs-built_in\"\u003eJSON\u003c/span\u003e.stringify({ msg })}\u003c/span\u003e)`\u003c/span\u003e;\n    \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n  }\n});\n\napp.\u003cspan class=\"hljs-title function_\"\u003elisten\u003c/span\u003e(\u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eç”±äº \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e å…ƒç´ è¯·æ±‚çš„è„šæœ¬ï¼Œç›´æ¥ä½œä¸ºä»£ç è¿è¡Œã€‚è¿™æ—¶ï¼Œåªè¦æµè§ˆå™¨å®šä¹‰äº†å›è°ƒå‡½æ•°ï¼Œè¯¥å‡½æ•°å°±ä¼šç«‹å³è°ƒç”¨ã€‚ä½œä¸ºå‚æ•°çš„ JSON æ•°æ®è¢«è§†ä¸º JavaScript å¯¹è±¡ï¼Œè€Œä¸æ˜¯å­—ç¬¦ä¸²ï¼Œå› æ­¤é¿å…äº†ä½¿ç”¨ \u003ccode\u003eJSON.parse\u003c/code\u003e çš„æ­¥éª¤ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eç¼ºç‚¹\u003c/strong\u003eï¼š\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003eéå¸¸é«˜çš„è·¨ç«™è„šæœ¬æ”»å‡»é£é™©\u003c/li\u003e\n\u003cli\u003eåªèƒ½å®ç° GET è¯·æ±‚\u003c/li\u003e\n\u003cli\u003eæ¥å£å‡ºç°é”™è¯¯æ—¶ï¼Œå¾ˆéš¾è¿›è¡Œé”™è¯¯è¯†åˆ«å¤„ç†\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eWebSocket\u003c/h3\u003e\n\u003cp\u003eWebSocket æ˜¯ä¸€ç§é€šä¿¡åè®®ï¼Œä½¿ç”¨ \u003ccode\u003ews://\u003c/code\u003eï¼ˆéåŠ å¯†ï¼‰å’Œ \u003ccode\u003ewss://\u003c/code\u003eï¼ˆåŠ å¯†ï¼‰ä½œä¸ºåè®®å‰ç¼€ã€‚è¯¥åè®®ä¸å®è¡ŒåŒæºæ”¿ç­–ï¼Œåªè¦æœåŠ¡å™¨æ”¯æŒï¼Œå°±å¯ä»¥é€šè¿‡å®ƒè¿›è¡Œè·¨æºé€šä¿¡ã€‚\u003c/p\u003e\n\u003cp\u003eç®€å•æ¥è¯´ï¼ŒWebSocket é€šè¿‡å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ä¹‹é—´å»ºç«‹æŒä¹…çš„è¿æ¥ï¼ŒåŒæ–¹å¯ä»¥éšæ—¶å‘é€æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003eè¿™ç§æ–¹å¼æœ¬è´¨ä¸Šæ²¡æœ‰ä½¿ç”¨ HTTP åè®®è¿›è¡Œé€šä¿¡ï¼Œå› æ­¤ä¹Ÿæ²¡æœ‰æµè§ˆå™¨è·¨åŸŸçš„é™åˆ¶ã€‚\u003c/p\u003e\n\u003cp\u003eå‰ç«¯éƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e socket = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWebSocket\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;ws://localhost:8080\u0026#x27;\u003c/span\u003e);\n\nsocket.\u003cspan class=\"hljs-property\"\u003eonopen\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n  socket.\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Client Socket is openning\u0026#x27;\u003c/span\u003e);\n};\n\nsocket.\u003cspan class=\"hljs-property\"\u003eonmessage\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) {\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e);\n};\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eåç«¯éƒ¨åˆ†ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWebSocket\u003c/span\u003e = \u003cspan class=\"hljs-built_in\"\u003erequire\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;ws\u0026#x27;\u003c/span\u003e);\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e server = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e \u003cspan class=\"hljs-title class_\"\u003eWebSocket\u003c/span\u003e.\u003cspan class=\"hljs-title class_\"\u003eServer\u003c/span\u003e({ \u003cspan class=\"hljs-attr\"\u003eport\u003c/span\u003e: \u003cspan class=\"hljs-number\"\u003e8080\u003c/span\u003e });\n\nserver.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;connection\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003esocket\u003c/span\u003e) {\n  socket.\u003cspan class=\"hljs-title function_\"\u003eon\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;message\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003edata\u003c/span\u003e) {\n    socket.\u003cspan class=\"hljs-title function_\"\u003esend\u003c/span\u003e(data);\n  });\n});\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ \u003ca href=\"../../html5-scripting-programming/connectivity/web-socket\"\u003eWebSocket\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003ewindow.postMessage\u003c/h3\u003e\n\u003cp\u003eé€šå¸¸ï¼Œå¯¹äºä¸¤ä¸ªä¸åŒé¡µé¢çš„è„šæœ¬ï¼Œåªæœ‰å½“æ‰§è¡Œå®ƒä»¬çš„é¡µé¢ä½äºå…·æœ‰ç›¸åŒçš„åè®®ï¼ˆé€šå¸¸ä¸º HTTPSï¼‰ï¼Œç«¯å£å·ï¼ˆ443 ä¸º HTTPS çš„é»˜è®¤å€¼ï¼‰ï¼Œä»¥åŠä¸»æœºï¼ˆä¸¤ä¸ªé¡µé¢çš„æ¨¡æ•° \u003ccode\u003edocument.domain\u003c/code\u003e è®¾ç½®ä¸ºç›¸åŒçš„å€¼ï¼‰æ—¶ï¼Œè¿™ä¸¤ä¸ªè„šæœ¬æ‰èƒ½ç›¸äº’é€šä¿¡ã€‚\u003ccode\u003ewindow.postMessage\u003c/code\u003e æ–¹æ³•æä¾›äº†ä¸€ç§å—æ§æœºåˆ¶æ¥è§„é¿æ­¤é™åˆ¶ï¼Œåªè¦æ­£ç¡®çš„ä½¿ç”¨ï¼Œè¿™ç§æ–¹æ³•å°±å¾ˆå®‰å…¨ã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ewindow.postMessage(message, targetOrigin)\u003c/code\u003e æ–¹æ³•æ˜¯ HTML5 æ–°å¼•è¿›çš„ç‰¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨å®ƒå‘å…¶ä»–çš„ \u003ccode\u003ewindow\u003c/code\u003e å¯¹è±¡å‘é€æ¶ˆæ¯ï¼Œæ— è®ºè¿™ä¸ª \u003ccode\u003ewindow\u003c/code\u003e å¯¹è±¡æ˜¯å±äºåŒæºæˆ–ä¸åŒæºï¼Œç›®å‰ IE8+ã€Firefoxã€Chromeã€Opera ç­‰æµè§ˆå™¨éƒ½å·²ç»æ”¯æŒè¯¥æ–¹æ³•ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eç”¨é€”ï¼š\u003c/strong\u003e\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003eé¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’\u003c/li\u003e\n\u003cli\u003eå¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’\u003c/li\u003e\n\u003cli\u003eé¡µé¢ä¸åµŒå¥—çš„ iframe æ¶ˆæ¯ä¼ é€’\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003eotherWindow.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(message, targetOrigin, [transfer]);\n\u003c/code\u003e\u003c/pre\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003eotherWindow\u003c/code\u003eï¼šå…¶ä»–çª—å£çš„ä¸€ä¸ªå¼•ç”¨ï¼Œæ¯”å¦‚ iframe çš„ \u003ccode\u003econtentWindow\u003c/code\u003e å±æ€§ã€æ‰§è¡Œ \u003ccode\u003ewindow.open\u003c/code\u003e è¿”å›çš„çª—å£ã€æˆ–è€…æ˜¯å‘½åè¿‡æˆ–æ•°å€¼ç´¢å¼•çš„ \u003ccode\u003ewindow.iframes\u003c/code\u003e\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003emessage\u003c/code\u003eï¼šå°†è¦å‘é€åˆ°å…¶ä»– \u003ccode\u003ewindow\u003c/code\u003e çš„æ•°æ®\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etargetOrigin\u003c/code\u003eï¼šé€šè¿‡çª—å£çš„ \u003ccode\u003eorigin\u003c/code\u003e å±æ€§æ¥æŒ‡å®šå“ªäº›çª—å£èƒ½æ¥æ”¶åˆ°æ¶ˆæ¯äº‹ä»¶\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003etransfer\u003c/code\u003eï¼ˆå¯é€‰ï¼‰ï¼šæ˜¯ä¸€ä¸²å’Œ \u003ccode\u003emessage\u003c/code\u003e åŒæ—¶ä¼ é€’çš„ Transferable å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„æ‰€æœ‰æƒå°†è¢«è½¬ç§»ç»™æ¶ˆæ¯çš„æ¥æ”¶æ–¹ï¼Œè€Œå‘é€ä¸€æ–¹å°†ä¸å†ä¿æœ‰æ‰€æœ‰æƒ\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003eå‘é€ç«¯é¡µé¢ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;iframe\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://localhost:8080/\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eframeborder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003eonload\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;load()\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eload\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    iframe.\u003cspan class=\"hljs-property\"\u003econtentWindow\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;Hello world!\u0026#x27;\u003c/span\u003e, \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:8080/\u0026#x27;\u003c/span\u003e);\n\n    \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eonmessage\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e);\n    };\n  }\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eæ¥æ”¶ç«¯é¡µé¢ï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eonmessage\u003c/span\u003e = \u003cspan class=\"hljs-function\"\u003e(\u003cspan class=\"hljs-params\"\u003ee\u003c/span\u003e) =\u0026gt;\u003c/span\u003e {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e);\n    \u003cspan class=\"hljs-comment\"\u003e// Hello world!\u003c/span\u003e\n    e.\u003cspan class=\"hljs-property\"\u003esource\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003epostMessage\u003c/span\u003e(e.\u003cspan class=\"hljs-property\"\u003edata\u003c/span\u003e, e.\u003cspan class=\"hljs-property\"\u003eorigin\u003c/span\u003e);\n  };\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eğŸ’¡ å®ç°ç»†èŠ‚è¯·å‚è€ƒ \u003ca href=\"../../browser-object-model/connectivity/post-message\"\u003ePostMessage\u003c/a\u003e\u003c/p\u003e\n\u003ch3\u003edocument.domain + iframe\u003c/h3\u003e\n\u003cp\u003eCookie æ˜¯æœåŠ¡å™¨å†™å…¥æµè§ˆå™¨çš„ä¸€å°æ®µä¿¡æ¯ï¼Œåªæœ‰åŒæºçš„ç½‘é¡µæ‰èƒ½å…±äº«ã€‚\u003c/p\u003e\n\u003cp\u003eä½†æ˜¯ï¼Œä¸¤ä¸ªç½‘é¡µä¸€çº§åŸŸåç›¸åŒï¼Œåªæ˜¯äºŒçº§åŸŸåä¸åŒï¼Œæµè§ˆå™¨åªéœ€è¦è®¾ç½® \u003ccode\u003edocument.domain\u003c/code\u003e ä¸ºæ›´é«˜çº§åˆ«çš„åŸŸå°±èƒ½å®ç° Cookie å…±äº«ã€‚\u003c/p\u003e\n\u003cp\u003eğŸŒ° \u003cstrong\u003eä»£ç ç¤ºä¾‹\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä»¥ \u003ccode\u003ea.foo.com\u003c/code\u003e å’Œ \u003ccode\u003eb.foo.com\u003c/code\u003e ä¸ºä¾‹ï¼Œåªè¦è®¾ç½®ç›¸åŒçš„ \u003ccode\u003edocument.domain\u003c/code\u003eï¼Œä¸¤ä¸ªç½‘é¡µå°±å¯ä»¥å…±äº« Cookieã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-js\"\u003e\u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003edomain\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;foo.com\u0026#x27;\u003c/span\u003e;\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eâš ï¸ \u003cstrong\u003eæ³¨æ„\u003c/strong\u003eï¼šè¿™ç§æ–¹æ³•åªé€‚ç”¨äº Cookie å’Œ iframe çª—å£ï¼ŒlocalStorage å’Œ IndexDB æ— æ³•é€šè¿‡è¿™ç§æ–¹æ³•ï¼Œè§„é¿åŒæºç­–ç•¥ï¼Œéœ€è¦é‡‡ç”¨ä¸‹æ–‡æåŠçš„ \u003ca href=\"#postMessage\"\u003ePostMessage API\u003c/a\u003eã€‚\u003c/p\u003e\n\u003cp\u003eå¦å¤–ï¼ŒæœåŠ¡å™¨ä¹Ÿå¯ä»¥åœ¨è®¾ç½® Cookie çš„æ—¶å€™ï¼ŒæŒ‡å®š Cookie çš„æ‰€å±åŸŸåä¸ºä¸€çº§åŸŸåã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-http\"\u003e\u003cspan class=\"hljs-attribute\"\u003eSet-Cookie\u003c/span\u003e\u003cspan class=\"hljs-punctuation\"\u003e: \u003c/span\u003ekey=value; domain=.example; path=/\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eé‚£ä¹ˆï¼ŒäºŒçº§åŸŸåå’Œä¸‰çº§åŸŸåä¸ç”¨åšä»»ä½•è®¾ç½®ï¼Œéƒ½å¯ä»¥è¯»å–è¿™ä¸ª Cookieã€‚\u003c/p\u003e\n\u003ch3\u003ewindow.location.hash + iframe\u003c/h3\u003e\n\u003cp\u003eå¦‚æœä¸¤ä¸ªç½‘é¡µä¸åŒæºï¼Œå°±æ— æ³•æ‹¿åˆ°å¯¹æ–¹çš„ DOMã€‚å…¸å‹çš„ä¾‹å­æ˜¯ \u003ccode\u003eiframe\u003c/code\u003e çª—å£å’Œ \u003ccode\u003ewindow.open\u003c/code\u003e æ–¹æ³•æ‰“å¼€çš„çª—å£ï¼Œå®ƒä»¬ä¸çˆ¶çª—å£æ— æ³•é€šä¿¡ã€‚\u003c/p\u003e\n\u003cp\u003eé€šè¿‡ \u003ccode\u003eurl\u003c/code\u003e å¸¦ \u003ccode\u003ehash\u003c/code\u003e é”šç‚¹ï¼Œå¯ä»¥é€šè¿‡ä¸€ä¸ªéè·¨åŸŸçš„ä¸­é—´é¡µé¢æ¥ä¼ é€’æ•°æ®ã€‚\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eå®ç°æµç¨‹\u003c/strong\u003e\u003c/p\u003e\n\u003cp\u003eä¸€å¼€å§‹ \u003ccode\u003ea.html\u003c/code\u003e ç»™ \u003ccode\u003ec.html\u003c/code\u003e ä¼ ä¸€ä¸ª hash å€¼ï¼Œç„¶å \u003ccode\u003ec.html\u003c/code\u003e æ”¶åˆ° hash å€¼åï¼Œå†æŠŠ hash å€¼ä¼ é€’ç»™ \u003ccode\u003eb.html\u003c/code\u003eï¼Œæœ€å \u003ccode\u003eb.html\u003c/code\u003e å°†ç»“æœæ”¾åˆ° \u003ccode\u003ea.html\u003c/code\u003e çš„ hash å€¼ä¸­ã€‚åŒæ ·çš„ï¼Œ\u003ccode\u003ea.html\u003c/code\u003e å’Œ \u003ccode\u003eb.html\u003c/code\u003e æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯ \u003ccode\u003ehttp://localhost:8000/\u003c/code\u003eï¼Œè€Œ \u003ccode\u003ec.html\u003c/code\u003e æ˜¯ \u003ccode\u003ehttp://localhost:8080/\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ea.html\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://localhost:8080/hash/c.html#param1\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(location.\u003cspan class=\"hljs-property\"\u003ehash\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eonhashchange\u003c/span\u003e = \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(location.\u003cspan class=\"hljs-property\"\u003ehash\u003c/span\u003e);\n  };\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eb.html\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eparent\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003eparent\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003elocation\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ehash\u003c/span\u003e = location.\u003cspan class=\"hljs-property\"\u003ehash\u003c/span\u003e;\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ec.html\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ebody\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(location.\u003cspan class=\"hljs-property\"\u003ehash\u003c/span\u003e);\n\n  \u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e iframe = \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003ecreateElement\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026#x27;iframe\u0026#x27;\u003c/span\u003e);\n\n  iframe.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:8000/hash/b.html#name2\u0026#x27;\u003c/span\u003e;\n\n  \u003cspan class=\"hljs-variable language_\"\u003edocument\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ebody\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003eappendChild\u003c/span\u003e(iframe);\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3\u003ewindow.name + iframe\u003c/h3\u003e\n\u003cp\u003e\u003ccode\u003ewindow\u003c/code\u003e å¯¹è±¡çš„ \u003ccode\u003ename\u003c/code\u003e å±æ€§æ˜¯ä¸€ä¸ªå¾ˆç‰¹åˆ«çš„å±æ€§ï¼Œå½“è¯¥ \u003ccode\u003ewindow\u003c/code\u003e çš„ \u003ccode\u003elocation\u003c/code\u003e å˜åŒ–ï¼Œç„¶åé‡æ–°åŠ è½½ï¼Œå®ƒçš„ \u003ccode\u003ename\u003c/code\u003e å±æ€§å¯ä»¥ä¾ç„¶ä¿æŒä¸å˜ã€‚\u003c/p\u003e\n\u003cp\u003eå…¶ä¸­ \u003ccode\u003ea.html\u003c/code\u003e å’Œ \u003ccode\u003eb.html\u003c/code\u003e æ˜¯åŒåŸŸçš„ï¼Œéƒ½æ˜¯ \u003ccode\u003ehttp://localhost:8000/\u003c/code\u003eï¼Œè€Œ \u003ccode\u003ec.html\u003c/code\u003e æ˜¯ \u003ccode\u003ehttp://localhost:8080/\u003c/code\u003eã€‚\u003c/p\u003e\n\u003cp\u003e\u003ccode\u003ea.html\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eid\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;iframe\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eframeborder\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;0\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003esrc\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;http://localhost:8080/name/c.html\u0026quot;\u003c/span\u003e\n  \u003cspan class=\"hljs-attr\"\u003eonload\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;load()\u0026quot;\u003c/span\u003e\n\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003eiframe\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\n\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-keyword\"\u003elet\u003c/span\u003e first = \u003cspan class=\"hljs-literal\"\u003etrue\u003c/span\u003e;\n  \u003cspan class=\"hljs-comment\"\u003e// onload äº‹ä»¶ä¼šè§¦å‘ 2 æ¬¡ï¼Œç¬¬ 1 æ¬¡åŠ è½½è·¨åŸŸé¡µï¼Œå¹¶ç•™å­˜æ•°æ®äº window.name\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e \u003cspan class=\"hljs-title function_\"\u003eload\u003c/span\u003e(\u003cspan class=\"hljs-params\"\u003e\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (first) {\n      \u003cspan class=\"hljs-comment\"\u003e// ç¬¬ 1 æ¬¡ onloadï¼ˆè·¨åŸŸé¡µï¼‰æˆåŠŸåï¼Œåˆ‡æ¢åˆ°åŒåŸŸä»£ç†é¡µé¢\u003c/span\u003e\n      iframe.\u003cspan class=\"hljs-property\"\u003esrc\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;http://localhost:8000/name/b.html\u0026#x27;\u003c/span\u003e;\n      first = \u003cspan class=\"hljs-literal\"\u003efalse\u003c/span\u003e;\n    } \u003cspan class=\"hljs-keyword\"\u003eelse\u003c/span\u003e {\n      \u003cspan class=\"hljs-comment\"\u003e// ç¬¬ 2 æ¬¡ onloadï¼ˆåŒåŸŸ b.html é¡µï¼‰æˆåŠŸåï¼Œè¯»å–åŒåŸŸ window.name ä¸­æ•°æ®\u003c/span\u003e\n      \u003cspan class=\"hljs-variable language_\"\u003econsole\u003c/span\u003e.\u003cspan class=\"hljs-title function_\"\u003elog\u003c/span\u003e(iframe.\u003cspan class=\"hljs-property\"\u003econtentWindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e);\n    }\n  }\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003eb.html\u003c/code\u003e ä¸ºä¸­é—´ä»£ç†é¡µï¼Œä¸ \u003ccode\u003ea.html\u003c/code\u003e åŒåŸŸï¼Œå†…å®¹ä¸ºç©ºã€‚\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003ediv\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003ccode\u003ec.html\u003c/code\u003eï¼š\u003c/p\u003e\n\u003cpre class=\"hljs\"\u003e\u003ccode class=\"language-html\"\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e \u003cspan class=\"hljs-attr\"\u003etype\u003c/span\u003e=\u003cspan class=\"hljs-string\"\u003e\u0026quot;application/javascript\u0026quot;\u003c/span\u003e\u0026gt;\u003c/span\u003e\u003cspan class=\"language-javascript\"\u003e\n  \u003cspan class=\"hljs-variable language_\"\u003ewindow\u003c/span\u003e.\u003cspan class=\"hljs-property\"\u003ename\u003c/span\u003e = \u003cspan class=\"hljs-string\"\u003e\u0026#x27;Hello world!\u0026#x27;\u003c/span\u003e;\n\u003c/span\u003e\u003cspan class=\"hljs-tag\"\u003e\u0026lt;/\u003cspan class=\"hljs-name\"\u003escript\u003c/span\u003e\u0026gt;\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003eé˜»æ­¢è·¨æºè®¿é—®\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eé˜»æ­¢è·¨åŸŸå†™æ“ä½œï¼Œåªè¦æ£€æµ‹è¯·æ±‚ä¸­çš„ä¸€ä¸ªä¸å¯æµ‹çš„æ ‡è®°ï¼ˆCSRF tokenï¼‰å³å¯ï¼Œè¿™ä¸ªæ ‡è®°è¢«ç§°ä¸º \u003ca href=\"https://www.owasp.org/index.php/Cross-Site_Request_Forgery_%28CSRF%29\"\u003eCross-Site Request Forgery (CSRF)\u003c/a\u003e æ ‡è®°ã€‚å¿…é¡»ä½¿ç”¨è¿™ä¸ªæ ‡è®°æ¥é˜»æ­¢é¡µé¢çš„è·¨ç«™è¯»æ“ä½œã€‚\u003c/li\u003e\n\u003cli\u003eé˜»æ­¢è·¨ç«™åµŒå…¥ï¼Œéœ€è¦ç¡®ä¿ä½ çš„èµ„æºä¸èƒ½æ˜¯ä»¥ä¸Šåˆ—å‡ºçš„å¯åµŒå…¥èµ„æºæ ¼å¼ã€‚å¤šæ•°æƒ…å†µä¸‹æµè§ˆå™¨éƒ½ä¸ä¼šéµå®ˆ \u003ccode\u003eContent-Type\u003c/code\u003e æ¶ˆæ¯å¤´ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨åœ¨ HTML æ–‡æ¡£ä¸­æŒ‡å®š \u003ccode\u003e\u0026lt;script\u0026gt;\u003c/code\u003e æ ‡è®°ï¼Œåˆ™æµè§ˆå™¨å°†å°è¯•å°† HTML è§£æä¸º JavaScriptã€‚ å½“æ‚¨çš„èµ„æºä¸æ˜¯æ‚¨ç½‘ç«™çš„å…¥å£ç‚¹æ—¶ï¼Œæ‚¨è¿˜å¯ä»¥ä½¿ç”¨ CSRF ä»¤ç‰Œæ¥é˜²æ­¢åµŒå…¥ã€‚\u003c/li\u003e\n\u003cli\u003eé˜»æ­¢èµ„æºçš„è·¨ç«™è¯»å–ï¼Œéœ€è¦ä¿è¯è¯¥èµ„æºæ˜¯ä¸å¯åµŒå…¥çš„ã€‚é˜»æ­¢åµŒå…¥è¡Œä¸ºæ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºåµŒå…¥èµ„æºé€šå¸¸å‘å…¶æš´éœ²ä¿¡æ¯ã€‚\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eå‚è€ƒèµ„æ–™\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://developer.mozilla.org/zh-CN/docs/Web/Security/Same-origin_policy\"\u003eğŸ“– MDN: æµè§ˆå™¨çš„åŒæºç­–ç•¥\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"http://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html\"\u003eğŸ“ æµè§ˆå™¨åŒæºæ”¿ç­–åŠå…¶è§„é¿æ–¹æ³•\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://juejin.im/post/5a6320d56fb9a01cb64ee191\"\u003eğŸ“ æˆ‘çŸ¥é“çš„è·¨åŸŸä¸å®‰å…¨\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://mp.weixin.qq.com/s/Nk8YPYQDUJOKgQ9Qa7byag\"\u003eğŸ“ 10 ç§è·¨åŸŸè§£å†³æ–¹æ¡ˆï¼ˆé™„ç»ˆææ–¹æ¡ˆï¼‰\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n"])</script><script>self.__next_f.push([1,"4:[\"$\",\"div\",null,{\"className\":\"markdown-body\",\"children\":[[\"$\",\"h1\",null,{\"children\":\"åŒæºç­–ç•¥\"}],[\"$\",\"article\",null,{\"dangerouslySetInnerHTML\":{\"__html\":\"$c\"}}]]}]\n"])</script><script>self.__next_f.push([1,"a:[[\"$\",\"meta\",\"0\",{\"name\":\"viewport\",\"content\":\"width=device-width, initial-scale=1\"}]]\n8:[[\"$\",\"meta\",\"0\",{\"charSet\":\"utf-8\"}],[\"$\",\"title\",\"1\",{\"children\":\"front-end\"}],[\"$\",\"meta\",\"2\",{\"name\":\"description\",\"content\":\"front-end knowledge\"}],[\"$\",\"link\",\"3\",{\"rel\":\"icon\",\"href\":\"/favicon.ico\",\"type\":\"image/x-icon\",\"sizes\":\"16x16\"}]]\n"])</script><script>self.__next_f.push([1,"6:null\n"])</script></body></html>